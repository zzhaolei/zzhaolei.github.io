<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Go | leiçš„åšå®¢</title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="https://zzhaolei.github.io/tags/go/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.263bac85f191a9f304e91b8bb5ec997c174abef0bec446591945462e5fdff366.css" integrity="sha256-JjushfGRqfME6RuLteyZfBdKvvC&#43;xEZZGUVGLl/f82Y=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://zzhaolei.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://zzhaolei.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://zzhaolei.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://zzhaolei.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://zzhaolei.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://zzhaolei.github.io/tags/go/index.xml">
<link rel="alternate" hreflang="zh" href="https://zzhaolei.github.io/tags/go/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://zzhaolei.github.io/tags/go/">
  <meta property="og:site_name" content="leiçš„åšå®¢">
  <meta property="og:title" content="Go">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="website">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Go">
<meta name="twitter:description" content="">

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://zzhaolei.github.io/" accesskey="h" title="leiçš„åšå®¢ (Alt + H)">leiçš„åšå®¢</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://zzhaolei.github.io/archive/" title="å½’æ¡£">
                    <span>å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://zzhaolei.github.io/search/" title="æœç´¢">
                    <span>æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://zzhaolei.github.io/tags/" title="æ ‡ç­¾">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header">
  <h1>
    Go
    <a href="/tags/go/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">è®°å½•å¸¸ç”¨çš„å„ç§å·¥å…·
    </h2>
  </header>
  <div class="entry-content">
    <p>ç”¨äºGoé¡¹ç›® åç§° æè¿° gopkgview äº¤äº’å¼çš„åŸºäºWebçš„GoåŒ…ä¾èµ–å›¾å¯è§†åŒ– gup æ›´æ–°ç”±go installå®‰è£…çš„äºŒè¿›åˆ¶æ–‡ä»¶ gsa åˆ†æç¼–è¯‘åçš„GoäºŒè¿›åˆ¶æ–‡ä»¶å¤§å°çš„å·¥å…·ï¼Œå¯ä»¥æ¸…æ™°çš„äº†è§£æ¯ä¸ªåŒ…æˆ–ä¾èµ–åœ¨äºŒè¿›åˆ¶ä¸­å ç”¨çš„å¤§å° mockgen gomockæ˜¯Goç¼–ç¨‹è¯­è¨€çš„æ¨¡æ‹Ÿæ¡†æ¶ nilaway é™æ€åˆ†æå·¥å…·ï¼Œç”¨äºæ£€æµ‹Goä»£ç ä¸­çš„æ½œåœ¨nilææ…Œ å‘½ä»¤è¡Œ åç§° æè¿° bat catçš„ç°ä»£æ›¿ä»£å“ btop topçš„ç°ä»£æ›¿ä»£å“ curlie curlçš„åŠ›é‡ï¼Œhttpieçš„ä½¿ç”¨ä¾¿æ·æ€§ croc è½»æ¾å®‰å…¨åœ°å°†å†…å®¹ä»ä¸€å°è®¡ç®—æœºå‘é€åˆ°å¦ä¸€å°è®¡ç®—æœº difft ç»“æ„åŒ–å·®å¼‚ï¼Œç†è§£è¯­æ³•ã€‚ä¹Ÿå¯ç”¨äºgit diff direnv åŠ è½½æˆ–å¸è½½å½“å‰ç›®å½•ï¼ˆä»¥åŠç›®å½•ï¼‰çš„.envrcæˆ–.env fastfetch åŠŸèƒ½ä¸°å¯Œã€é¢å‘æ€§èƒ½ã€ç±»ä¼¼ neofetch çš„ç³»ç»Ÿä¿¡æ¯å·¥å…· fd findçš„ç°ä»£æ›¿ä»£å“ fzf å‘½ä»¤è¡Œæ¨¡ç³ŠæŸ¥æ‰¾å™¨ grpcurl ä¸cURLç±»ä¼¼ï¼Œä½†é’ˆå¯¹gRPCï¼šä¸gRPCæœåŠ¡å™¨äº¤äº’çš„å‘½ä»¤è¡Œå·¥å…· hyperfine å‘½ä»¤è¡ŒåŸºå‡†æµ‹è¯•å·¥å…· jq å‘½ä»¤è¡ŒJSONå¤„ç†å™¨ lsd lsçš„ç°ä»£æ›¿ä»£å“ mycli MySQLè‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº®çš„ç»ˆç«¯å®¢æˆ·ç«¯ ouch æ”¯æŒå¤šç§æ ¼å¼çš„å‹ç¼©å’Œè§£å‹ç¼©ï¼Œtarã€zipã€7zã€gzã€rarç­‰ pgcli Postgresè‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº®çš„ç»ˆç«¯å®¢æˆ·ç«¯ rg ä¸€ä¸ªé¢å‘è¡Œçš„æœç´¢å·¥å…·ï¼Œå®ƒé€’å½’åœ°æœç´¢å½“å‰ç›®å½•ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ scc ä¸€ä¸ªç±»ä¼¼äºclocã€sloccountå’Œtokeiçš„å·¥å…·ã€‚ç”¨äºç»Ÿè®¡å¤šç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç è¡Œæ•°ã€ç©ºç™½è¡Œã€æ³¨é‡Šè¡Œå’Œæºä»£ç çš„ç‰©ç†è¡Œæ•° sd sedçš„ç°ä»£æ›¿ä»£å“ vivid å…·æœ‰ä¸°å¯Œæ–‡ä»¶ç±»å‹æ•°æ®åº“çš„ä¸»é¢˜åŒ–LS_COLORSç”Ÿæˆå™¨ zoxide æ›´æ™ºèƒ½çš„cdå‘½ä»¤ï¼Œæ”¯æŒjump App åç§° æè¿° iina é€‚ç”¨äºmacOSçš„ç°ä»£è§†é¢‘æ’­æ”¾å™¨ mac-mouse-fix macOSå¹³æ»‘æ»šåŠ¨ </p>
  </div>
  <footer class="entry-footer"><span title='2024-11-25 10:20:20 +0800 CST'>åä¸€æœˆ 25, 2024</span>&nbsp;Â·&nbsp;1 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to è®°å½•å¸¸ç”¨çš„å„ç§å·¥å…·" href="https://zzhaolei.github.io/posts/%E8%AE%B0%E5%BD%95%E5%B8%B8%E7%94%A8%E7%9A%84%E5%90%84%E7%A7%8D%E5%B7%A5%E5%85%B7/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">åäº¿è¡ŒæŒ‘æˆ˜
    </h2>
  </header>
  <div class="entry-content">
    <p> åäº¿è¡ŒæŒ‘æˆ˜ï¼ˆ1ï¸âƒ£ğŸğŸï¸ The One Billion Row Challengeï¼‰
åŸå§‹ä»“åº“
ç›®æ ‡ æ–‡æœ¬æ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—æ°”è±¡ç«™çš„æ¸©åº¦å€¼ã€‚ æ¯è¡Œæ˜¯ä¸€ä¸ªæµ‹é‡å€¼ï¼Œæ ¼å¼ä¸º&lt;string: station name&gt;;&lt;double: measurement&gt;ï¼Œå…¶ä¸­æµ‹é‡å€¼ç²¾ç¡®åˆ°ä¸€ä½å°æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹è¡Œï¼š
1 2 3 4 5 6 7 8 9 10 Hamburg;12.0 Bulawayo;8.9 Palembang;38.8 St. John&#39;s;15.2 Cracow;12.6 Bridgetown;26.9 Istanbul;6.2 Roseau;34.4 Conakry;31.2 Istanbul;23.0 ä»»åŠ¡æ˜¯ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºè¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œè®¡ç®—æ¯ä¸ªæ°”è±¡ç«™çš„æœ€ä½ã€å¹³å‡å’Œæœ€é«˜æ¸©åº¦å€¼ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°stdoutï¼Œ æ ¼å¼å¦‚ä¸‹ï¼ˆæŒ‰æ°”è±¡ç«™åç§°å­—æ¯é¡ºåºæ’åºï¼Œå¹¶ä¸”æ¯ä¸ªæ°”è±¡ç«™çš„ç»“æœå€¼æ ¼å¼ä¸º&lt;min&gt;/&lt;mean&gt;/&lt;max&gt;ï¼Œä¿ç•™ä¸€ä½å°æ•°ç‚¹ï¼‰ï¼š
1 {Abha=-23.0/18.0/59.2, Abidjan=-16.2/26.0/67.3, AbÃ©chÃ©=-10.0/29.4/69.0, Accra=-10.1/26.4/66.4, Addis Ababa=-23.7/16.0/67.0, Adelaide=-27.8/17.3/58.5, ...} é™åˆ¶ åªèƒ½ä½¿ç”¨æ ‡å‡†åº“å®ç°ã€‚
ç”Ÿæˆåäº¿è¡ŒæŒ‘æˆ˜æ‰€éœ€çš„æ•°æ® å…‹éš†åŸå§‹ä»“åº“ï¼š
1 2 3 4 git clone https://github.com/gunnarmorling/1brc cd 1brc/src/main/python python3 create_measurements.py 1000000000 ç”Ÿæˆçš„æ•°æ®ä¼šåœ¨1brc/measurements.txtï¼Œçº¦ä¸º15Giçš„å¤§å°ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-11-23 15:49:21 +0800 CST'>åä¸€æœˆ 23, 2024</span>&nbsp;Â·&nbsp;4 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to åäº¿è¡ŒæŒ‘æˆ˜" href="https://zzhaolei.github.io/posts/%E5%8D%81%E4%BA%BF%E8%A1%8C%E6%8C%91%E6%88%98/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Go åœ¨ Mac æˆ– Linux ä¸Šæ„å»ºåŠ¨æ€åº“
    </h2>
  </header>
  <div class="entry-content">
    <p>Go å¯ä»¥å¯¼å‡º C ABIï¼Œç„¶ååœ¨å…¶å®ƒå…¼å®¹ C ABI çš„è¯­è¨€ä¸­è°ƒç”¨ã€‚
ä¸‹é¢è¯¦ç»†è®²è§£ä¸€ä¸‹ç”¨æ³•ï¼š
Go æ„å»ºåŠ¨æ€åº“ å®šä¹‰ä¸€ä¸ª go æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import &#34;C&#34; //export Add func Add(a, b int) int { return a &#43; b } //export Multiply func Multiply(a, b int) int { return a * b } func main() {} go çš„æ–‡ä»¶åç§°åœ¨å½“å‰ç¤ºä¾‹ä¸­æ— å…³ç´§è¦ï¼Œè¿™é‡Œå®šä¹‰ä¸º main.goã€‚
main å‡½æ•°æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¯ä»¥ä¸ºç©ºã€‚
æ³¨æ„ï¼šä»£ç ä¸­çš„ //export Add è¡¨ç¤ºå¯¼å‡º Add å‡½æ•°ï¼Œexport å’Œ // ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚è¿™æ˜¯ Go ä¸­çš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ï¼Œç±»ä¼¼çš„è¿˜æœ‰ //go:build ç­‰ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-11 10:55:43 +0800 CST'>ä¹æœˆ 11, 2024</span>&nbsp;Â·&nbsp;2 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to Go åœ¨ Mac æˆ– Linux ä¸Šæ„å»ºåŠ¨æ€åº“" href="https://zzhaolei.github.io/posts/go-%E5%9C%A8-mac-%E6%88%96-linux-%E4%B8%8A%E6%9E%84%E5%BB%BA%E5%8A%A8%E6%80%81%E5%BA%93/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">ä½¿ç”¨AWS S3 SDKè®¿é—®é˜¿é‡Œäº‘oss
    </h2>
  </header>
  <div class="entry-content">
    <p> ç›®å‰ä¸šåŠ¡ä¸Šä½¿ç”¨çš„æ˜¯ aws çš„ s3 æœåŠ¡ï¼Œä½†æ˜¯æƒ³å…¼å®¹é˜¿é‡Œäº‘çš„ ossã€‚æ ¹æ®ossçš„æ–‡æ¡£æè¿°ï¼Œossæ”¯æŒä½¿ç”¨ aws çš„ sdk è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹å¤„ç†æµç¨‹ è®¿é—®AWS S3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 package main import ( &#34;context&#34; &#34;log&#34; &#34;os&#34; &#34;github.com/aws/aws-sdk-go-v2/aws&#34; &#34;github.com/aws/aws-sdk-go-v2/config&#34; &#34;github.com/aws/aws-sdk-go-v2/credentials&#34; &#34;github.com/aws/aws-sdk-go-v2/service/s3&#34; ) func NewS3Client() *s3.Client { accessKeyID := os.Getenv(&#34;ACCESS_KEY_ID&#34;) accessKeySecret := os.Getenv(&#34;ACCESS_KEY_SECRET&#34;) cfg, err := config.LoadDefaultConfig( context.TODO(), config.WithCredentialsProvider(credentials.NewStaticCredentialsProvider(accessKeyID, accessKeySecret, &#34;&#34;)), config.WithEndpointResolverWithOptions( aws.EndpointResolverWithOptionsFunc(func(_, _ string, _ ...interface{}) (aws.Endpoint, error) { return aws.Endpoint{ PartitionID: &#34;aws-cn&#34;, URL: &#34;https://s3.cn-northwest-1.amazonaws.com.cn&#34;, SigningRegion: &#34;cn-northwest-1&#34;, }, nil }), ), ) if err != nil { log.Fatal(err) } return s3.NewFromConfig(cfg, func(o *s3.Options) { // æ­¤é€‰é¡¹å¯ç”¨äºè°ƒè¯• // o.ClientLogMode = aws.LogSigning | aws.LogRequest | aws.LogResponseWithBody o.UsePathStyle = true }) } func main() { bucket := os.Getenv(&#34;S3_BUCKET&#34;) uploadKey := os.Getenv(&#34;S3_KEY&#34;) file, _ := os.Open(&#34;test.txt&#34;) client := NewS3Client() _, err := client.PutObject(context.Background(), &amp;s3.PutObjectInput{ Bucket: aws.String(bucket), Key: aws.String(uploadKey), Body: file, }) if err != nil { log.Fatal(err) } } è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ s3 æ–‡ä»¶ä¸Šä¼ ï¼Œé€šè¿‡åœ¨ PutObjectInput ä¸­æŒ‡å®šBucket å‚æ•°çš„å½¢å¼ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-01 10:14:00 +0800 CST'>ä¹æœˆ 1, 2024</span>&nbsp;Â·&nbsp;3 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to ä½¿ç”¨AWS S3 SDKè®¿é—®é˜¿é‡Œäº‘oss" href="https://zzhaolei.github.io/posts/%E4%BD%BF%E7%94%A8aws-s3-sdk%E8%AE%BF%E9%97%AE%E9%98%BF%E9%87%8C%E4%BA%91oss/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Goè®¾è®¡æ¨¡å¼â€”â€”å•ä¾‹æ¨¡å¼
    </h2>
  </header>
  <div class="entry-content">
    <p>ä»‹ç» å•ä¾‹æ¨¡å¼åŒæ—¶è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼š
ä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¾‹å¦‚æ§åˆ¶æŸäº›å…±äº«èµ„æºï¼ˆå¦‚æ•°æ®åº“æˆ–æ–‡ä»¶ï¼‰çš„è®¿é—®æƒé™ ä¸ºè¯¥å®ä¾‹æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®èŠ‚ç‚¹ åœ¨Goä¸­å•ä¾‹æ¨¡å¼æœ‰ä¸¤ç§å®ç°ï¼Œä¸€ç§æ˜¯é¥¿æ±‰å¼ï¼Œä¸€ç§æ˜¯æ‡’æ±‰å¼ã€‚é¥¿æ±‰å¼ç®€å•ï¼Œå¯ä»¥å°†é—®é¢˜åŠæ—©æš´éœ²å‡ºæ¥ï¼Œæ‡’æ±‰å¼è™½ç„¶æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œä½†æ˜¯ä¹Ÿå°†å¯èƒ½çš„é—®é¢˜å»¶è¿Ÿåˆ°äº†ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¸ºäº†å®ç°å¹¶å‘å®‰å…¨ï¼Œä¹Ÿä¸å¾—ä¸åŠ é”ã€‚
é¥¿æ±‰å¼ ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // Package singleton package singleton // singleton é¥¿æ±‰å¼ var singleton *File type File struct{} func init() { singleton = &amp;File{} } func GetInstance() *File { return singleton } å•å…ƒæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package tests import ( &#34;testing&#34; &#34;design-pattern/singleton&#34; &#34;github.com/stretchr/testify/assert&#34; ) // TestSingleton æµ‹è¯•å•ä¾‹ func TestInstance(t *testing.T) { assert.Equal(t, singleton.GetInstance(), singleton.GetInstance()) } // BenchmarkSingleton æµ‹è¯•å¹¶å‘è®¿é—®å•ä¾‹ func BenchmarkInstance(b *testing.B) { b.RunParallel(func(p *testing.PB) { for p.Next() { assert.Equal(b, singleton.GetInstance(), singleton.GetInstance()) } }) } æ‡’æ±‰å¼ ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // Package lazysingleton æ‡’æ±‰å¼å•ä¾‹ package lazysingleton import &#34;sync&#34; var ( lazySingleton *File once sync.Once ) type File struct{} func GetLazyInstance() *File { if lazySingleton == nil { // ä½¿ç”¨sync.Onceæ¥ç¡®ä¿å•ä¾‹åœ¨å¹¶å‘æ—¶åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ once.Do(func() { lazySingleton = &amp;File{} }) } return lazySingleton } å•å…ƒæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package tests import ( &#34;testing&#34; &#34;design-pattern/lazysingleton&#34; &#34;github.com/stretchr/testify/assert&#34; ) // TestLazySingleton æµ‹è¯•æ‡’æ±‰å¼å•ä¾‹ func TestLazyInstance(t *testing.T) { assert.Equal(t, lazysingleton.GetLazyInstance(), lazysingleton.GetLazyInstance()) } // BenchmarkGetLazyInstance æµ‹è¯•æ‡’æ±‰å¼å•ä¾‹ func BenchmarkGetLazyInstance(b *testing.B) { b.RunParallel(func(p *testing.PB) { for p.Next() { assert.Equal(b, lazysingleton.GetLazyInstance(), lazysingleton.GetLazyInstance()) } }) } æµ‹è¯•ç»“æœ 1 2 3 4 5 6 7 8 â¯ go test -bench . goos: darwin goarch: arm64 pkg: design-pattern/tests BenchmarkGetLazyInstance-8 3113553	380.8 ns/op BenchmarkInstance-8 3156261	378.5 ns/op PASS ok design-pattern/tests	3.798s æ ¹æ®benchç»“æœå¯ä»¥å‘ç°åŠ é”ï¼ˆsync.Onceå†…éƒ¨ä½¿ç”¨çš„atomicæ¥è¿›è¡Œå¤„ç†ï¼‰è¿˜æ˜¯ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“çš„ï¼Œä¸è¿‡ä¹Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-01 10:12:00 +0800 CST'>ä¹æœˆ 1, 2024</span>&nbsp;Â·&nbsp;2 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to Goè®¾è®¡æ¨¡å¼â€”â€”å•ä¾‹æ¨¡å¼" href="https://zzhaolei.github.io/posts/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Goè®¾è®¡æ¨¡å¼â€”â€”å¼€é—­åŸåˆ™
    </h2>
  </header>
  <div class="entry-content">
    <p>ä»‹ç» ç®€å•çš„è¯´å°±æ˜¯ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å¯¹æ‰©å±•å¼€æ”¾æ˜¯ä¸ºäº†åº”å¯¹éœ€æ±‚çš„å˜åŒ–ï¼Œå¯¹ä¿®æ”¹å…³é—­å°±æ˜¯ä¸ºäº†ä¿è¯å·²æœ‰ä»£ç çš„ç¨³å®šæ€§ï¼Œæœ€ç»ˆæ˜¯ä¸ºäº†è®©ç³»ç»Ÿæ›´å…·æœ‰å¼¹æ€§ï¼Œèƒ½æ›´å¥½çš„å¤„ç†éœ€æ±‚ã€‚
å¼€é—­åŸåˆ™ä¹ŸåŒ…å«äº†å•ä¸€èŒè´£åŸåˆ™ã€‚
æˆ‘ä»¬ä»¥æ¶ˆæ¯é˜Ÿåˆ—æ¥è¿›è¡Œä¸¾ä¾‹ã€‚
åçš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // Package main å¼€é—­åŸåˆ™ Open-Closed Principle // å¼€é—­åŸåˆ™åŒ…å«äº†ï¼šå•ä¸€èŒè´£åŸåˆ™ package main import &#34;fmt&#34; type KafkaQueue struct{} func (k *KafkaQueue) SendMSG(msg string) error { fmt.Println(&#34;Kafka send msg success&#34;) return nil } type RabbitQueue struct{} func (r *RabbitQueue) SendMSG(msg string) error { fmt.Println(&#34;Rabbitmq send msg success&#34;) return nil } type Demo struct{} func (d *Demo) SendByKafka(queue KafkaQueue, msg string) error { return queue.SendMSG(msg) } func (d *Demo) SendByRabbit(queue RabbitQueue, msg string) error { return queue.SendMSG(msg) } func main() { } é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™æ®µä»£ç è¿èƒŒäº†æˆ‘ä»¬çš„å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­çš„åŸåˆ™ã€‚å½“æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„RocketMQçš„æ—¶å€™ï¼Œéœ€è¦æ”¹åŠ¨Demoçš„é€»è¾‘ä»¥åŠå…¶ä»–è®¾è®¡çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯æ‰©å±•æ€§å¯ä»¥è¯´æ˜¯ä¸€ç‚¹ä¹Ÿæ²¡æœ‰ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-01 10:11:00 +0800 CST'>ä¹æœˆ 1, 2024</span>&nbsp;Â·&nbsp;2 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to Goè®¾è®¡æ¨¡å¼â€”â€”å¼€é—­åŸåˆ™" href="https://zzhaolei.github.io/posts/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Goè®¾è®¡æ¨¡å¼â€”â€”å•ä¸€èŒè´£åŸåˆ™
    </h2>
  </header>
  <div class="entry-content">
    <p>ä»‹ç» ç±»çš„èŒè´£åº”è¯¥æ˜¯å•ä¸€çš„ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»å˜åŒ–çš„åŸå› åº”è¯¥åªæœ‰ä¸€ä¸ªã€‚ç®€å•çš„è¯´å°±æ˜¯æ¯ä¸€ä¸ªç±»åªè´Ÿè´£è‡ªå·±çš„äº‹æƒ…ï¼Œåªæœ‰å•ä¸€çš„åŠŸèƒ½ã€‚
æˆ‘ä»¬ç°åœ¨ä»¥é“¶è¡Œå·¥ä½œäººå‘˜ä¸¾ä¾‹ï¼š
åçš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // Package main å•ä¸€èŒè´£åŸåˆ™ Single-Responsibility Principle package main import &#34;fmt&#34; type Banker struct{} // Save å­˜é’± func (b *Banker) Save(money uint64) error { fmt.Printf(&#34;æˆåŠŸå­˜å…¥: %d\n&#34;, money) return nil } // Transfer è½¬è´¦ func (b *Banker) Transfer(money uint64, to string) error { fmt.Printf(&#34;æˆåŠŸå‘: %sè½¬å…¥: %d\n&#34;, to, money) return nil } å•ä¸€èŒè´£åŸåˆ™è¦æ±‚ä¸€ä¸ªç±»/æ¥å£åªæœ‰ä¸€ä¸ªèŒè´£ï¼Œè€Œå¼•èµ·ç±»å˜åŒ–çš„åŸå› åªèƒ½æœ‰ä¸€ä¸ªã€‚
ä»åŸåˆ™ä¸Šè®²ï¼Œæˆ‘ä»¬ä¸ºBankerå®šä¹‰å­˜é’±å’Œè½¬è´¦çš„æ“ä½œæ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ¥å£ä¸­å®šä¹‰çš„éƒ½æ˜¯é“¶è¡Œå·¥ä½œäººå‘˜å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼Œå¼•èµ·å˜åŒ–çš„åŸå› åªèƒ½æ˜¯Bankerçš„å±æ€§å’Œè¡Œä¸ºå‘ç”Ÿå˜åŒ–ã€‚
ä»è¿™æ–¹ä¾¿è€ƒè™‘ï¼Œè¿™ç§è®¾è®¡æ˜¯æœ‰åˆç†æ€§çš„ï¼Œå¦‚æœèƒ½ä¿è¯éœ€æ±‚ä¸ä¼šå˜åŒ–æˆ–è€…éœ€æ±‚å˜åŒ–çš„å¯èƒ½è¡Œå¾ˆå°ï¼Œé‚£ä¹ˆè¿™ç§è®¾è®¡å°±æ˜¯åˆç†çš„ã€‚
ä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬çŸ¥é“ï¼Œéœ€æ±‚æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œä»Šæ—¥å¢åŠ ä¸€ä¸ªè‚¡ç¥¨ä¸šåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¢åŠ ä¸€ä¸ªè‚¡ç¥¨çš„ç›¸å…³å±æ€§å’Œè¡Œä¸ºï¼Œæˆ‘ä»¬çš„æ¥å£å’Œå®ç°å°±éœ€è¦å…¨éƒ¨å˜åŠ¨ã€‚
æœ€å¥½çš„æ–¹å¼å°±æ˜¯å½“æˆ‘ä»¬å¼€å§‹å®šä¹‰çš„æ—¶å€™ï¼Œæ ¹æ®å±æ€§å’Œè¡Œä¸ºè¿›è¡Œç»†åˆ†ï¼ŒæŠ½è±¡ä¸åŒçš„æ¥å£å‡ºæ¥ï¼Œåœ¨Goé‡Œé¢ä¹Ÿæ˜¯ä¸»å¼ å°æ¥å£ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆçš„æ‰‹æ®µæ¥éšæ„æ„é€ æˆ‘ä»¬æƒ³è¦çš„å¤§æ¥å£ã€‚
å¥½çš„ æˆ‘ä»¬å°†Bankerè¿›è¡ŒæŠ½è±¡ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„è¿›è¡Œæ‰©å±•ï¼š
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // Package main å•ä¸€èŒè´£åŸåˆ™ Single-Responsibility Principle package main import &#34;fmt&#34; type Config struct { Money uint64 To string } type Banker interface { DoSomething(Config) error } type SaveBanker struct{} func (sb *SaveBanker) DoSomething(cfg Config) error { fmt.Printf(&#34;æˆåŠŸå­˜å…¥: %d\n&#34;, cfg.Money) return nil } type TransferBanker struct{} func (tb *TransferBanker) DoSomething(cfg Config) error { fmt.Printf(&#34;æˆåŠŸå‘: %sè½¬å…¥: %d\n&#34;, cfg.To, cfg.Money) return nil } æˆ‘ä»¬æŠ½è±¡å‡ºæ¥äº†Bankeræ¥å£ï¼Œæ¯ä¸€ä¸ªä¸å¤ªçš„ä¸šåŠ¡å‘˜éƒ½å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå¯¹è¡Œä¸ºè¿›è¡Œè‡ªå®šä¹‰ã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-01 10:10:00 +0800 CST'>ä¹æœˆ 1, 2024</span>&nbsp;Â·&nbsp;1 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to Goè®¾è®¡æ¨¡å¼â€”â€”å•ä¸€èŒè´£åŸåˆ™" href="https://zzhaolei.github.io/posts/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">å¦‚ä½•åœ¨Goä¸­ä½¿ç”¨POSIXå‘½åä¿¡å·é‡
    </h2>
  </header>
  <div class="entry-content">
    <p>go æœ¬èº«æä¾›çš„ semaphore åªèƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹å¤šä¸ªåç¨‹æˆ–çº¿ç¨‹é—´ä½¿ç”¨ï¼Œæ— æ³•åœ¨ä¸åŒçš„ go è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ï¼Œæ‰€ä»¥æœ¬æ–‡ä»‹ç»ï¼Œå¦‚ä½•ä½¿ç”¨ go ä¸­çš„ syscall æ¥ä½¿ç”¨ POSIX ç³»ç»Ÿæä¾›çš„å‘½åä¿¡å·é‡ã€‚
Go ä¸­çš„ç³»ç»Ÿè°ƒç”¨ åœ¨ go ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯é€šè¿‡ syscall åŒ…æä¾›çš„ Syscall å‡½æ•°æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„ï¼Œä¸åŒçš„ç³»ç»Ÿè°ƒç”¨æœ‰ä¸åŒçš„ trapï¼Œä»¥åŠä¸åŒé•¿åº¦çš„å‚æ•°ã€‚
trap go åœ¨ syscall åŒ…ä¸­å®šä¹‰äº†å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ç ï¼Œå…·ä½“å®šä¹‰åœ¨æ–‡ä»¶1.20.6/go/src/syscall/zsysnum_darwin_arm64.go ã€‚ä¸åŒæ“ä½œç³»ç»Ÿä¸Šï¼Œå®šä¹‰æ‰€ä½¿ç”¨çš„æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œè¿™äº›å®šä¹‰éƒ½æ˜¯é€šè¿‡ä¸åŒç³»ç»Ÿçš„c è¯­è¨€å¤´æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„ã€‚æ¯”å¦‚ linux amd64 æ“ä½œç³»ç»Ÿçš„å®šä¹‰åœ¨1.20.6/go/src/syscall/zerrors_linux_amd64.goã€‚
ä¸åŒé•¿åº¦çš„å‚æ•° syscall åŒ…æœ‰ Syscallã€Syscall6 ä¸¤ä¸ªå‡½æ•°ï¼Œå¯¹åº”äºä¸åŒçš„æ“ä½œç³»ç»Ÿè°ƒç”¨å‚æ•°é•¿åº¦çš„æƒ…å†µã€‚
Syscall æ€»å…±æ¥æ”¶ 4 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ trap å®šä¹‰ï¼Œæè¿°å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‰©ä¸‹çš„ 3 ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ã€‚
Syscall6 æ€»å…±æ¥æ”¶ 7 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ trap å®šä¹‰ï¼Œæè¿°å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‰©ä¸‹çš„ 6 ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ã€‚
å¦‚æœä½¿ç”¨ Syscall æˆ– Syscall6 æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ä¸æ»¡è¶³å‡½æ•°å½¢å‚æ‰€éœ€çš„æ•°é‡ï¼Œåˆ™å‰©ä¸‹çš„å‚æ•°ä¼ 0ã€‚
ä¾‹å¦‚ï¼Œåœ¨ POSIX ç³»ç»Ÿä¸Šæ‰“å¼€ä¸€ä¸ªå‘½åä¿¡å·é‡çš„ç³»ç»Ÿè°ƒç”¨æ˜¯:
1 sem_t *sem_open(const char *name, int oflag, mode_t mode, unsigned int value); å› ä¸ºç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æœ‰ 4 ä¸ªï¼Œè€Œ Syscall æ¥æ”¶çš„å…¨éƒ¨å½¢å‚æ‰ 4 ä¸ªï¼Œæ‰€ä»¥ Syscall ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œåªèƒ½ä½¿ç”¨ Syscall6 è¿™ä¸ªå‡½æ•°ã€‚è€Œ Syscall6 æ€»å…±éœ€è¦ 7 ä¸ªå½¢å‚ï¼Œå…¶ä¸­æœ‰ 6 ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œæˆ‘ä»¬åªæœ‰ 4 ä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 2 ä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ 0 æ›¿ä»£ï¼Œä¾‹å¦‚ï¼š
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-01 10:09:00 +0800 CST'>ä¹æœˆ 1, 2024</span>&nbsp;Â·&nbsp;3 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to å¦‚ä½•åœ¨Goä¸­ä½¿ç”¨POSIXå‘½åä¿¡å·é‡" href="https://zzhaolei.github.io/posts/%E5%A6%82%E4%BD%95%E5%9C%A8go%E4%B8%AD%E4%BD%BF%E7%94%A8posix%E5%91%BD%E5%90%8D%E4%BF%A1%E5%8F%B7%E9%87%8F/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">å…³äºGo Modulesçš„ä¸€äº›å†…å®¹
    </h2>
  </header>
  <div class="entry-content">
    <p>å¯ç”¨Go Modules go modåœ¨Go &gt;= 1.13æ‰é»˜è®¤å¯ç”¨ï¼Œåœ¨Go &gt;= 1.11å·²ç»å¼€å§‹æ”¯æŒäº†go modã€‚
è®¾ç½®ç¯å¢ƒå˜é‡
1 2 3 4 5 6 7 8 9 # å¯ç”¨go module export GO111MODULE=on # è®¾ç½®GOPATHï¼Œå¼€å¯go modä¹‹åï¼Œè¿™ä¸ªç›®å½•ä¸»è¦ç”¨æ¥å­˜æ”¾ä¾èµ–åŒ… export GOPATH=~/go_modules # è®¾ç½®goä»£ç†ï¼Œåœ¨è¿è¡Œgo test/buildç­‰æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ– # ä½¿ç”¨go getä¸‹è½½ä¾èµ–éœ€è¦åœ¨GOPATHä¸­æ‰§è¡Œæ‰ä¼šä½¿ç”¨ä»£ç† export GOPROXY=https://goproxy.io go modä½¿ç”¨ åœ¨$GOPATH/srcä¹‹å¤–çš„ä»»æ„ç›®å½•åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œ
1 2 mkdir -p /home/gopher/project cd /home/gopher/project è¿™ä¸ªç›®å½•å°±æ˜¯ä½ é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œåœ¨ç›®å½•ä¸­åˆ›å»ºmodç®¡ç†æ–‡ä»¶
1 go mod init project å¦‚æœä½ è¿™ä¸ªé¡¹ç›®æ˜¯æ”¾åœ¨githubä¸Šçš„ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºæ–‡ä»¶çš„æ—¶å€™å¯ä»¥è¿™æ ·å†™ï¼Œprojectä¸ºä½ githubé¡¹ç›®åç§°
1 go mod init github.com/YourName/project go.modçš„åˆå§‹å†…å®¹cat go.modä¸º:
1 2 3 module project go 1.12 go.modåªéœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€æ¬¡å³å¯ï¼Œåœ¨é¡¹ç›®ä¸­Goä¼šè‡ªåŠ¨æŸ¥æ‰¾å½“å‰ç›®å½•çš„å…¨éƒ¨çˆ¶çº§ç›®å½•ï¼Œç›´åˆ°æ‰¾åˆ°go.modã€‚
...</p>
  </div>
  <footer class="entry-footer"><span title='2019-06-01 10:08:00 +0800 CST'>å…­æœˆ 1, 2019</span>&nbsp;Â·&nbsp;1 åˆ†é’Ÿ</footer>
  <a class="entry-link" aria-label="post link to å…³äºGo Modulesçš„ä¸€äº›å†…å®¹" href="https://zzhaolei.github.io/posts/%E5%85%B3%E4%BA%8Ego-modules%E7%9A%84%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9/"></a>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://zzhaolei.github.io/">leiçš„åšå®¢</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>

[{"content":"ç”¨äºGoé¡¹ç›® åç§° æè¿° gopkgview äº¤äº’å¼çš„åŸºäºWebçš„GoåŒ…ä¾èµ–å›¾å¯è§†åŒ– gup æ›´æ–°ç”±go installå®‰è£…çš„äºŒè¿›åˆ¶æ–‡ä»¶ gsa åˆ†æç¼–è¯‘åçš„GoäºŒè¿›åˆ¶æ–‡ä»¶å¤§å°çš„å·¥å…·ï¼Œå¯ä»¥æ¸…æ™°çš„äº†è§£æ¯ä¸ªåŒ…æˆ–ä¾èµ–åœ¨äºŒè¿›åˆ¶ä¸­å ç”¨çš„å¤§å° mockgen gomockæ˜¯Goç¼–ç¨‹è¯­è¨€çš„æ¨¡æ‹Ÿæ¡†æ¶ nilaway é™æ€åˆ†æå·¥å…·ï¼Œç”¨äºæ£€æµ‹Goä»£ç ä¸­çš„æ½œåœ¨nilææ…Œ å‘½ä»¤è¡Œ åç§° æè¿° bat catçš„ç°ä»£æ›¿ä»£å“ curlie curlçš„åŠ›é‡ï¼Œhttpieçš„ä½¿ç”¨ä¾¿æ·æ€§ croc è½»æ¾å®‰å…¨åœ°å°†å†…å®¹ä»ä¸€å°è®¡ç®—æœºå‘é€åˆ°å¦ä¸€å°è®¡ç®—æœº difft ç»“æ„åŒ–å·®å¼‚ï¼Œç†è§£è¯­æ³•ã€‚ä¹Ÿå¯ç”¨äºgit diff direnv åŠ è½½æˆ–å¸è½½å½“å‰ç›®å½•ï¼ˆä»¥åŠç›®å½•ï¼‰çš„.envrcæˆ–.env fastfetch åŠŸèƒ½ä¸°å¯Œã€é¢å‘æ€§èƒ½ã€ç±»ä¼¼ neofetch çš„ç³»ç»Ÿä¿¡æ¯å·¥å…· fd findçš„ç°ä»£æ›¿ä»£å“ fzf å‘½ä»¤è¡Œæ¨¡ç³ŠæŸ¥æ‰¾å™¨ grpcurl ä¸cURLç±»ä¼¼ï¼Œä½†é’ˆå¯¹gRPCï¼šä¸gRPCæœåŠ¡å™¨äº¤äº’çš„å‘½ä»¤è¡Œå·¥å…· htop topçš„æ›¿ä»£å“ã€‚ä¸€ä¸ªäº¤äº’å¼æµç¨‹æŸ¥çœ‹å™¨ hyperfine å‘½ä»¤è¡ŒåŸºå‡†æµ‹è¯•å·¥å…· jq å‘½ä»¤è¡ŒJSONå¤„ç†å™¨ lsd lsçš„ç°ä»£æ›¿ä»£å“ mycli MySQLè‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº®çš„ç»ˆç«¯å®¢æˆ·ç«¯ ouch æ”¯æŒå¤šç§æ ¼å¼çš„å‹ç¼©å’Œè§£å‹ç¼©ï¼Œtarã€zipã€7zã€gzã€rarç­‰ pgcli Postgresè‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº®çš„ç»ˆç«¯å®¢æˆ·ç«¯ rg ä¸€ä¸ªé¢å‘è¡Œçš„æœç´¢å·¥å…·ï¼Œå®ƒé€’å½’åœ°æœç´¢å½“å‰ç›®å½•ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ scc ä¸€ä¸ªç±»ä¼¼äºclocã€sloccountå’Œtokeiçš„å·¥å…·ã€‚ç”¨äºç»Ÿè®¡å¤šç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç è¡Œæ•°ã€ç©ºç™½è¡Œã€æ³¨é‡Šè¡Œå’Œæºä»£ç çš„ç‰©ç†è¡Œæ•° sd sedçš„ç°ä»£æ›¿ä»£å“ vivid å…·æœ‰ä¸°å¯Œæ–‡ä»¶ç±»å‹æ•°æ®åº“çš„ä¸»é¢˜åŒ–LS_COLORSç”Ÿæˆå™¨ zoxide æ›´æ™ºèƒ½çš„cdå‘½ä»¤ï¼Œæ”¯æŒjump App åç§° æè¿° iina é€‚ç”¨äºmacOSçš„ç°ä»£è§†é¢‘æ’­æ”¾å™¨ mac-mouse-fix macOSå¹³æ»‘æ»šåŠ¨ ","permalink":"https://zzhaolei.github.io/posts/%E8%AE%B0%E5%BD%95%E5%B8%B8%E7%94%A8%E7%9A%84%E5%90%84%E7%A7%8D%E5%B7%A5%E5%85%B7/","summary":"\u003ch2 id=\"ç”¨äºgoé¡¹ç›®\"\u003eç”¨äºGoé¡¹ç›®\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eåç§°\u003c/th\u003e\n          \u003cth\u003eæè¿°\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/grishy/gopkgview\"\u003egopkgview\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eäº¤äº’å¼çš„åŸºäº\u003ccode\u003eWeb\u003c/code\u003eçš„\u003ccode\u003eGo\u003c/code\u003eåŒ…ä¾èµ–å›¾å¯è§†åŒ–\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/nao1215/gup\"\u003egup\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eæ›´æ–°ç”±\u003ccode\u003ego install\u003c/code\u003eå®‰è£…çš„äºŒè¿›åˆ¶æ–‡ä»¶\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/Zxilly/go-size-analyzer\"\u003egsa\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eåˆ†æç¼–è¯‘åçš„\u003ccode\u003eGo\u003c/code\u003eäºŒè¿›åˆ¶æ–‡ä»¶å¤§å°çš„å·¥å…·ï¼Œå¯ä»¥æ¸…æ™°çš„äº†è§£æ¯ä¸ªåŒ…æˆ–ä¾èµ–åœ¨äºŒè¿›åˆ¶ä¸­å ç”¨çš„å¤§å°\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/uber-go/mock\"\u003emockgen\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003egomock\u003c/code\u003eæ˜¯\u003ccode\u003eGo\u003c/code\u003eç¼–ç¨‹è¯­è¨€çš„æ¨¡æ‹Ÿæ¡†æ¶\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/uber-go/nilaway\"\u003enilaway\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eé™æ€åˆ†æå·¥å…·ï¼Œç”¨äºæ£€æµ‹\u003ccode\u003eGo\u003c/code\u003eä»£ç ä¸­çš„æ½œåœ¨\u003ccode\u003enil\u003c/code\u003eææ…Œ\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"å‘½ä»¤è¡Œ\"\u003eå‘½ä»¤è¡Œ\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eåç§°\u003c/th\u003e\n          \u003cth\u003eæè¿°\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/sharkdp/bat\"\u003ebat\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003ecat\u003c/code\u003eçš„ç°ä»£æ›¿ä»£å“\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/rs/curlie\"\u003ecurlie\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003ecurl\u003c/code\u003eçš„åŠ›é‡ï¼Œ\u003ccode\u003ehttpie\u003c/code\u003eçš„ä½¿ç”¨ä¾¿æ·æ€§\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/schollz/croc\"\u003ecroc\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eè½»æ¾å®‰å…¨åœ°å°†å†…å®¹ä»ä¸€å°è®¡ç®—æœºå‘é€åˆ°å¦ä¸€å°è®¡ç®—æœº\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/Wilfred/difftastic\"\u003edifft\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eç»“æ„åŒ–å·®å¼‚ï¼Œç†è§£è¯­æ³•ã€‚ä¹Ÿå¯ç”¨äº\u003ccode\u003egit diff\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/direnv/direnv\"\u003edirenv\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eåŠ è½½æˆ–å¸è½½å½“å‰ç›®å½•ï¼ˆä»¥åŠç›®å½•ï¼‰çš„\u003ccode\u003e.envrc\u003c/code\u003eæˆ–\u003ccode\u003e.env\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/fastfetch-cli/fastfetch\"\u003efastfetch\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eåŠŸèƒ½ä¸°å¯Œã€é¢å‘æ€§èƒ½ã€ç±»ä¼¼ neofetch çš„ç³»ç»Ÿä¿¡æ¯å·¥å…·\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/sharkdp/fd\"\u003efd\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003efind\u003c/code\u003eçš„ç°ä»£æ›¿ä»£å“\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/junegunn/fzf\"\u003efzf\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eå‘½ä»¤è¡Œæ¨¡ç³ŠæŸ¥æ‰¾å™¨\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/fullstorydev/grpcurl\"\u003egrpcurl\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eä¸\u003ccode\u003ecURL\u003c/code\u003eç±»ä¼¼ï¼Œä½†é’ˆå¯¹\u003ccode\u003egRPC\u003c/code\u003eï¼šä¸\u003ccode\u003egRPC\u003c/code\u003eæœåŠ¡å™¨äº¤äº’çš„å‘½ä»¤è¡Œå·¥å…·\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/htop-dev/htop\"\u003ehtop\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003etop\u003c/code\u003eçš„æ›¿ä»£å“ã€‚ä¸€ä¸ªäº¤äº’å¼æµç¨‹æŸ¥çœ‹å™¨\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/sharkdp/hyperfine\"\u003ehyperfine\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eå‘½ä»¤è¡ŒåŸºå‡†æµ‹è¯•å·¥å…·\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/jqlang/jq\"\u003ejq\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eå‘½ä»¤è¡Œ\u003ccode\u003eJSON\u003c/code\u003eå¤„ç†å™¨\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/lsd-rs/lsd\"\u003elsd\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003els\u003c/code\u003eçš„ç°ä»£æ›¿ä»£å“\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/dbcli/mycli\"\u003emycli\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003eMySQL\u003c/code\u003eè‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº®çš„ç»ˆç«¯å®¢æˆ·ç«¯\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/ouch-org/ouch\"\u003eouch\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eæ”¯æŒå¤šç§æ ¼å¼çš„å‹ç¼©å’Œè§£å‹ç¼©ï¼Œ\u003ccode\u003etar\u003c/code\u003eã€\u003ccode\u003ezip\u003c/code\u003eã€\u003ccode\u003e7z\u003c/code\u003eã€\u003ccode\u003egz\u003c/code\u003eã€\u003ccode\u003erar\u003c/code\u003eç­‰\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/dbcli/pgcli\"\u003epgcli\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003ePostgres\u003c/code\u003eè‡ªåŠ¨è¡¥å…¨å’Œè¯­æ³•é«˜äº®çš„ç»ˆç«¯å®¢æˆ·ç«¯\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/BurntSushi/ripgrep\"\u003erg\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eä¸€ä¸ªé¢å‘è¡Œçš„æœç´¢å·¥å…·ï¼Œå®ƒé€’å½’åœ°æœç´¢å½“å‰ç›®å½•ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/boyter/scc\"\u003escc\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eä¸€ä¸ªç±»ä¼¼äº\u003ccode\u003ecloc\u003c/code\u003eã€\u003ccode\u003esloccount\u003c/code\u003eå’Œ\u003ccode\u003etokei\u003c/code\u003eçš„å·¥å…·ã€‚ç”¨äºç»Ÿè®¡å¤šç§ç¼–ç¨‹è¯­è¨€çš„ä»£ç è¡Œæ•°ã€ç©ºç™½è¡Œã€æ³¨é‡Šè¡Œå’Œæºä»£ç çš„ç‰©ç†è¡Œæ•°\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/chmln/sd\"\u003esd\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003esed\u003c/code\u003eçš„ç°ä»£æ›¿ä»£å“\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/sharkdp/vivid\"\u003evivid\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eå…·æœ‰ä¸°å¯Œæ–‡ä»¶ç±»å‹æ•°æ®åº“çš„ä¸»é¢˜åŒ–\u003ccode\u003eLS_COLORS\u003c/code\u003eç”Ÿæˆå™¨\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/ajeetdsouza/zoxide\"\u003ezoxide\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eæ›´æ™ºèƒ½çš„\u003ccode\u003ecd\u003c/code\u003eå‘½ä»¤ï¼Œæ”¯æŒ\u003ccode\u003ejump\u003c/code\u003e\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"app\"\u003eApp\u003c/h2\u003e\n\u003ctable\u003e\n  \u003cthead\u003e\n      \u003ctr\u003e\n          \u003cth\u003eåç§°\u003c/th\u003e\n          \u003cth\u003eæè¿°\u003c/th\u003e\n      \u003c/tr\u003e\n  \u003c/thead\u003e\n  \u003ctbody\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/iina/iina\"\u003eiina\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003eé€‚ç”¨äº\u003ccode\u003emacOS\u003c/code\u003eçš„ç°ä»£è§†é¢‘æ’­æ”¾å™¨\u003c/td\u003e\n      \u003c/tr\u003e\n      \u003ctr\u003e\n          \u003ctd\u003e\u003ca href=\"https://github.com/noah-nuebling/mac-mouse-fix\"\u003emac-mouse-fix\u003c/a\u003e\u003c/td\u003e\n          \u003ctd\u003e\u003ccode\u003emacOS\u003c/code\u003eå¹³æ»‘æ»šåŠ¨\u003c/td\u003e\n      \u003c/tr\u003e\n  \u003c/tbody\u003e\n\u003c/table\u003e","title":"è®°å½•å¸¸ç”¨çš„å„ç§å·¥å…·"},{"content":" åäº¿è¡ŒæŒ‘æˆ˜ï¼ˆ1ï¸âƒ£ğŸğŸï¸ The One Billion Row Challengeï¼‰\nåŸå§‹ä»“åº“\nç›®æ ‡ æ–‡æœ¬æ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—æ°”è±¡ç«™çš„æ¸©åº¦å€¼ã€‚ æ¯è¡Œæ˜¯ä¸€ä¸ªæµ‹é‡å€¼ï¼Œæ ¼å¼ä¸º\u0026lt;string: station name\u0026gt;;\u0026lt;double: measurement\u0026gt;ï¼Œå…¶ä¸­æµ‹é‡å€¼ç²¾ç¡®åˆ°ä¸€ä½å°æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹è¡Œï¼š\n1 2 3 4 5 6 7 8 9 10 Hamburg;12.0 Bulawayo;8.9 Palembang;38.8 St. John\u0026#39;s;15.2 Cracow;12.6 Bridgetown;26.9 Istanbul;6.2 Roseau;34.4 Conakry;31.2 Istanbul;23.0 ä»»åŠ¡æ˜¯ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºè¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œè®¡ç®—æ¯ä¸ªæ°”è±¡ç«™çš„æœ€ä½ã€å¹³å‡å’Œæœ€é«˜æ¸©åº¦å€¼ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°stdoutï¼Œ æ ¼å¼å¦‚ä¸‹ï¼ˆæŒ‰æ°”è±¡ç«™åç§°å­—æ¯é¡ºåºæ’åºï¼Œå¹¶ä¸”æ¯ä¸ªæ°”è±¡ç«™çš„ç»“æœå€¼æ ¼å¼ä¸º\u0026lt;min\u0026gt;/\u0026lt;mean\u0026gt;/\u0026lt;max\u0026gt;ï¼Œä¿ç•™ä¸€ä½å°æ•°ç‚¹ï¼‰ï¼š\n1 {Abha=-23.0/18.0/59.2, Abidjan=-16.2/26.0/67.3, AbÃ©chÃ©=-10.0/29.4/69.0, Accra=-10.1/26.4/66.4, Addis Ababa=-23.7/16.0/67.0, Adelaide=-27.8/17.3/58.5, ...} é™åˆ¶ åªèƒ½ä½¿ç”¨æ ‡å‡†åº“å®ç°ã€‚\nç”Ÿæˆåäº¿è¡ŒæŒ‘æˆ˜æ‰€éœ€çš„æ•°æ® å…‹éš†åŸå§‹ä»“åº“ï¼š\n1 2 3 4 git clone https://github.com/gunnarmorling/1brc cd 1brc/src/main/python python3 create_measurements.py 1000000000 ç”Ÿæˆçš„æ•°æ®ä¼šåœ¨1brc/measurements.txtï¼Œçº¦ä¸º15Giçš„å¤§å°ã€‚\nå®ç° æœºå™¨é…ç½®ï¼š\n1 2 3 4 5 goos: darwin goarch: arm64 pkg: demo cpu: Apple M2 core: 8 ä¸‹é¢æ˜¯ä¸€æ­¥æ­¥è¿›è¡Œä¼˜åŒ–çš„é¡ºåºï¼š\n1. åŸºç¡€ç»“æœ å°†ç”Ÿæˆçš„measurements.txtæ–‡ä»¶è½¯é“¾åˆ°å½“å‰ç›®å½•ï¼š\n1 ln -s \u0026lt;path\u0026gt;/1brc/data/measurements.txt measurements.txt å…ˆç¼–è¯‘ï¼Œç„¶åå†æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥å¿½ç•¥æ‰ç¼–è¯‘æ‰€é€ æˆçš„è€—æ—¶ï¼š\n1 2 go build -o base.out baseline/main.go ./base.out measurements.txt \u0026gt; base.txt base.txtæ˜¯åŸºçº¿ç»“æœï¼Œåç»­çš„ä¼˜åŒ–å¯ä»¥å’Œè¿™ä¸ªç»“æœè¿›è¡Œå¯¹æ¯”ã€‚\nè¿™å°†ä¼šæ‰“å°æ¯«ç§’çš„è€—æ—¶ä¿¡æ¯ï¼Œæ‰§è¡Œä¸‰æ¬¡ï¼Œå–å…¶å¹³å‡æ•°ä¸º135656æ¯«ç§’ï¼Œè€—æ—¶çº¦ä¸º135.66ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 2. åç¨‹ å°†æ–‡ä»¶åˆ†å—ï¼Œå¹¶ä½¿ç”¨åç¨‹è¿›è¡Œå¤„ç†ã€‚åç¨‹æ•°é‡éœ€è¦è°ƒè¯•å‡ºä¸€ä¸ªåˆé€‚çš„å€¼ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯25ã€‚\n1 2 go build -o go.out goroutine/main.go ./go.out measurements.txt \u0026gt; go.txt å’Œbase.txtè¿›è¡Œå¯¹æ¯”ï¼Œçœ‹æ˜¯å¦æœ‰å·®å¼‚ï¼š\n1 diff --side-by-side --suppress-common-lines base.txt go.txt å‘½ä»¤çš„è¾“å‡ºç»“æœåº”è¯¥æ˜¾ç¤ºæ²¡æœ‰å·®å¼‚ï¼Œå¹¶ä¸”å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç ä¸º0ã€‚\nå–ä¸‰æ¬¡ç»“æœçš„å¹³å‡æ•°çº¦ä¸º36818æ¯«ç§’ï¼Œè€—æ—¶ä¸º36.812ç§’ã€‚å‡å°‘äº†çº¦98.84ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 3 æ›´å¤šä¼˜åŒ– 3.1 ä¸ä½¿ç”¨scannerï¼Œæ”¹ä¸ºç›´æ¥è¯»å–å›ºå®šç¼“å†²åŒºçš„æ–¹æ¡ˆã€‚\nè¿™æ ·åšå¯ä»¥å‡å°‘å¯¹lineå’Œargsçš„å†…å­˜åˆ†é…ï¼Œç›´æ¥å¼•ç”¨bufferçš„å†…å­˜ï¼Œå»¶ååˆ°å¯¹mapæ“ä½œæ—¶å†è§£æã€‚ æ‰‹åŠ¨è§£ææ¢è¡Œç¬¦å’ŒåŸå¸‚ã€æ¸©åº¦ï¼Œå¼•ç”¨bufferçš„å†…å­˜ï¼Œä¹Ÿå¯ä»¥å‡å°‘ç›´æ¥åˆ†é…ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 func scan(r io.Reader, meas map[string]*Meas) { buffer := make([]byte, BufferSize) remain := make([]byte, 0, BufferSize) for { n, _ := r.Read(buffer[:len(buffer)-len(remain)]) if n == 0 { break } remain = append(remain, buffer[:n]...) var ( cityByte []byte tempByte []byte next bool newBuf = remain ) for { cityByte, tempByte, newBuf, next = parseLine(newBuf) if !next { // æ²¡æœ‰ä¸‹ä¸€è¡Œï¼Œé€€å‡ºå¾ªç¯é‡æ–°è¯»å– copy(remain, newBuf) remain = remain[:len(newBuf)] break } city := string(cityByte) temp, _ := strconv.ParseFloat(string(tempByte), 64) v, ok := meas[city] if !ok { v = \u0026amp;Meas{} meas[city] = v } v.min = min(temp, v.min) v.max = max(temp, v.max) v.sum += temp v.count += 1 } } } func parseLine(buffer []byte) (city []byte, temp []byte, buf []byte, next bool) { end := 0 for i, b := range buffer { if b != \u0026#39;\\n\u0026#39; { continue } next = true end = i break } if !next { buf = buffer return } idx := 0 for i, b := range buffer[:end] { if b == \u0026#39;;\u0026#39; { idx = i break } } city = buffer[:idx] temp = buffer[idx+1 : end] buf = buffer[end+1:] return } å¹³å‡è€—æ—¶çº¦ä¸º17497æ¯«ç§’ï¼Œ17.50ç§’ã€‚å‡å°‘äº†çº¦19.32ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 goroutine-1 17497 3.2 ç°åœ¨ï¼Œæ¯æ¬¡cityéƒ½éœ€è¦è½¬ä¸ºstringï¼ˆcity := string(cityByte)ï¼‰ï¼Œç„¶åå†å»mapä¸­æŸ¥è¯¢ï¼Œè¿™æ ·ä¼šå¹³ç™½å¢åŠ ä¸€æ¬¡ä¸å¿…è¦çš„å†…å­˜åˆ†é…ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æ–°çš„hashå‡½æ•°ç”Ÿæˆkeyã€‚\nåœ¨goæ ‡å‡†åº“ä¸­ï¼Œæœ‰hash/fnvå’Œhash/maphashï¼Œç»è¿‡æµ‹è¯•ï¼Œfnvçš„é€Ÿåº¦å¿«ä¸€äº›ã€‚\nä½¿ç”¨fnvé‡æ„ï¼ˆmapçš„keyç±»å‹ä¹Ÿè¦è¿›è¡Œç›¸åº”çš„ä¿®æ”¹ï¼‰ï¼Œè¿™æ ·cityåªéœ€è¦åˆ†é…ä¸€æ¬¡å³å¯ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 hash.Reset() _, _ = hash.Write(cityByte) key := hash.Sum64() temp, _ := strconv.ParseFloat(string(tempByte), 64) v, ok := meas[key] if !ok { v = \u0026amp;Meas{city: string(cityByte)} meas[key] = v } v.min = min(temp, v.min) v.max = max(temp, v.max) v.sum += temp v.count += 1 å¹³å‡è€—æ—¶çº¦ä¸º13060.66æ¯«ç§’ï¼Œ13.06ç§’ã€‚å‡å°‘äº†çº¦4.437ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 goroutine-1 17497 goroutine-2 13060 3.3 é€šè¿‡goçš„pprofæ¥æŸ¥çœ‹ç«ç„°å›¾ï¼Œè¿›è¡Œé’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚åœ¨mainå‡½æ•°ä¸­å¢åŠ ä»¥ä¸‹ä»£ç ï¼Œä»¥å¯ç”¨cpu pprofï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ... f, err := os.Create(\u0026#34;cpu.prof\u0026#34;) if err != nil { log.Fatal(err) } defer func() { _ = f.Close() }() if err := pprof.StartCPUProfile(f); err != nil { log.Fatal(err) } defer pprof.StopCPUProfile() multiProcess(data, chunks) å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œåœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ï¼š\n1 go tool pprof -http=:8080 cpu.prof ç«ç„°å›¾ï¼š é€šè¿‡æŸ¥çœ‹ç«ç„°å›¾å¯ä»¥å‘ç°ï¼Œstrconv.ParseFloatæ¯”è¾ƒè€—æ—¶ï¼Œå®˜æ–¹çš„å®ç°ä¼šæ¶‰åŠå¾ˆå¤šçš„å¤„ç†ï¼Œä½†æ˜¯å…¶å®æˆ‘ä»¬éƒ½ä¸éœ€è¦ï¼Œåªæ˜¯å‡è®¾å…¨æ˜¯æ ‡å‡†çš„æµ®ç‚¹æ•°å°±è¡Œï¼Œç±»ä¼¼-1.2ï¼Œåªæœ‰ä¸€ä½å°æ•°ã€‚\næ—¢ç„¶å‡è®¾æ•°æ®æ˜¯æ ‡å‡†çš„äº†ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆå°†[]byteçš„æµ®ç‚¹æ•°ï¼Œè½¬ä¸ºæ•´æ•°ï¼Œæœ€åè®¡ç®—çš„æ—¶å€™å†è½¬ä¸ºä¿ç•™ä¸€ä½å°æ•°çš„æµ®ç‚¹æ•°å¤„ç†ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 func parseNumber(data []byte) int64 { var ( result int64 isNegative bool ) for _, b := range data { if b == \u0026#39;-\u0026#39; { isNegative = true continue } if b \u0026gt;= \u0026#39;0\u0026#39; \u0026amp;\u0026amp; b \u0026lt;= \u0026#39;9\u0026#39; { result = result*10 + int64(b-\u0026#39;0\u0026#39;) } } if isNegative { result = -result } return result } å¹³å‡è€—æ—¶çº¦ä¸º10576.33æ¯«ç§’ï¼Œ10.58ç§’ã€‚å‡å°‘äº†çº¦2.48ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 goroutine-1 17497 goroutine-2 13060 goroutine-3 10576 3.4 è°ƒæ•´rectifyChunkä¸­çš„æ ¡æ­£ç»“æŸè¡Œçš„é€»è¾‘ï¼Œå‡å°‘ä¸€æ¬¡è¯»å–çš„bufferä¸º128ï¼Œä¸€è¡Œæ•°æ®ä¸ä¼šå¾ˆé•¿ã€‚\n1 bufio.NewReaderSize(file, 128).ReadBytes(\u0026#39;\\n\u0026#39;) å¹³å‡è€—æ—¶çº¦ä¸º10400.66æ¯«ç§’ï¼Œ10.40ç§’ã€‚å‡å°‘äº†çº¦175.67æ¯«ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 goroutine-1 17497 goroutine-2 13060 goroutine-3 10576 goroutine-4 10400 3.5 é€šè¿‡ä¸€ç•ªæœç´¢å’ŒæŸ¥é˜…èµ„æ–™ï¼Œå‘ç°å¯ä»¥å†æ¬¡ä¼˜åŒ–hashé€Ÿåº¦ï¼ˆå‚è€ƒè¿™ä¸ªæ–‡ç« ï¼‰ã€‚\n1 2 3 4 5 6 7 func hash(name []byte) uint64 { var h uint64 = 5381 for _, b := range name { h = (h \u0026lt;\u0026lt; 5) + h + uint64(b) } return h } å¹³å‡è€—æ—¶çº¦ä¸º10092.33æ¯«ç§’ï¼Œ10.09ç§’ã€‚å‡å°‘äº†çº¦308æ¯«ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 goroutine-1 17497 goroutine-2 13060 goroutine-3 10576 goroutine-4 10400 goroutine-5 10092 3.6 åœ¨go1.24ä¸­ï¼Œé»˜è®¤çš„mapå®ç°æ”¹ä¸ºä½¿ç”¨swiss mapï¼Œé€Ÿåº¦åˆèƒ½å¸¦æ¥æå‡ã€‚ç”±äºgo1.24è¿˜æœªå‘å¸ƒï¼ˆ2024.11.23ï¼‰ï¼Œå¯ä»¥å…ˆä½¿ç”¨gotipæ„å»ºï¼š\n1 2 gotip build -o opt.out optimize/main.go ./opt.out measurements.txt \u0026gt; opt.txt å¹³å‡è€—æ—¶çº¦ä¸º8271.33æ¯«ç§’ï¼Œ8.27ç§’ã€‚å‡å°‘äº†çº¦1.82ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 goroutine-1 17497 goroutine-2 13060 goroutine-3 10576 goroutine-4 10400 goroutine-5 10092 goroutine-6ï¼ˆswissmapï¼‰ 8271 æœ€ç»ˆæˆæœ å¹³å‡è€—æ—¶çº¦ä¸º8271.33æ¯«ç§’ï¼Œ8.27ç§’ã€‚\nç¨‹åº è€—æ—¶ï¼ˆmsï¼‰ baseline 135656 goroutine 36818 goroutine-1 17497 goroutine-2 13060 goroutine-3 10576 goroutine-4 10400 goroutine-5 10092 goroutine-6ï¼ˆswissmapï¼‰ 8271 å¯¹æ¯”æœ€åˆçš„baselineå®ç°ï¼Œæ€§èƒ½æå‡äº†çº¦16.40å€ã€‚\n","permalink":"https://zzhaolei.github.io/posts/%E5%8D%81%E4%BA%BF%E8%A1%8C%E6%8C%91%E6%88%98/","summary":"\u003cblockquote\u003e\n\u003cp\u003eåäº¿è¡ŒæŒ‘æˆ˜ï¼ˆ1ï¸âƒ£ğŸğŸï¸ The One Billion Row Challengeï¼‰\u003c/p\u003e\n\u003cp\u003eåŸå§‹\u003ca href=\"https://github.com/gunnarmorling/1brc\"\u003eä»“åº“\u003c/a\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"ç›®æ ‡\"\u003eç›®æ ‡\u003c/h2\u003e\n\u003cp\u003eæ–‡æœ¬æ–‡ä»¶åŒ…å«äº†ä¸€ç³»åˆ—æ°”è±¡ç«™çš„æ¸©åº¦å€¼ã€‚ æ¯è¡Œæ˜¯ä¸€ä¸ªæµ‹é‡å€¼ï¼Œæ ¼å¼ä¸º\u003ccode\u003e\u0026lt;string: station name\u0026gt;;\u0026lt;double: measurement\u0026gt;\u003c/code\u003eï¼Œå…¶ä¸­æµ‹é‡å€¼ç²¾ç¡®åˆ°ä¸€ä½å°æ•°ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-txt\" data-lang=\"txt\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eHamburg;12.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBulawayo;8.9\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePalembang;38.8\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSt. John\u0026#39;s;15.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eCracow;12.6\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBridgetown;26.9\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIstanbul;6.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eRoseau;34.4\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eConakry;31.2\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eIstanbul;23.0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eä»»åŠ¡æ˜¯ç¼–å†™ä¸€ä¸ªç¨‹åºï¼Œè¯¥ç¨‹åºè¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œè®¡ç®—æ¯ä¸ªæ°”è±¡ç«™çš„æœ€ä½ã€å¹³å‡å’Œæœ€é«˜æ¸©åº¦å€¼ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°\u003ccode\u003estdout\u003c/code\u003eï¼Œ\næ ¼å¼å¦‚ä¸‹ï¼ˆæŒ‰æ°”è±¡ç«™åç§°å­—æ¯é¡ºåºæ’åºï¼Œå¹¶ä¸”æ¯ä¸ªæ°”è±¡ç«™çš„ç»“æœå€¼æ ¼å¼ä¸º\u003ccode\u003e\u0026lt;min\u0026gt;/\u0026lt;mean\u0026gt;/\u0026lt;max\u0026gt;\u003c/code\u003eï¼Œä¿ç•™ä¸€ä½å°æ•°ç‚¹ï¼‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{Abha=-23.0/18.0/59.2, Abidjan=-16.2/26.0/67.3, AbÃ©chÃ©=-10.0/29.4/69.0, Accra=-10.1/26.4/66.4, Addis Ababa=-23.7/16.0/67.0, Adelaide=-27.8/17.3/58.5, ...}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"é™åˆ¶\"\u003eé™åˆ¶\u003c/h2\u003e\n\u003cp\u003eåªèƒ½ä½¿ç”¨æ ‡å‡†åº“å®ç°ã€‚\u003c/p\u003e\n\u003ch3 id=\"ç”Ÿæˆåäº¿è¡ŒæŒ‘æˆ˜æ‰€éœ€çš„æ•°æ®\"\u003eç”Ÿæˆåäº¿è¡ŒæŒ‘æˆ˜æ‰€éœ€çš„æ•°æ®\u003c/h3\u003e\n\u003cp\u003eå…‹éš†åŸå§‹\u003ca href=\"https://github.com/gunnarmorling/1brc\"\u003eä»“åº“\u003c/a\u003eï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit clone https://github.com/gunnarmorling/1brc\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e 1brc/src/main/python\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epython3 create_measurements.py \u003cspan class=\"m\"\u003e1000000000\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eç”Ÿæˆçš„æ•°æ®ä¼šåœ¨\u003ccode\u003e1brc/measurements.txt\u003c/code\u003eï¼Œçº¦ä¸º\u003ccode\u003e15Gi\u003c/code\u003eçš„å¤§å°ã€‚\u003c/p\u003e","title":"åäº¿è¡ŒæŒ‘æˆ˜"},{"content":"Go å¯ä»¥å¯¼å‡º C ABIï¼Œç„¶ååœ¨å…¶å®ƒå…¼å®¹ C ABI çš„è¯­è¨€ä¸­è°ƒç”¨ã€‚\nä¸‹é¢è¯¦ç»†è®²è§£ä¸€ä¸‹ç”¨æ³•ï¼š\nGo æ„å»ºåŠ¨æ€åº“ å®šä¹‰ä¸€ä¸ª go æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ä»£ç ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 package main import \u0026#34;C\u0026#34; //export Add func Add(a, b int) int { return a + b } //export Multiply func Multiply(a, b int) int { return a * b } func main() {} go çš„æ–‡ä»¶åç§°åœ¨å½“å‰ç¤ºä¾‹ä¸­æ— å…³ç´§è¦ï¼Œè¿™é‡Œå®šä¹‰ä¸º main.goã€‚\nmain å‡½æ•°æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¯ä»¥ä¸ºç©ºã€‚\næ³¨æ„ï¼šä»£ç ä¸­çš„ //export Add è¡¨ç¤ºå¯¼å‡º Add å‡½æ•°ï¼Œexport å’Œ // ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚è¿™æ˜¯ Go ä¸­çš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ï¼Œç±»ä¼¼çš„è¿˜æœ‰ //go:build ç­‰ã€‚\nç„¶åæˆ‘ä»¬æ„å»ºåŠ¨æ€åº“ï¼š Linux 1 go build -buildmode=c-shared -o libmylib.so main.go è¿™ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šlibmylib.so å’Œ libmylib.hã€‚\næ³¨æ„ -o é€‰é¡¹æŒ‡å®šçš„åç§°ï¼šlibmylib.soï¼Œåœ¨ linux ä¸Šå¿…é¡»è¿™æ ·å‘½ååŠ¨æ€/é™æ€åº“ï¼Œå…¶ä¸­ mylib æ˜¯æˆ‘ä»¬å®é™…è¦ä½¿ç”¨çš„åç§°ã€‚\nMac 1 go build -buildmode=c-shared -o libmylib.dylib main.go æ³¨æ„ -o é€‰é¡¹æŒ‡å®šçš„åç§°ï¼šlibmylib.dylibï¼Œåœ¨ mac ä¸Šå¿…é¡»è¿™æ ·å‘½ååŠ¨æ€/é™æ€åº“ï¼Œå…¶ä¸­ mylib æ˜¯æˆ‘ä»¬å®é™…è¦ä½¿ç”¨çš„åç§°ã€‚\nä½¿ç”¨ -buildmode=c-archive å¯ä»¥æ„å»ºé™æ€é“¾æ¥åº“\né€šè¿‡è¿™ä¸ªæŒ‡ä»¤ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼šlibmylib.dylib å’Œ libmylib.hï¼Œå…¶ä¸­ .h æ–‡ä»¶æ˜¯æˆ‘ä»¬ä»£ç ä¸­è¦ä½¿ç”¨çš„ï¼Œ.dylib æ˜¯æ„å»ºäºŒè¿›åˆ¶ç¨‹åºæ—¶è¦ä½¿ç”¨çš„ã€‚\nC ä½¿ç”¨åŠ¨æ€åº“ å®šä¹‰ä¸€ä¸ª main.c æ–‡ä»¶ï¼ˆåç§°åœ¨å½“å‰ç¤ºä¾‹ä¸­æ— å…³ç´§è¦ï¼‰ï¼š 1 2 3 4 5 6 7 8 #include \u0026lt;stdio.h\u0026gt; #include \u0026#34;libmylib.h\u0026#34; int main() { printf(\u0026#34;3 + 4 = %d\\n\u0026#34;, Add(3, 4)); printf(\u0026#34;5 * 6 = %d\\n\u0026#34;, Multiply(5, 6)); return 0; } åœ¨ main.c ä¸­æˆ‘ä»¬å¼•å…¥ libmylib.h å¤´æ–‡ä»¶ï¼Œå¹¶è°ƒç”¨åœ¨ Go ä¸­å¯¼å‡ºçš„å‡½æ•°ï¼šAdd å’Œ Multiplyã€‚\næ„å»ºäºŒè¿›åˆ¶ç¨‹åº 1 2 3 zig cc -o main main.c -L. -lmylib # ç­‰ä»·äºä¸‹é¢çš„æ„å»ºè„šæœ¬ # gcc -o main main.c -L. -lmylib æˆ‘ä»¬ä½¿ç”¨ zig cc æ„å»ºäºŒè¿›åˆ¶ç¨‹åºï¼Œå…³äº zig cc çš„ç”¨æ³•å’Œä¼˜ç‚¹ï¼Œå¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚\nä¸Šè¿°å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªåä¸º main çš„äºŒè¿›åˆ¶ç¨‹åºï¼Œè°ƒç”¨æ‰§è¡Œä¸€ä¸‹ï¼š\n1 2 3 4 5 6 7 ./main # å¦‚æœ go æ„å»ºçš„æ˜¯åŠ¨æ€åº“ï¼Œå¹¶ä¸”ä½¿ç”¨ gcc ç¼–è¯‘ï¼Œé‚£ä¹ˆåœ¨ linux ä¸Šéœ€è¦æŒ‡å®š lib çš„è·¯å¾„å†è¿è¡Œï¼š # LD_LIBRARY_PATH=. ./main # Outputs: 3 + 4 = 7 5 * 6 = 30 ","permalink":"https://zzhaolei.github.io/posts/go-%E5%9C%A8-mac-%E6%88%96-linux-%E4%B8%8A%E6%9E%84%E5%BB%BA%E5%8A%A8%E6%80%81%E5%BA%93/","summary":"\u003cp\u003eGo å¯ä»¥å¯¼å‡º C ABIï¼Œç„¶ååœ¨å…¶å®ƒå…¼å®¹ C ABI çš„è¯­è¨€ä¸­è°ƒç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eä¸‹é¢è¯¦ç»†è®²è§£ä¸€ä¸‹ç”¨æ³•ï¼š\u003c/p\u003e\n\u003ch3 id=\"go-æ„å»ºåŠ¨æ€åº“\"\u003eGo æ„å»ºåŠ¨æ€åº“\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003eå®šä¹‰ä¸€ä¸ª go æ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹ä»£ç ï¼š\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;C\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e//export Add\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eAdd\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e//export Multiply\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eMultiply\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ea\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003ea\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"nx\"\u003eb\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003ego çš„æ–‡ä»¶åç§°åœ¨å½“å‰ç¤ºä¾‹ä¸­æ— å…³ç´§è¦ï¼Œè¿™é‡Œå®šä¹‰ä¸º main.goã€‚\u003c/p\u003e\n\u003cp\u003emain å‡½æ•°æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¯ä»¥ä¸ºç©ºã€‚\u003c/p\u003e\n\u003cp\u003eæ³¨æ„ï¼šä»£ç ä¸­çš„ \u003ccode\u003e//export Add\u003c/code\u003e è¡¨ç¤ºå¯¼å‡º Add å‡½æ•°ï¼Œ\u003ccode\u003eexport\u003c/code\u003e å’Œ \u003ccode\u003e//\u003c/code\u003e ä¹‹é—´æ²¡æœ‰ç©ºæ ¼ã€‚è¿™æ˜¯ Go ä¸­çš„ä¸€ç§ç‰¹æ®ŠæŒ‡ä»¤ï¼Œç±»ä¼¼çš„è¿˜æœ‰ \u003ccode\u003e//go:build\u003c/code\u003e ç­‰ã€‚\u003c/p\u003e","title":"Go åœ¨ Mac æˆ– Linux ä¸Šæ„å»ºåŠ¨æ€åº“"},{"content":"Rust main å‡½æ•°åˆ°åº•æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„å‘¢ï¼Ÿ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…³äº main å‡½æ•°çš„ç¤ºä¾‹ï¼š\n1 2 3 4 5 6 use std::error::Error; fn main() -\u0026gt; Result\u0026lt;(), Box\u0026lt;dyn Error\u0026gt;\u0026gt; { println!(\u0026#34;hello world\u0026#34;); Ok(()) } ä»è¿™ä¸ªç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œrust çš„ main å‡½æ•°ç«Ÿç„¶è¿˜å¯ä»¥è¿”å› Result æšä¸¾ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿrust åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„ main å‡½æ•°çš„å‘¢ï¼Ÿ\næ¥ä¸‹æ¥è®©æˆ‘ä»¬å¯¹ rust çš„æºç è¿›è¡Œå‰–æï¼Œçœ‹ä¸€çœ‹ rust åˆ°åº•æ˜¯å¦‚ä½•è¿è¡Œ main å‡½æ•°çš„ã€‚\nRust è¿è¡Œæ—¶ é¦–å…ˆï¼Œåœ¨å‡ ä¹æ‰€æœ‰çš„è¯­è¨€ä¸­ï¼ˆç›®å‰æˆ‘ä¸çŸ¥é“å“ªä¸ªè¯­è¨€ä¼šä¸è¿›è¡Œå¤„ç†ï¼‰ï¼Œåœ¨æ‰§è¡Œç”¨æˆ·çš„ main å‡½æ•°ä¹‹å‰éƒ½éœ€è¦è¿›è¡Œä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚åˆ†é…å †æ ˆã€åˆ›å»ºå¹¶ç»‘å®šä¸»çº¿ç¨‹ã€åˆå§‹åŒ–é€šç”¨å¯„å­˜å™¨ã€åˆå§‹åŒ– GCç­‰ç­‰ã€‚\nè€Œ rust ä¹Ÿä¸ä¾‹å¤–ï¼Œä¹Ÿä¼šåœ¨å®é™…è°ƒç”¨ç”¨æˆ·æ‰§è¡Œçš„ main ä¹‹å‰è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„æ“ä½œã€‚\nä½ æ²¡çœ‹é”™ï¼Œrust ä¹Ÿæ˜¯æœ‰è¿è¡Œæ—¶çš„ï¼Œåªä¸è¿‡è¿™ä¸ªè¿è¡Œæ—¶æ²¡æœ‰ GCï¼Œéå¸¸çš„è½»é‡çº§ï¼Œä¸»è¦æ˜¯æ‰§è¡Œä¸Šé¢æ‰€è¯´çš„åˆå§‹åŒ–æ“ä½œä»¥åŠå¯¹ main å‡½æ•°çš„æ‰§è¡Œå’Œæ”¶å°¾ã€‚\nè®©æˆ‘ä»¬å…ˆä» init å¼€å§‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // åœ¨æ‰§è¡Œ main ä¹‹å‰æ‰§è¡Œ unsafe fn init(argc: isize, argv: *const *const u8, sigpipe: u8) { #[cfg_attr(target_os = \u0026#34;teeos\u0026#34;, allow(unused_unsafe))] unsafe { // å®é™…çš„èµ„æºåˆå§‹åŒ–é€»è¾‘ sys::init(argc, argv, sigpipe) }; // è®¾ç½®ä¸»çº¿ç¨‹ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªåå­— let thread = Thread::new_main(); thread::set_current(thread); } // è¿è¡Œæ—¶åªä¼šæ‰§è¡Œä¸€æ¬¡ cleanupã€‚ // åœ¨ main æˆ–ç¨‹åºé€€å‡ºçš„æ—¶å€™æ‰§è¡Œ // NOTE: å½“ç¨‹åºè¢«ç»ˆæ­¢çš„æ—¶å€™ï¼Œä¸èƒ½ä¿è¯æ‰§è¡Œ cleanup // ï¼ˆç»ˆæ­¢æ˜¯ kill ç­‰å¼ºåˆ¶ç»ˆæ­¢ï¼Œæˆ–æ®µé”™è¯¯ç­‰è¡Œä¸ºï¼Œç¨‹åºæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œèµ„æºç”±æ“ä½œç³»ç»Ÿè¿›è¡Œå›æ”¶ï¼‰ pub(crate) fn cleanup() { static CLEANUP: Once = Once::new(); CLEANUP.call_once(|| unsafe { // åˆ·æ–° stdout ç¼“å†²åŒºçš„æ•°æ®ï¼Œå¹¶ç¦ç”¨ç¼“å†²åŒº crate::io::cleanup(); // SAFETY: é€šè¿‡ Once ä¿è¯ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ cleanup sys::cleanup(); }); } ç³»ç»Ÿèµ„æºçš„åˆå§‹åŒ–å’Œæ¸…ç†åœ¨ sys::init å’Œ sys::cleanup ä¸­ sys::init åœ¨ ffi ä¸­ä¸ä¿è¯è¢«è°ƒç”¨ sys::init çš„æºç ä¸æ˜¯ç®—å¤æ‚ï¼Œä¸»è¦æ˜¯ä¿è¯æ‰“å¼€æ ‡å‡†è¾“å…¥è¾“å‡ºæµã€åˆå§‹åŒ–æ ˆï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œé˜…è¯»æºç  ç°åœ¨æˆ‘ä»¬ç»ˆäºå¯ä»¥è¿›å…¥é‡ç‚¹äº†ï¼Œrust å¯¹ main å‡½æ•°çš„å¤„ç†é€»è¾‘ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #[lang = \u0026#34;start\u0026#34;] fn lang_start\u0026lt;T: crate::process::Termination + \u0026#39;static\u0026gt;( main: fn() -\u0026gt; T, argc: isize, argv: *const *const u8, sigpipe: u8 ) -\u0026gt; isize { let Ok(v) = lang_start_internal( \u0026amp;(move || crate::sys::backtrace::__rust_begin_short_backtrace(main).report().to_i32()), argc, argv, sigpipe ); v } fn lang_start_internal( main: \u0026amp;(dyn (Fn() -\u0026gt; i32) + Sync + crate::panic::RefUnwindSafe), argc: isize, argv: *const *const u8, sigpipe: u8 ) -\u0026gt; Result\u0026lt;isize, !\u0026gt; { use crate::{ mem, panic }; let rt_abort = move |e| { mem::forget(e); rtabort!(\u0026#34;initialization or cleanup bug\u0026#34;); }; // åˆå§‹åŒ–å‚æ•°ã€æ ˆç­‰ä¿¡æ¯ï¼Œå¹¶æ•è·å¯èƒ½çš„å¼‚å¸¸ä¿¡æ¯ï¼Œå±•å¼€å¼‚å¸¸çš„æ ˆè°ƒç”¨è·¯å¾„ panic::catch_unwind(move || unsafe { init(argc, argv, sigpipe) }).map_err(rt_abort)?; // è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„ main å‡½æ•° // è¿™é‡Œä¼šå°è¯•è·å–ç”¨æˆ·è¿”å›çš„ exitcodeï¼Œé€šè¿‡ Termination::report let ret_code = panic ::catch_unwind(move || panic::catch_unwind(main).unwrap_or(101) as isize) .map_err(move |e| { mem::forget(e); rtabort!(\u0026#34;drop of the panic payload panicked\u0026#34;); }); // æ‰§è¡Œæ¸…ç†ç¨‹åº panic::catch_unwind(cleanup).map_err(rt_abort)?; // é€€å‡ºä¸»çº¿ç¨‹ panic::catch_unwind(|| crate::sys::exit_guard::unique_thread_exit()).map_err(rt_abort)?; ret_code } è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æ lang_start å‡½æ•°ï¼š\nåœ¨ lang_start ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°è¢«æ ‡è®°äº† #[lang = \u0026quot;start\u0026quot;] è¿™è¡¨æ˜æ˜¯è¯­è¨€çš„å…¥å£å‡½æ•°ã€‚\nlang_start æœ¬è´¨æ˜¯è°ƒç”¨çš„ lang_start_internal ï¼Œåœ¨ lang_start_internal ä¸­å¯¹èµ„æºè¿›è¡Œåˆå§‹åŒ–ã€æ‰§è¡Œ mainã€æ¸…ç†èµ„æºã€‚\næˆ‘ä»¬å¯ä»¥çœ‹åˆ° lang_start å‡½æ•°çš„å‚æ•°æœ‰ä¸€ä¸ª mainï¼Œè€Œ main çš„ç±»å‹æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç±»å‹å£°æ˜ä¸º fn() â†’ Tï¼ŒT çš„çº¦æŸæ˜¯ T: crate::process::Termination + 'static ï¼Œå¯¹äºæˆ‘ä»¬è¿™æ¬¡åˆ†ææ¥è¯´ï¼Œæœ€é‡è¦çš„æ˜¯ trait Termination ã€‚\nTermination ç›¸å…³ç­¾åï¼ˆåˆ é™¤äº†ä¸€äº›å±æ€§å®ï¼Œä¸å½±å“ç†è§£ï¼‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #[derive(PartialEq, Eq, Clone, Copy)] pub struct ExitCode(u8); impl ExitCode { pub const SUCCESS: ExitCode = ExitCode(EXIT_SUCCESS as _); pub const FAILURE: ExitCode = ExitCode(EXIT_FAILURE as _); #[inline] pub fn as_i32(\u0026amp;self) -\u0026gt; i32 { self.0 as i32 } } impl From\u0026lt;u8\u0026gt; for ExitCode { fn from(code: u8) -\u0026gt; Self { Self(code) } } pub trait Termination { /// Is called to get the representation of the value as status code. /// This status code is returned to the operating system. #[stable(feature = \u0026#34;termination_trait_lib\u0026#34;, since = \u0026#34;1.61.0\u0026#34;)] fn report(self) -\u0026gt; ExitCode; } ç°åœ¨æˆ‘ä»¬çš„ç–‘é—®æœ‰äº†ç­”æ¡ˆï¼Œæ˜¯å› ä¸º Result æšä¸¾å®ç°äº† Terminationï¼Œæ‰€ä»¥ç”¨æˆ·å®šä¹‰çš„ main å‡½æ•°å¯ä»¥è¿”å› Result æšä¸¾ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 #[stable(feature = \u0026#34;termination_trait_lib\u0026#34;, since = \u0026#34;1.61.0\u0026#34;)] impl\u0026lt;T: Termination, E: fmt::Debug\u0026gt; Termination for Result\u0026lt;T, E\u0026gt; { fn report(self) -\u0026gt; ExitCode { match self { Ok(val) =\u0026gt; val.report(), Err(err) =\u0026gt; { io::attempt_print_to_stderr(format_args_nl!(\u0026#34;Error: {err:?}\u0026#34;)); ExitCode::FAILURE } } } } é€šè¿‡ä»£ç  crate::sys::backtrace::__rust_begin_short_backtrace(main).report().to_i32() å¯ä»¥çœ‹åˆ°ï¼Œå®é™…è°ƒç”¨äº† main è¿”å›å€¼çš„ report å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ Result::reportï¼Œè¿™ä¼šè¿”å›ä¸€ä¸ª i32 å€¼ï¼Œç”¨äºæ ‡è¯†ç¨‹åºæ˜¯å¦æ­£å¸¸é€€å‡ºã€‚ __rust_begin_short_backtrace å®é™…å°±æ˜¯ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œç”¨äºé˜²æ­¢å°¾éƒ¨è°ƒç”¨ä¼˜åŒ–çš„ã€‚ æ–°çš„é—®é¢˜åˆå‡ºç°äº† æœ€å¼€å§‹çš„é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åˆæƒ³åˆ°äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ã€‚\næ—¢ç„¶ rust çš„ lang_start éœ€è¦ä¸€ä¸ª fn â†’ T, T: crate::process::Termination + 'static çš„ç±»å‹çº¦æŸï¼Œä¸ºä»€ä¹ˆ main å‡½æ•°ä»€ä¹ˆä¹Ÿä¸è¿”å›ä¹Ÿå¯ä»¥å‘¢ï¼Ÿ\nçœ‹è¿™ä¸ªç¤ºä¾‹ï¼š\n1 2 3 fn main() { println!(\u0026#34;hello world!\u0026#34;); } å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“ï¼Œåœ¨ rust ä¸­å‡½æ•°ä»€ä¹ˆä¹Ÿæ²¡è¿”å›çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä¹Ÿæ˜¯æœ‰è¿”å›çš„ï¼Œåªæ˜¯å¯ä»¥çœç•¥ä¸å†™è€Œå·²ï¼Œä¸Šé¢ç¤ºä¾‹çš„å®é™…è„±ç³–ï¼ˆå‰¥ç¦»è¯­æ³•ç³–ï¼‰å½¢å¼ä¸ºï¼š\n1 2 3 fn main() -\u0026gt; () { println!(\u0026#34;hello world!\u0026#34;); } å³ï¼šé»˜è®¤ä¼šè¿”å›ä¸€ä¸ª()ï¼Œå®é™…ç±»å‹åå­—å«åš unit ï¼Œä¸­æ–‡ä¸€èˆ¬ç§°ä½œå•å…ƒç±»å‹ã€‚\næ°å¥½ï¼Œunit ç±»å‹ï¼Œä¹Ÿå®ç°äº† Termination traiï¼Œæ‰€ä»¥ main å‡½æ•°ä»€ä¹ˆä¹Ÿä¸è¿”å›ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n1 2 3 4 5 6 7 #[stable(feature = \u0026#34;termination_trait_lib\u0026#34;, since = \u0026#34;1.61.0\u0026#34;)] impl Termination for () { #[inline] fn report(self) -\u0026gt; ExitCode { ExitCode::SUCCESS } } å¹¶ä¸” Termination::report ç­¾åè¦æ±‚è¿”å›ä¸€ä¸ª ExitCodeï¼Œè€Œ ExitCode åˆå®ç°äº† From\u0026lt;u8\u0026gt;ï¼Œæ‰€ä»¥å®é™…ä¸Šè¿˜å¯ä»¥åœ¨ main å‡½æ•°ä¸­è¿”å›ä¸€ä¸ª u8 çš„æ•°å­—ã€‚\nä¾‹å¦‚ï¼š\n1 2 3 4 5 6 use std::process::ExitCode; fn main() -\u0026gt; ExitCode { println!(\u0026#34;hello world!\u0026#34;); 0.into() // program success } è¿˜å¯ä»¥è‡ªå®šä¹‰è¿”å›ç±»å‹ï¼Œåªè¦å®ç°äº† Termination å³å¯ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 use std::process::{ExitCode, Termination}; struct MyExit { msg: String, } impl MyExit { fn new(msg: String) -\u0026gt; Self { MyExit { msg } } } impl Termination for MyExit { fn report(self) -\u0026gt; ExitCode { if self.msg.eq(\u0026#34;ok\u0026#34;.into()) { 0.into() } else { 1.into() } } } fn main() -\u0026gt; MyExit { let exit = MyExit::new(\u0026#34;ok\u0026#34;.into()); exit } è¡¥å……èµ„æ–™ rust çš„ lang_start ä¹Ÿæ˜¯è¢«è°ƒç”¨è€…ï¼Œæ˜¯è°ƒç”¨çš„å®ƒå‘¢ï¼Ÿåœ¨ rust ä¸­æœ‰ä¸€ä¸ª create_entry_fn è´Ÿè´£åˆ›å»º entry å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸­ä¼šè°ƒç”¨ lang_start å‡½æ•°ã€‚æºç ã€‚ åœ¨è£¸æœºå¼€å‘ä¸­ï¼ˆno_stdï¼‰ï¼Œé€šå¸¸ main å‡½æ•°æ˜¯ä¸ä¼šè¿”å›çš„ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰ exitcode çš„ã€‚ ","permalink":"https://zzhaolei.github.io/posts/rust-main-%E5%87%BD%E6%95%B0%E6%98%AF%E5%A6%82%E4%BD%95%E8%A2%AB%E6%89%A7%E8%A1%8C%E7%9A%84/","summary":"\u003ch1 id=\"rust-main-å‡½æ•°åˆ°åº•æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„å‘¢\"\u003eRust main å‡½æ•°åˆ°åº•æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„å‘¢ï¼Ÿ\u003c/h1\u003e\n\u003cp\u003eè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªå…³äº main å‡½æ•°çš„ç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-rust\" data-lang=\"rust\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003estd\u003c/span\u003e::\u003cspan class=\"n\"\u003eerror\u003c/span\u003e::\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e-\u0026gt; \u003cspan class=\"nb\"\u003eResult\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"nb\"\u003eBox\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"k\"\u003edyn\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eError\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"fm\"\u003eprintln!\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;hello world\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"nb\"\u003eOk\u003c/span\u003e\u003cspan class=\"p\"\u003e(())\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eä»è¿™ä¸ªç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œrust çš„ main å‡½æ•°ç«Ÿç„¶è¿˜å¯ä»¥è¿”å› Result æšä¸¾ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿrust åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡Œç”¨æˆ·å®šä¹‰çš„ main å‡½æ•°çš„å‘¢ï¼Ÿ\u003c/p\u003e\n\u003cp\u003eæ¥ä¸‹æ¥è®©æˆ‘ä»¬å¯¹ rust çš„æºç è¿›è¡Œå‰–æï¼Œçœ‹ä¸€çœ‹ rust åˆ°åº•æ˜¯å¦‚ä½•è¿è¡Œ main å‡½æ•°çš„ã€‚\u003c/p\u003e\n\u003ch3 id=\"rust-è¿è¡Œæ—¶\"\u003eRust è¿è¡Œæ—¶\u003c/h3\u003e\n\u003cp\u003eé¦–å…ˆï¼Œåœ¨å‡ ä¹æ‰€æœ‰çš„è¯­è¨€ä¸­ï¼ˆç›®å‰æˆ‘ä¸çŸ¥é“å“ªä¸ªè¯­è¨€ä¼šä¸è¿›è¡Œå¤„ç†ï¼‰ï¼Œåœ¨æ‰§è¡Œç”¨æˆ·çš„ main å‡½æ•°ä¹‹å‰éƒ½éœ€è¦è¿›è¡Œä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œæ¯”å¦‚åˆ†é…å †æ ˆã€åˆ›å»ºå¹¶ç»‘å®šä¸»çº¿ç¨‹ã€åˆå§‹åŒ–é€šç”¨å¯„å­˜å™¨ã€åˆå§‹åŒ– GCç­‰ç­‰ã€‚\u003c/p\u003e\n\u003cp\u003eè€Œ rust ä¹Ÿä¸ä¾‹å¤–ï¼Œä¹Ÿä¼šåœ¨å®é™…è°ƒç”¨ç”¨æˆ·æ‰§è¡Œçš„ main ä¹‹å‰è¿›è¡Œä¸€äº›åˆå§‹åŒ–çš„æ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eä½ æ²¡çœ‹é”™ï¼Œrust ä¹Ÿæ˜¯æœ‰è¿è¡Œæ—¶çš„ï¼Œåªä¸è¿‡è¿™ä¸ªè¿è¡Œæ—¶æ²¡æœ‰ GCï¼Œéå¸¸çš„è½»é‡çº§ï¼Œä¸»è¦æ˜¯æ‰§è¡Œä¸Šé¢æ‰€è¯´çš„åˆå§‹åŒ–æ“ä½œä»¥åŠå¯¹ main å‡½æ•°çš„æ‰§è¡Œå’Œæ”¶å°¾ã€‚\u003c/p\u003e\n\u003cp\u003eè®©æˆ‘ä»¬å…ˆä» \u003ccode\u003einit\u003c/code\u003e å¼€å§‹ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-rust\" data-lang=\"rust\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// åœ¨æ‰§è¡Œ main ä¹‹å‰æ‰§è¡Œ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e: \u003cspan class=\"kt\"\u003eisize\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e: \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"kt\"\u003eu8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003esigpipe\u003c/span\u003e: \u003cspan class=\"kt\"\u003eu8\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"cp\"\u003e#[cfg_attr(target_os = \u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;teeos\u0026#34;\u003c/span\u003e\u003cspan class=\"cp\"\u003e, allow(unused_unsafe))]\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\t\t    \u003c/span\u003e\u003cspan class=\"c1\"\u003e// å®é™…çš„èµ„æºåˆå§‹åŒ–é€»è¾‘\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003esys\u003c/span\u003e::\u003cspan class=\"n\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eargv\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003esigpipe\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\t\t\u003c/span\u003e\u003cspan class=\"c1\"\u003e// è®¾ç½®ä¸»çº¿ç¨‹ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªåå­—\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"kd\"\u003elet\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ethread\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eThread\u003c/span\u003e::\u003cspan class=\"n\"\u003enew_main\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"n\"\u003ethread\u003c/span\u003e::\u003cspan class=\"n\"\u003eset_current\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ethread\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"c1\"\u003e// è¿è¡Œæ—¶åªä¼šæ‰§è¡Œä¸€æ¬¡ cleanupã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// åœ¨ main æˆ–ç¨‹åºé€€å‡ºçš„æ—¶å€™æ‰§è¡Œ\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// NOTE: å½“ç¨‹åºè¢«ç»ˆæ­¢çš„æ—¶å€™ï¼Œä¸èƒ½ä¿è¯æ‰§è¡Œ cleanup\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// ï¼ˆç»ˆæ­¢æ˜¯ kill ç­‰å¼ºåˆ¶ç»ˆæ­¢ï¼Œæˆ–æ®µé”™è¯¯ç­‰è¡Œä¸ºï¼Œç¨‹åºæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œèµ„æºç”±æ“ä½œç³»ç»Ÿè¿›è¡Œå›æ”¶ï¼‰\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003epub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003ecrate\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003efn\u003c/span\u003e \u003cspan class=\"nf\"\u003ecleanup\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"k\"\u003estatic\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"no\"\u003eCLEANUP\u003c/span\u003e: \u003cspan class=\"nc\"\u003eOnce\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eOnce\u003c/span\u003e::\u003cspan class=\"n\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"no\"\u003eCLEANUP\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecall_once\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e||\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eunsafe\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"c1\"\u003e// åˆ·æ–° stdout ç¼“å†²åŒºçš„æ•°æ®ï¼Œå¹¶ç¦ç”¨ç¼“å†²åŒº\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"k\"\u003ecrate\u003c/span\u003e::\u003cspan class=\"n\"\u003eio\u003c/span\u003e::\u003cspan class=\"n\"\u003ecleanup\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"c1\"\u003e// SAFETY: é€šè¿‡ Once ä¿è¯ï¼Œåªä¼šæ‰§è¡Œä¸€æ¬¡ cleanup\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003esys\u003c/span\u003e::\u003cspan class=\"n\"\u003ecleanup\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e    \u003c/span\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cul\u003e\n\u003cli\u003eç³»ç»Ÿèµ„æºçš„åˆå§‹åŒ–å’Œæ¸…ç†åœ¨ \u003ccode\u003esys::init\u003c/code\u003e å’Œ \u003ccode\u003esys::cleanup\u003c/code\u003e ä¸­\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003esys::init\u003c/code\u003e åœ¨ \u003ccode\u003effi\u003c/code\u003e ä¸­ä¸ä¿è¯è¢«è°ƒç”¨\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003esys::init\u003c/code\u003e çš„æºç ä¸æ˜¯ç®—å¤æ‚ï¼Œä¸»è¦æ˜¯ä¿è¯æ‰“å¼€æ ‡å‡†è¾“å…¥è¾“å‡ºæµã€åˆå§‹åŒ–æ ˆï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œé˜…è¯»\u003ca href=\"https://github.com/rust-lang/rust/blob/4074d4902dc19ff1bbce1d74ef9ceae15b5f41ce/library/std/src/sys/pal/unix/mod.rs#L44\"\u003eæºç \u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç°åœ¨æˆ‘ä»¬ç»ˆäºå¯ä»¥è¿›å…¥é‡ç‚¹äº†ï¼Œrust å¯¹ main å‡½æ•°çš„å¤„ç†é€»è¾‘ï¼š\u003c/p\u003e","title":"Rust main å‡½æ•°æ˜¯å¦‚ä½•è¢«æ‰§è¡Œçš„"},{"content":" ç›®å‰ä¸šåŠ¡ä¸Šä½¿ç”¨çš„æ˜¯ aws çš„ s3 æœåŠ¡ï¼Œä½†æ˜¯æƒ³å…¼å®¹é˜¿é‡Œäº‘çš„ ossã€‚æ ¹æ®ossçš„æ–‡æ¡£æè¿°ï¼Œossæ”¯æŒä½¿ç”¨ aws çš„ sdk è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹å¤„ç†æµç¨‹ è®¿é—®AWS S3 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 package main import ( \u0026#34;context\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/aws\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/config\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/credentials\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/service/s3\u0026#34; ) func NewS3Client() *s3.Client { accessKeyID := os.Getenv(\u0026#34;ACCESS_KEY_ID\u0026#34;) accessKeySecret := os.Getenv(\u0026#34;ACCESS_KEY_SECRET\u0026#34;) cfg, err := config.LoadDefaultConfig( context.TODO(), config.WithCredentialsProvider(credentials.NewStaticCredentialsProvider(accessKeyID, accessKeySecret, \u0026#34;\u0026#34;)), config.WithEndpointResolverWithOptions( aws.EndpointResolverWithOptionsFunc(func(_, _ string, _ ...interface{}) (aws.Endpoint, error) { return aws.Endpoint{ PartitionID: \u0026#34;aws-cn\u0026#34;, URL: \u0026#34;https://s3.cn-northwest-1.amazonaws.com.cn\u0026#34;, SigningRegion: \u0026#34;cn-northwest-1\u0026#34;, }, nil }), ), ) if err != nil { log.Fatal(err) } return s3.NewFromConfig(cfg, func(o *s3.Options) { // æ­¤é€‰é¡¹å¯ç”¨äºè°ƒè¯• // o.ClientLogMode = aws.LogSigning | aws.LogRequest | aws.LogResponseWithBody o.UsePathStyle = true }) } func main() { bucket := os.Getenv(\u0026#34;S3_BUCKET\u0026#34;) uploadKey := os.Getenv(\u0026#34;S3_KEY\u0026#34;) file, _ := os.Open(\u0026#34;test.txt\u0026#34;) client := NewS3Client() _, err := client.PutObject(context.Background(), \u0026amp;s3.PutObjectInput{ Bucket: aws.String(bucket), Key: aws.String(uploadKey), Body: file, }) if err != nil { log.Fatal(err) } } è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ s3 æ–‡ä»¶ä¸Šä¼ ï¼Œé€šè¿‡åœ¨ PutObjectInput ä¸­æŒ‡å®šBucket å‚æ•°çš„å½¢å¼ã€‚\nä½¿ç”¨ AWS SDK è®¿é—®é˜¿é‡Œäº‘ OSS åŸºäºå®‰å…¨è€ƒè™‘ï¼ŒOSSä»…æ”¯æŒvirtual hostedè®¿é—®æ–¹å¼ã€‚æ‰€ä»¥åœ¨S3è¿ç§»è‡³OSSåï¼Œå®¢æˆ·ç«¯åº”ç”¨éœ€è¦è¿›è¡Œç›¸åº”è®¾ç½®ã€‚éƒ¨åˆ†S3å·¥å…·é»˜è®¤ä½¿ç”¨Path styleï¼Œä¹Ÿéœ€è¦è¿›è¡Œç›¸åº”é…ç½®ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´OSSæŠ¥é”™ï¼Œå¹¶ç¦æ­¢è®¿é—®ã€‚\nVirtual hosted styleæ˜¯æŒ‡å°†Bucketç½®äºHost Headerçš„è®¿é—®æ–¹å¼ã€‚ç¤ºä¾‹ï¼š\n1 https://bucket-name.oss-cn-beijing.aliyuncs.com åŸºäºé˜¿é‡Œäº‘çš„è®¿é—®æ–¹å¼ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œä¸€ç‚¹ç‚¹çš„ä¿®æ”¹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 func NewS3Client(bucket string) *s3.Client { cfg, err := config.LoadDefaultConfig( // ... // ä¿®æ”¹è¿”å›çš„ endpoint ä¸ºé˜¿é‡Œäº‘çš„æœåŠ¡ return aws.Endpoint{ PartitionID: \u0026#34;oss\u0026#34;, URL: fmt.Sprintf(\u0026#34;https://%s.oss-cn-beijing.aliyuncs.com\u0026#34;, bucket), SigningRegion: \u0026#34;cn-beijing\u0026#34;, }, nil }), ), ) // ... return s3.NewFromConfig(cfg, func(o *s3.Options) { o.UsePathStyle = true }) } func main() { // ... client := NewS3Client(bucket) // ... } éœ€è¦æ³¨æ„çš„æ˜¯ aws.Endpoint çš„ URL å­—æ®µçš„ä¿®æ”¹ï¼Œä¸€å®šè¦ç¬¦åˆ oss çš„è®¿é—®çº¦æŸã€‚\nè€Œä¸”åœ¨æœ€åä¹Ÿéœ€è¦è®¾ç½®o.UsePathStyle = trueçš„é€‰é¡¹ã€‚\nå…¶ä»–çš„ç”¨æ³•ä¸å˜ã€‚\nç”¨äºè®¿é—®é˜¿é‡Œäº‘ OSS çš„å®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 package main import ( \u0026#34;context\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/aws\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/config\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/credentials\u0026#34; \u0026#34;github.com/aws/aws-sdk-go-v2/service/s3\u0026#34; ) func NewS3Client(bucket string) *s3.Client { accessKeyID := os.Getenv(\u0026#34;ACCESS_KEY_ID\u0026#34;) accessKeySecret := os.Getenv(\u0026#34;ACCESS_KEY_SECRET\u0026#34;) cfg, err := config.LoadDefaultConfig( context.TODO(), config.WithCredentialsProvider(credentials.NewStaticCredentialsProvider(accessKeyID, accessKeySecret, \u0026#34;\u0026#34;)), config.WithEndpointResolverWithOptions( aws.EndpointResolverWithOptionsFunc(func(_, _ string, _ ...interface{}) (aws.Endpoint, error) { return aws.Endpoint{ PartitionID: \u0026#34;oss\u0026#34;, URL: fmt.Sprintf(\u0026#34;https://%s.oss-cn-beijing.aliyuncs.com\u0026#34;, bucket), SigningRegion: \u0026#34;cn-beijing\u0026#34;, }, nil }), ), ) if err != nil { log.Fatal(err) } return s3.NewFromConfig(cfg, func(o *s3.Options) { o.UsePathStyle = true }) } func main() { bucket := os.Getenv(\u0026#34;S3_BUCKET\u0026#34;) uploadKey := os.Getenv(\u0026#34;S3_KEY\u0026#34;) file, _ := os.Open(\u0026#34;test.txt\u0026#34;) client := NewS3Client(bucket) _, err := client.PutObject(context.Background(), \u0026amp;s3.PutObjectInput{ Bucket: aws.String(bucket), Key: aws.String(uploadKey), Body: file, }) if err != nil { log.Fatal(err) } } é˜¿é‡Œäº‘ OSS è¿ç§»æ–‡æ¡£\n","permalink":"https://zzhaolei.github.io/posts/%E4%BD%BF%E7%94%A8aws-s3-sdk%E8%AE%BF%E9%97%AE%E9%98%BF%E9%87%8C%E4%BA%91oss/","summary":"\u003cul\u003e\n\u003cli\u003eç›®å‰ä¸šåŠ¡ä¸Šä½¿ç”¨çš„æ˜¯ \u003ccode\u003eaws\u003c/code\u003e çš„ \u003ccode\u003es3\u003c/code\u003e æœåŠ¡ï¼Œä½†æ˜¯æƒ³å…¼å®¹é˜¿é‡Œäº‘çš„ \u003ccode\u003eoss\u003c/code\u003eã€‚æ ¹æ®\u003ccode\u003eoss\u003c/code\u003eçš„æ–‡æ¡£æè¿°ï¼Œ\u003ccode\u003eoss\u003c/code\u003eæ”¯æŒä½¿ç”¨ \u003ccode\u003eaws\u003c/code\u003e çš„ \u003ccode\u003esdk\u003c/code\u003e è¿›è¡Œè®¿é—®ï¼Œæ‰€ä»¥è®°å½•ä¸€ä¸‹å¤„ç†æµç¨‹\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"è®¿é—®aws-s3\"\u003eè®¿é—®AWS S3\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;context\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;log\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;os\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/aws/aws-sdk-go-v2/aws\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/aws/aws-sdk-go-v2/config\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/aws/aws-sdk-go-v2/credentials\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/aws/aws-sdk-go-v2/service/s3\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eNewS3Client\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003es3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eClient\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eaccessKeyID\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetenv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ACCESS_KEY_ID\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eaccessKeySecret\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetenv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ACCESS_KEY_SECRET\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003ecfg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eLoadDefaultConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eTODO\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithCredentialsProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecredentials\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewStaticCredentialsProvider\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eaccessKeyID\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eaccessKeySecret\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003econfig\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eWithEndpointResolverWithOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nx\"\u003eaws\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEndpointResolverWithOptionsFunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e...\u003c/span\u003e\u003cspan class=\"kd\"\u003einterface\u003c/span\u003e\u003cspan class=\"p\"\u003e{})\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eaws\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003eaws\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eEndpoint\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\t\u003cspan class=\"nx\"\u003ePartitionID\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"s\"\u003e\u0026#34;aws-cn\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\t\u003cspan class=\"nx\"\u003eURL\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e           \u003cspan class=\"s\"\u003e\u0026#34;https://s3.cn-northwest-1.amazonaws.com.cn\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\t\u003cspan class=\"nx\"\u003eSigningRegion\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;cn-northwest-1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\t\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"p\"\u003e}),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFatal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003es3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNewFromConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecfg\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kd\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eo\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003es3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eOptions\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"c1\"\u003e// æ­¤é€‰é¡¹å¯ç”¨äºè°ƒè¯•\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"c1\"\u003e// o.ClientLogMode = aws.LogSigning | aws.LogRequest | aws.LogResponseWithBody\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003eo\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eUsePathStyle\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003ebucket\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetenv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;S3_BUCKET\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003euploadKey\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetenv\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;S3_KEY\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003e_\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eos\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eOpen\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;test.txt\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eclient\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nf\"\u003eNewS3Client\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003e_\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e:=\u003c/span\u003e \u003cspan class=\"nx\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePutObject\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003econtext\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eBackground\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003es3\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ePutObjectInput\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003eBucket\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nx\"\u003eaws\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ebucket\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003eKey\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e    \u003cspan class=\"nx\"\u003eaws\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eString\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003euploadKey\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003eBody\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e   \u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003eerr\u003c/span\u003e \u003cspan class=\"o\"\u003e!=\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eFatal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eerr\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eè¿™æ˜¯ä¸€ä¸ªç®€å•çš„ \u003ccode\u003es3\u003c/code\u003e æ–‡ä»¶ä¸Šä¼ ï¼Œé€šè¿‡åœ¨ \u003ccode\u003ePutObjectInput\u003c/code\u003e ä¸­æŒ‡å®š\u003ccode\u003eBucket\u003c/code\u003e å‚æ•°çš„å½¢å¼ã€‚\u003c/p\u003e","title":"ä½¿ç”¨AWS S3 SDKè®¿é—®é˜¿é‡Œäº‘oss"},{"content":"ç›®å½•ç»“æ„ 1 2 3 4 5 6 . â”œâ”€â”€ master â”‚ â””â”€â”€ my.cnf â”œâ”€â”€ slave â”‚ â””â”€â”€ my.cnf â””â”€â”€ docker-compose.yml masterï¼šä¸»é…ç½®\nslaveï¼šä»é…ç½®\ndocker-composeï¼šé€šè¿‡ docker-compose è¿›è¡Œå®¹å™¨é…ç½®å’Œå¯åŠ¨\nmaster/my.cnf\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # For advice on how to change settings please see # http://dev.mysql.com/doc/refman/8.3/en/server-configuration-defaults.html [mysqld] host-cache-size=0 skip-name-resolve datadir=/var/lib/mysql socket=/var/run/mysqld/mysqld.sock secure-file-priv=/var/lib/mysql-files user=mysql pid-file=/var/run/mysqld/mysqld.pid # è‡ªå®šä¹‰éƒ¨åˆ† log-bin=master-bin binlog-format=row # row æŒ‰è¡Œé‡æ”¾ï¼Œstatement é‡æ”¾ sql è¯­å¥ï¼Œmixed é»˜è®¤åŸºäº statementï¼Œä¸€æ—¦å‘ç°åŸºäº sql æ— æ³•ç²¾å‡†é‡æ”¾æ—¶ï¼Œä¼šä½¿ç”¨ rowï¼ŒMySQL é»˜è®¤æ˜¯åŸºäº statement çš„å¤åˆ¶ binlog-do-db=test # å¼€å¯ binlog çš„æ•°æ®åº“åï¼Œå¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“ï¼Œé‚£ä¹ˆå¯ä»¥é‡å¤è®¾ç½® server-id=1 # server-id ä¸èƒ½å’Œä»»ä½• ä¸»æˆ–ä» é‡å¤ # è‡ªå®šä¹‰éƒ¨åˆ† [client] socket=/var/run/mysqld/mysqld.sock !includedir /etc/mysql/conf.d/ slave/my.cnf å’Œ master/my.cnf å†…å®¹åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯ server-id ä¸èƒ½é‡å¤\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 # For advice on how to change settings please see # http://dev.mysql.com/doc/refman/8.3/en/server-configuration-defaults.html [mysqld] host-cache-size=0 skip-name-resolve datadir=/var/lib/mysql socket=/var/run/mysqld/mysqld.sock secure-file-priv=/var/lib/mysql-files user=mysql pid-file=/var/run/mysqld/mysqld.pid # è‡ªå®šä¹‰éƒ¨åˆ† log-bin=master-bin binlog-format=row binlog-do-db=test server-id=2 # æ³¨æ„ä¸è¦é‡å¤ # è‡ªå®šä¹‰éƒ¨åˆ† [client] socket=/var/run/mysqld/mysqld.sock !includedir /etc/mysql/conf.d/ docker-compose.yml\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 version: \u0026#39;3\u0026#39; # å®šä¹‰ä¸€ä¸ª networkï¼Œæ–¹ä¾¿ä¸»ä»å®¹å™¨ä¹‹é—´é€šä¿¡ã€‚åå­—å¯ä»¥éšä¾¿èµ·ã€‚ networks: mysql-master-slave-network: driver: bridge # å®šä¹‰æœåŠ¡ services: mysql-master: image: mysql container_name: mysql-master ports: - 3306:3306 volumes: - \u0026#34;./master/:/etc/mysql/conf.d\u0026#34; # å°† master ä¸­çš„é…ç½®æ˜ å°„åˆ°å®¹å™¨å†… environment: MYSQL_ROOT_PASSWORD: root # è®¾ç½® MySQL root å¯†ç  restart: unless-stopped # å¯åŠ¨æ–¹å¼ networks: - mysql-master-slave-network # å¿…é¡»æŒ‡å®šå®¹å™¨çš„ç½‘ç»œï¼Œä¸ç„¶åœ¨ bridge æ¨¡å¼ä¸‹å®¹å™¨æ— æ³•æ­£ç¡®é€šä¿¡ mysql-slave: image: mysql container_name: mysql_slave ports: - 3307:3306 volumes: - \u0026#34;./slave/:/etc/mysql/conf.d\u0026#34; environment: MYSQL_ROOT_PASSWORD: root restart: unless-stopped networks: - mysql-master-slave-network ä¸»ä»è®¾ç½® è·å– master çš„çŠ¶æ€ è¿æ¥è¿› masterï¼Œç„¶åæ‰§è¡ŒæŸ¥çœ‹å‘½ä»¤ 1 2 3 4 5 6 7 $ mycli mysql://root:root@localhost:3306 \u0026gt; show master status; +-------------------+----------+--------------+------------------+-------------------+ | File | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set | +-------------------+----------+--------------+------------------+-------------------+ | master-bin.000003 | 352 | | | | +-------------------+----------+--------------+------------------+-------------------+ File å°±æ˜¯å½“å‰ binlog æ–‡ä»¶ï¼ŒPosition æ˜¯åç§»é‡ï¼Œè¯´æ˜ä¸‹ä¸€æ¡å‘½ä»¤ä»è¿™é‡Œå¼€å§‹ã€‚File å’Œ Position åé¢åœ¨ slave ä¸­ä¼šä½¿ç”¨åˆ°ã€‚\nå¦‚æœæ²¡æœ‰æ•°æ®åº“ï¼Œåˆ™éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¦åˆ™ slave ä¸ä¼šæ­£å¸¸åŒæ­¥ã€‚ï¼ˆslave ä¹Ÿéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªç›¸åŒçš„æ•°æ®åº“ï¼Œæ‰èƒ½å¼€å§‹åŒæ­¥ï¼‰ 1 2 3 \u0026gt; create database test; Query OK, 1 row affected Time: 0.006s é…ç½®ä»åº“ è¿æ¥è¿› slave 1 $ mycli mysql://root:root@localhost:3307 æŸ¥çœ‹ slave çš„çŠ¶æ€ï¼Œé»˜è®¤åº”è¯¥æ˜¯ç©ºçš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 \u0026gt; show slave status\\G; ***************************[ 1. row ]*************************** Slave_IO_State | Master_Host | Master_User | Master_Port | Connect_Retry | Master_Log_File | Read_Master_Log_Pos | Relay_Log_File | Relay_Log_Pos | Relay_Master_Log_File | Slave_IO_Running | Slave_SQL_Running | åˆ›å»ºæ•°æ®åº“ 1 2 3 \u0026gt; create database test; Query OK, 1 row affected Time: 0.006s è¿æ¥åˆ°ä¸»åº“ 1 2 3 \u0026gt; change master to master_host=\u0026#39;mysql-master\u0026#39;,master_user=\u0026#39;root\u0026#39;,master_password=\u0026#39;root\u0026#39;,master_port=3306,master_log_file=\u0026#39;master-bin.000003\u0026#39;,master_log_pos=352; Query OK, 0 rows affected Time: 0.017s master_hostï¼šå¯ä»¥å¡«å†™ mysql-masterï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æŒ‡å®šäº†ä¸»å’Œä»éƒ½åœ¨è¿™ä¸ªç½‘ç»œé‡Œé¢ï¼Œåªæ˜¯ä»–ä»¬çš„ ip ä¸åŒï¼Œdocker ä¼šå¸®æˆ‘ä»¬è¿›è¡Œè½¬å‘\nmaster_portï¼šæ˜¯ä¸»æœºå®¹å™¨å†…éƒ¨çš„ç«¯å£ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ˜ å°„å‡ºæ¥çš„ç«¯å£ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç›´æ¥è¿æ¥çš„å®¹å™¨å†…éƒ¨ã€‚\nmaster_log_fileï¼šå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ master çš„ FIle ä¿¡æ¯ï¼ŒæŒ‡å®šæˆ‘ä»¬çš„ slave ä»è¿™ä¸ª binlog å¼€å§‹åŒæ­¥\nmaster_log_posï¼šå°±æ˜¯æˆ‘ä»¬çœ‹åˆ°çš„ master çš„ Position ä¿¡æ¯ï¼ŒæŒ‡å®šæˆ‘ä»¬çš„ slave ä»è¿™ä¸ªåç§»é‡å¼€å§‹åŒæ­¥\nå…¶ä»–çš„é…ç½®éƒ½æ˜¯ mysql çš„è´¦æˆ·ä¿¡æ¯ã€‚\nå¯åŠ¨ä¸»ä»å¤åˆ¶ 1 2 3 \u0026gt; start slave; Query OK, 0 rows affected Time: 0.018s æŸ¥çœ‹ slave çŠ¶æ€ï¼Œå¦‚æœ Slave_IO_Running å’Œ Slave_SQL_Running éƒ½ä¸º Yesï¼Œåˆ™è¯´æ˜å¯åŠ¨æˆåŠŸï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ˜¾ç¤ºä¸º Noï¼Œåˆ™å¯ä»¥æŸ¥çœ‹ Last_IO_Error æˆ– Last_SQL_Error çš„é”™è¯¯ä¿¡æ¯ã€‚\nå¤±è´¥ç¤ºä¾‹ï¼Œå¯ä»¥çœ‹åˆ° Last_IO_Error å­—æ®µæ˜¾ç¤ºä¸»ä»çš„ server-id é‡å¤äº†ï¼Œæ‰€ä»¥å¯åŠ¨å¤±è´¥ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 \u0026gt; show slave status\\G ***************************[ 1. row ]*************************** Slave_IO_State | Master_Host | mysql-master Master_User | root Master_Port | 3306 Connect_Retry | 60 Master_Log_File | master-bin.000004 Read_Master_Log_Pos | 158 Relay_Log_File | bce0051a5191-relay-bin.000001 Relay_Log_Pos | 4 Relay_Master_Log_File | master-bin.000004 Slave_IO_Running | No Slave_SQL_Running | Yes ... Master_SSL_Verify_Server_Cert | No Last_IO_Errno | 13117 Last_IO_Error | Fatal error: The replica I/O thread stops because source and replica have equal MySQL server ids; these ids must be different for replication to work (or the --replicate-same-server-id option must be used on replica but this does not always make sense; please check the manual before using it). Last_SQL_Errno | 0 Last_SQL_Error | Replicate_Ignore_Server_Ids | ... æˆåŠŸç¤ºä¾‹ï¼ŒSlave_IO_Running å’Œ Slave_SQL_Running å‡ä¸º Yes 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 \u0026gt; show slave status\\G ***************************[ 1. row ]*************************** Slave_IO_State | Waiting for source to send event Master_Host | mysql-master Master_User | root Master_Port | 3306 Connect_Retry | 60 Master_Log_File | master-bin.000003 Read_Master_Log_Pos | 352 Relay_Log_File | 89c93f9a6591-relay-bin.000002 Relay_Log_Pos | 329 Relay_Master_Log_File | master-bin.000003 Slave_IO_Running | Yes Slave_SQL_Running | Yes ... Last_IO_Errno | 0 Last_IO_Error | Last_SQL_Errno | 0 Last_SQL_Error | Replicate_Ignore_Server_Ids | ... æµ‹è¯•åŒæ­¥ è¿æ¥åˆ° masterï¼Œåœ¨ test åº“ä¸­æ–°å»ºä¸€ä¸ªè¡¨ 1 2 3 4 5 6 7 8 9 10 $ mycli mysql://root:root@localhost:3306 \u0026gt; use test; \u0026gt; create table T ( -\u0026gt; id int primary key, -\u0026gt; a int, -\u0026gt; b int, -\u0026gt; c int -\u0026gt; ) Query OK, 0 rows affected Time: 0.027s è¿æ¥åˆ° slaveï¼Œè¿›å…¥ test åº“æŸ¥çœ‹æ‰€æœ‰çš„è¡¨ï¼Œä¼šå‘ç°è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ª T è¡¨ 1 2 3 4 5 6 7 8 9 10 11 $ mycli mysql://root:root@localhost:3307 \u0026gt; use test; \u0026gt; show tables; +-------------------+ | Tables_in_test | +-------------------+ | T | +-------------------+ 1 rows in set Time: 0.010s ","permalink":"https://zzhaolei.github.io/posts/%E9%80%9A%E8%BF%87docker%E9%85%8D%E7%BD%AEmysql%E4%B8%BB%E4%BB%8E%E6%9C%8D%E5%8A%A1/","summary":"\u003ch2 id=\"ç›®å½•ç»“æ„\"\u003eç›®å½•ç»“æ„\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eâ”œâ”€â”€\u003c/span\u003e \u003cspan class=\"nx\"\u003emaster\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eâ”‚\u003c/span\u003e  \u003cspan class=\"err\"\u003eâ””â”€â”€\u003c/span\u003e \u003cspan class=\"nx\"\u003emy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecnf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eâ”œâ”€â”€\u003c/span\u003e \u003cspan class=\"nx\"\u003eslave\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eâ”‚\u003c/span\u003e  \u003cspan class=\"err\"\u003eâ””â”€â”€\u003c/span\u003e \u003cspan class=\"nx\"\u003emy\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ecnf\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003eâ””â”€â”€\u003c/span\u003e \u003cspan class=\"nx\"\u003edocker\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ecompose\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eyml\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003emaster\u003c/code\u003eï¼šä¸»é…ç½®\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eslave\u003c/code\u003eï¼šä»é…ç½®\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003edocker-compose\u003c/code\u003eï¼šé€šè¿‡ docker-compose è¿›è¡Œå®¹å™¨é…ç½®å’Œå¯åŠ¨\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003emaster/my.cnf\u003c/strong\u003e\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"nx\"\u003eFor\u003c/span\u003e \u003cspan class=\"nx\"\u003eadvice\u003c/span\u003e \u003cspan class=\"nx\"\u003eon\u003c/span\u003e \u003cspan class=\"nx\"\u003ehow\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"nx\"\u003echange\u003c/span\u003e \u003cspan class=\"nx\"\u003esettings\u003c/span\u003e \u003cspan class=\"nx\"\u003eplease\u003c/span\u003e \u003cspan class=\"nx\"\u003esee\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"nx\"\u003ehttp\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"c1\"\u003e//dev.mysql.com/doc/refman/8.3/en/server-configuration-defaults.html\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003emysqld\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ecache\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003esize\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eskip\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eresolve\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003edatadir\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysql\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003esocket\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003erun\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysqld\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysqld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esock\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003esecure\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003epriv\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003elib\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysql\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003efiles\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003euser\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003emysql\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003epid\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003efile\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003erun\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysqld\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysqld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003epid\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"nx\"\u003eè‡ªå®šä¹‰éƒ¨åˆ†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003elog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ebin\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003emaster\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003ebin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ebinlog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eformat\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003erow\u003c/span\u003e  \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"nx\"\u003erow\u003c/span\u003e \u003cspan class=\"nx\"\u003eæŒ‰è¡Œé‡æ”¾\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"nx\"\u003estatement\u003c/span\u003e \u003cspan class=\"nx\"\u003eé‡æ”¾\u003c/span\u003e \u003cspan class=\"nx\"\u003esql\u003c/span\u003e \u003cspan class=\"nx\"\u003eè¯­å¥\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"nx\"\u003emixed\u003c/span\u003e \u003cspan class=\"nx\"\u003eé»˜è®¤åŸºäº\u003c/span\u003e \u003cspan class=\"nx\"\u003estatement\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"nx\"\u003eä¸€æ—¦å‘ç°åŸºäº\u003c/span\u003e \u003cspan class=\"nx\"\u003esql\u003c/span\u003e \u003cspan class=\"nx\"\u003eæ— æ³•ç²¾å‡†é‡æ”¾æ—¶\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"nx\"\u003eä¼šä½¿ç”¨\u003c/span\u003e \u003cspan class=\"nx\"\u003erow\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"nx\"\u003eMySQL\u003c/span\u003e \u003cspan class=\"nx\"\u003eé»˜è®¤æ˜¯åŸºäº\u003c/span\u003e \u003cspan class=\"nx\"\u003estatement\u003c/span\u003e \u003cspan class=\"nx\"\u003eçš„å¤åˆ¶\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003ebinlog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003edo\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003edb\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"nx\"\u003etest\u003c/span\u003e  \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"nx\"\u003eå¼€å¯\u003c/span\u003e \u003cspan class=\"nx\"\u003ebinlog\u003c/span\u003e \u003cspan class=\"nx\"\u003eçš„æ•°æ®åº“å\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"nx\"\u003eå¦‚æœæœ‰å¤šä¸ªæ•°æ®åº“\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼Œ\u003c/span\u003e\u003cspan class=\"nx\"\u003eé‚£ä¹ˆå¯ä»¥é‡å¤è®¾ç½®\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e  \u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"nx\"\u003eserver\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"nx\"\u003eid\u003c/span\u003e \u003cspan class=\"nx\"\u003eä¸èƒ½å’Œä»»ä½•\u003c/span\u003e \u003cspan class=\"nx\"\u003eä¸»æˆ–ä»\u003c/span\u003e \u003cspan class=\"nx\"\u003eé‡å¤\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"err\"\u003e#\u003c/span\u003e \u003cspan class=\"nx\"\u003eè‡ªå®šä¹‰éƒ¨åˆ†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"nx\"\u003eclient\u003c/span\u003e\u003cspan class=\"p\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nx\"\u003esocket\u003c/span\u003e\u003cspan class=\"p\"\u003e=\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003erun\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysqld\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysqld\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003esock\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e!\u003c/span\u003e\u003cspan class=\"nx\"\u003eincludedir\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003eetc\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003emysql\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"nx\"\u003econf\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eslave/my.cnf\u003c/strong\u003e å’Œ master/my.cnf å†…å®¹åŸºæœ¬ä¸€è‡´ï¼Œä½†æ˜¯ server-id ä¸èƒ½é‡å¤\u003c/p\u003e","title":"é€šè¿‡dockeré…ç½®MySQLä¸»ä»æœåŠ¡"},{"content":"ä»‹ç» å•ä¾‹æ¨¡å¼åŒæ—¶è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼š\nä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¾‹å¦‚æ§åˆ¶æŸäº›å…±äº«èµ„æºï¼ˆå¦‚æ•°æ®åº“æˆ–æ–‡ä»¶ï¼‰çš„è®¿é—®æƒé™ ä¸ºè¯¥å®ä¾‹æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®èŠ‚ç‚¹ åœ¨Goä¸­å•ä¾‹æ¨¡å¼æœ‰ä¸¤ç§å®ç°ï¼Œä¸€ç§æ˜¯é¥¿æ±‰å¼ï¼Œä¸€ç§æ˜¯æ‡’æ±‰å¼ã€‚é¥¿æ±‰å¼ç®€å•ï¼Œå¯ä»¥å°†é—®é¢˜åŠæ—©æš´éœ²å‡ºæ¥ï¼Œæ‡’æ±‰å¼è™½ç„¶æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œä½†æ˜¯ä¹Ÿå°†å¯èƒ½çš„é—®é¢˜å»¶è¿Ÿåˆ°äº†ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¸ºäº†å®ç°å¹¶å‘å®‰å…¨ï¼Œä¹Ÿä¸å¾—ä¸åŠ é”ã€‚\né¥¿æ±‰å¼ ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // Package singleton package singleton // singleton é¥¿æ±‰å¼ var singleton *File type File struct{} func init() { singleton = \u0026amp;File{} } func GetInstance() *File { return singleton } å•å…ƒæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package tests import ( \u0026#34;testing\u0026#34; \u0026#34;design-pattern/singleton\u0026#34; \u0026#34;github.com/stretchr/testify/assert\u0026#34; ) // TestSingleton æµ‹è¯•å•ä¾‹ func TestInstance(t *testing.T) { assert.Equal(t, singleton.GetInstance(), singleton.GetInstance()) } // BenchmarkSingleton æµ‹è¯•å¹¶å‘è®¿é—®å•ä¾‹ func BenchmarkInstance(b *testing.B) { b.RunParallel(func(p *testing.PB) { for p.Next() { assert.Equal(b, singleton.GetInstance(), singleton.GetInstance()) } }) } æ‡’æ±‰å¼ ä»£ç  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // Package lazysingleton æ‡’æ±‰å¼å•ä¾‹ package lazysingleton import \u0026#34;sync\u0026#34; var ( lazySingleton *File once sync.Once ) type File struct{} func GetLazyInstance() *File { if lazySingleton == nil { // ä½¿ç”¨sync.Onceæ¥ç¡®ä¿å•ä¾‹åœ¨å¹¶å‘æ—¶åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ once.Do(func() { lazySingleton = \u0026amp;File{} }) } return lazySingleton } å•å…ƒæµ‹è¯• 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 package tests import ( \u0026#34;testing\u0026#34; \u0026#34;design-pattern/lazysingleton\u0026#34; \u0026#34;github.com/stretchr/testify/assert\u0026#34; ) // TestLazySingleton æµ‹è¯•æ‡’æ±‰å¼å•ä¾‹ func TestLazyInstance(t *testing.T) { assert.Equal(t, lazysingleton.GetLazyInstance(), lazysingleton.GetLazyInstance()) } // BenchmarkGetLazyInstance æµ‹è¯•æ‡’æ±‰å¼å•ä¾‹ func BenchmarkGetLazyInstance(b *testing.B) { b.RunParallel(func(p *testing.PB) { for p.Next() { assert.Equal(b, lazysingleton.GetLazyInstance(), lazysingleton.GetLazyInstance()) } }) } æµ‹è¯•ç»“æœ 1 2 3 4 5 6 7 8 â¯ go test -bench . goos: darwin goarch: arm64 pkg: design-pattern/tests BenchmarkGetLazyInstance-8 3113553\t380.8 ns/op BenchmarkInstance-8 3156261\t378.5 ns/op PASS ok design-pattern/tests\t3.798s æ ¹æ®benchç»“æœå¯ä»¥å‘ç°åŠ é”ï¼ˆsync.Onceå†…éƒ¨ä½¿ç”¨çš„atomicæ¥è¿›è¡Œå¤„ç†ï¼‰è¿˜æ˜¯ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“çš„ï¼Œä¸è¿‡ä¹Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚\n","permalink":"https://zzhaolei.github.io/posts/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/","summary":"\u003ch2 id=\"ä»‹ç»\"\u003eä»‹ç»\u003c/h2\u003e\n\u003cp\u003eå•ä¾‹æ¨¡å¼åŒæ—¶è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹\u003c/strong\u003eï¼Œä¾‹å¦‚æ§åˆ¶æŸäº›å…±äº«èµ„æºï¼ˆå¦‚æ•°æ®åº“æˆ–æ–‡ä»¶ï¼‰çš„è®¿é—®æƒé™\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eä¸ºè¯¥å®ä¾‹æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®èŠ‚ç‚¹\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eGo\u003c/code\u003eä¸­å•ä¾‹æ¨¡å¼æœ‰ä¸¤ç§å®ç°ï¼Œä¸€ç§æ˜¯\u003ccode\u003eé¥¿æ±‰å¼\u003c/code\u003eï¼Œä¸€ç§æ˜¯\u003ccode\u003eæ‡’æ±‰å¼\u003c/code\u003eã€‚\u003ccode\u003eé¥¿æ±‰å¼\u003c/code\u003eç®€å•ï¼Œå¯ä»¥å°†é—®é¢˜åŠæ—©æš´éœ²å‡ºæ¥ï¼Œ\u003ccode\u003eæ‡’æ±‰å¼\u003c/code\u003eè™½ç„¶æ”¯æŒå»¶è¿ŸåŠ è½½ï¼Œä½†æ˜¯ä¹Ÿå°†å¯èƒ½çš„é—®é¢˜å»¶è¿Ÿåˆ°äº†ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¸ºäº†å®ç°å¹¶å‘å®‰å…¨ï¼Œä¹Ÿä¸å¾—ä¸åŠ é”ã€‚\u003c/p\u003e\n\u003ch2 id=\"é¥¿æ±‰å¼\"\u003eé¥¿æ±‰å¼\u003c/h2\u003e\n\u003ch3 id=\"ä»£ç \"\u003eä»£ç \u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Package singleton\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// singleton é¥¿æ±‰å¼\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eFile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eFile\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003einit\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eFile\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"å•å…ƒæµ‹è¯•\"\u003eå•å…ƒæµ‹è¯•\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003etests\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;testing\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;design-pattern/singleton\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/stretchr/testify/assert\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// TestSingleton æµ‹è¯•å•ä¾‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eTestInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etesting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// BenchmarkSingleton æµ‹è¯•å¹¶å‘è®¿é—®å•ä¾‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eBenchmarkInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etesting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunParallel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ep\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etesting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ePB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003esingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"æ‡’æ±‰å¼\"\u003eæ‡’æ±‰å¼\u003c/h2\u003e\n\u003ch3 id=\"ä»£ç -1\"\u003eä»£ç \u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Package lazysingleton æ‡’æ±‰å¼å•ä¾‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003elazysingleton\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;sync\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003evar\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003elazySingleton\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eFile\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eonce\u003c/span\u003e          \u003cspan class=\"nx\"\u003esync\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eOnce\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eFile\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eGetLazyInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eFile\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nx\"\u003elazySingleton\u003c/span\u003e \u003cspan class=\"o\"\u003e==\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"c1\"\u003e// ä½¿ç”¨sync.Onceæ¥ç¡®ä¿å•ä¾‹åœ¨å¹¶å‘æ—¶åªè¢«åˆå§‹åŒ–ä¸€æ¬¡\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"nx\"\u003eonce\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eDo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nx\"\u003elazySingleton\u003c/span\u003e \u003cspan class=\"p\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"nx\"\u003eFile\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003elazySingleton\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch3 id=\"å•å…ƒæµ‹è¯•-1\"\u003eå•å…ƒæµ‹è¯•\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003etests\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;testing\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;design-pattern/lazysingleton\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"s\"\u003e\u0026#34;github.com/stretchr/testify/assert\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// TestLazySingleton æµ‹è¯•æ‡’æ±‰å¼å•ä¾‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eTestLazyInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etesting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003et\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003elazysingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetLazyInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003elazysingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetLazyInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// BenchmarkGetLazyInstance æµ‹è¯•æ‡’æ±‰å¼å•ä¾‹\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003eBenchmarkGetLazyInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etesting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eRunParallel\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ep\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003etesting\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003ePB\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"nx\"\u003ep\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eNext\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\t\u003cspan class=\"nx\"\u003eassert\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eEqual\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003elazysingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetLazyInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e(),\u003c/span\u003e \u003cspan class=\"nx\"\u003elazysingleton\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eGetLazyInstance\u003c/span\u003e\u003cspan class=\"p\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"p\"\u003e})\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"æµ‹è¯•ç»“æœ\"\u003eæµ‹è¯•ç»“æœ\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eâ¯ go \u003cspan class=\"nb\"\u003etest\u003c/span\u003e -bench .\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egoos: darwin\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egoarch: arm64\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003epkg: design-pattern/tests\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBenchmarkGetLazyInstance-8   \t 3113553\t       380.8 ns/op\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eBenchmarkInstance-8          \t 3156261\t       378.5 ns/op\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ePASS\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eok  \tdesign-pattern/tests\t3.798s\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eæ ¹æ®benchç»“æœå¯ä»¥å‘ç°åŠ é”ï¼ˆsync.Onceå†…éƒ¨ä½¿ç”¨çš„atomicæ¥è¿›è¡Œå¤„ç†ï¼‰è¿˜æ˜¯ä¼šå¯¹æ€§èƒ½é€ æˆå½±å“çš„ï¼Œä¸è¿‡ä¹Ÿåœ¨å¯æ¥å—èŒƒå›´å†…ã€‚\u003c/p\u003e","title":"Goè®¾è®¡æ¨¡å¼â€”â€”å•ä¾‹æ¨¡å¼"},{"content":"ä»‹ç» ç®€å•çš„è¯´å°±æ˜¯ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å¯¹æ‰©å±•å¼€æ”¾æ˜¯ä¸ºäº†åº”å¯¹éœ€æ±‚çš„å˜åŒ–ï¼Œå¯¹ä¿®æ”¹å…³é—­å°±æ˜¯ä¸ºäº†ä¿è¯å·²æœ‰ä»£ç çš„ç¨³å®šæ€§ï¼Œæœ€ç»ˆæ˜¯ä¸ºäº†è®©ç³»ç»Ÿæ›´å…·æœ‰å¼¹æ€§ï¼Œèƒ½æ›´å¥½çš„å¤„ç†éœ€æ±‚ã€‚\nå¼€é—­åŸåˆ™ä¹ŸåŒ…å«äº†å•ä¸€èŒè´£åŸåˆ™ã€‚\næˆ‘ä»¬ä»¥æ¶ˆæ¯é˜Ÿåˆ—æ¥è¿›è¡Œä¸¾ä¾‹ã€‚\nåçš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 // Package main å¼€é—­åŸåˆ™ Open-Closed Principle // å¼€é—­åŸåˆ™åŒ…å«äº†ï¼šå•ä¸€èŒè´£åŸåˆ™ package main import \u0026#34;fmt\u0026#34; type KafkaQueue struct{} func (k *KafkaQueue) SendMSG(msg string) error { fmt.Println(\u0026#34;Kafka send msg success\u0026#34;) return nil } type RabbitQueue struct{} func (r *RabbitQueue) SendMSG(msg string) error { fmt.Println(\u0026#34;Rabbitmq send msg success\u0026#34;) return nil } type Demo struct{} func (d *Demo) SendByKafka(queue KafkaQueue, msg string) error { return queue.SendMSG(msg) } func (d *Demo) SendByRabbit(queue RabbitQueue, msg string) error { return queue.SendMSG(msg) } func main() { } é€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™æ®µä»£ç è¿èƒŒäº†æˆ‘ä»¬çš„å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­çš„åŸåˆ™ã€‚å½“æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„RocketMQçš„æ—¶å€™ï¼Œéœ€è¦æ”¹åŠ¨Demoçš„é€»è¾‘ä»¥åŠå…¶ä»–è®¾è®¡çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯æ‰©å±•æ€§å¯ä»¥è¯´æ˜¯ä¸€ç‚¹ä¹Ÿæ²¡æœ‰ã€‚\nå¥½çš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 // Package main å¼€é—­åŸåˆ™ Open-Closed Principle // å¼€é—­åŸåˆ™åŒ…å«äº†ï¼šå•ä¸€èŒè´£åŸåˆ™ package main import \u0026#34;fmt\u0026#34; // MsgFomatter é€šè¿‡Formatçš„æŠ½è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€stringã€intã€imageã€videoç­‰ç­‰æ•°æ®ç±»å‹ type MsgFomatter interface { Format() string } type Queue interface { SendMsg(MsgFomatter) error } type KafkaQueue struct{} func (k *KafkaQueue) SendMsg(msg MsgFomatter) error { fmt.Printf(\u0026#34;Kafka send msg success: %s\\n\u0026#34;, msg.Format()) return nil } type RabbitQueue struct{} func (r *RabbitQueue) SendMsg(msg MsgFomatter) error { fmt.Printf(\u0026#34;Rabbitmq send msg success: %s\\n\u0026#34;, msg.Format()) return nil } type RocketQueue struct{} func (r *RocketQueue) SendMsg(msg MsgFomatter) error { fmt.Printf(\u0026#34;Rocketmq send msg success: %s\\n\u0026#34;, msg.Format()) return nil } type Demo struct{} func (d *Demo) SendMsg(queue Queue, msg MsgFomatter) error { return queue.SendMsg(msg) } // MyStr å®ç°MsgFormatteræ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥æ›´é€šç”¨çš„å¤„ç†æ¯ä¸€ç§ç±»å‹ type MyStr string func (str MyStr) Format() string { return string(str) } func main() { demo := Demo{} var s MyStr = \u0026#34;test\u0026#34; // kafka var kafka Queue = \u0026amp;KafkaQueue{} _ = demo.SendMsg(kafka, s) // rabbitmq var rabbitmq Queue = \u0026amp;RabbitQueue{} _ = demo.SendMsg(rabbitmq, s) } é€šè¿‡å¼€é—­åŸåˆ™ï¼Œæˆ‘ä»¬èƒ½è®¾è®¡å‡ºæ¥æ›´ä¼˜é›…ï¼Œæ‰©å±•æ€§æ›´å¥½çš„ä»£ç ã€‚\nå¦‚ä½•åœ¨é¡¹ç›®ä¸­çµæ´»çš„è¿ç”¨å¼€é—­åŸåˆ™å‘¢ï¼Ÿå†™å‡ºæ”¯æŒå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­çš„ä»£ç çš„å…³é”®æ˜¯é¢„ç•™æ‰©å±•ç‚¹ï¼Œå¦‚æœä½ å¼€å‘çš„æ˜¯ä¸€ä¸ªä¸šåŠ¡å¯¼å‘çš„ç³»ç»Ÿï¼Œæ¯”å¦‚äººè„¸è¯†åˆ«ç³»ç»Ÿç­‰ï¼Œè¦æƒ³è¯†åˆ«å‡ºå°½å¯èƒ½å¤šçš„æ‰©å±•ç‚¹ï¼Œå°±è¦å¯¹ä¸šåŠ¡æœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œèƒ½å¤ŸçŸ¥é“å½“ä¸‹ä»¥åŠæœªæ¥å¯èƒ½è¦æ”¯æŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚å¦‚æœæ˜¯ä¸šåŠ¡æ— å…³çš„ã€é€šç”¨çš„ã€ååº•å±‚çš„ç³»ç»Ÿï¼Œæ¯”å¦‚æ¡†æ¶ã€ç»„ä»¶ã€ç±»åº“ç­‰ï¼Œä½ éœ€è¦äº†è§£å®ƒä»¬ä¼šå¦‚ä½•è¢«ä½¿ç”¨ï¼Œä»Šåä½ æ‰“ç®—æ·»åŠ å“ªäº›åŠŸèƒ½ï¼Œä½¿ç”¨è€…æœªæ¥ä¼šæœ‰å“ªäº›æ›´å¤šçš„åŠŸèƒ½éœ€æ±‚ç­‰ç­‰ã€‚\nå”¯ä¸€ä¸å˜çš„åªæœ‰å˜åŒ–æœ¬èº«ã€‚æˆ‘ä»¬æ²¡å¿…è¦ä¸ºä¸€äº›é¥è¿œçš„ã€ä¸ä¸€å®šçš„éœ€æ±‚å»æå‰ä¹°å•ï¼Œåšè¿‡åº¦çš„è®¾è®¡ã€‚\n","permalink":"https://zzhaolei.github.io/posts/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99/","summary":"\u003ch2 id=\"ä»‹ç»\"\u003eä»‹ç»\u003c/h2\u003e\n\u003cp\u003eç®€å•çš„è¯´å°±æ˜¯ï¼š\u003ccode\u003eå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­\u003c/code\u003eã€‚å¯¹æ‰©å±•å¼€æ”¾æ˜¯ä¸ºäº†åº”å¯¹éœ€æ±‚çš„å˜åŒ–ï¼Œå¯¹ä¿®æ”¹å…³é—­å°±æ˜¯ä¸ºäº†ä¿è¯å·²æœ‰ä»£ç çš„ç¨³å®šæ€§ï¼Œæœ€ç»ˆæ˜¯ä¸ºäº†è®©ç³»ç»Ÿæ›´å…·æœ‰å¼¹æ€§ï¼Œèƒ½æ›´å¥½çš„å¤„ç†éœ€æ±‚ã€‚\u003c/p\u003e\n\u003cp\u003eå¼€é—­åŸåˆ™ä¹ŸåŒ…å«äº†\u003ccode\u003eå•ä¸€èŒè´£åŸåˆ™\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ä»¥æ¶ˆæ¯é˜Ÿåˆ—æ¥è¿›è¡Œä¸¾ä¾‹ã€‚\u003c/p\u003e\n\u003ch2 id=\"åçš„\"\u003eåçš„\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Package main å¼€é—­åŸåˆ™ Open-Closed Principle\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// å¼€é—­åŸåˆ™åŒ…å«äº†ï¼šå•ä¸€èŒè´£åŸåˆ™\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eKafkaQueue\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ek\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eKafkaQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendMSG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Kafka send msg success\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eRabbitQueue\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003er\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eRabbitQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendMSG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintln\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Rabbitmq send msg success\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eDemo\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eDemo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendByKafka\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equeue\u003c/span\u003e \u003cspan class=\"nx\"\u003eKafkaQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003equeue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendMSG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ed\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eDemo\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eSendByRabbit\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003equeue\u003c/span\u003e \u003cspan class=\"nx\"\u003eRabbitQueue\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emsg\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nx\"\u003equeue\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003eSendMSG\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emsg\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eé€šè¿‡è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™æ®µä»£ç è¿èƒŒäº†æˆ‘ä»¬çš„\u003ccode\u003eå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­\u003c/code\u003eçš„åŸåˆ™ã€‚å½“æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„RocketMQçš„æ—¶å€™ï¼Œéœ€è¦æ”¹åŠ¨Demoçš„é€»è¾‘ä»¥åŠå…¶ä»–è®¾è®¡çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¯æ‰©å±•æ€§å¯ä»¥è¯´æ˜¯ä¸€ç‚¹ä¹Ÿæ²¡æœ‰ã€‚\u003c/p\u003e","title":"Goè®¾è®¡æ¨¡å¼â€”â€”å¼€é—­åŸåˆ™"},{"content":"ä»‹ç» ç±»çš„èŒè´£åº”è¯¥æ˜¯å•ä¸€çš„ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»å˜åŒ–çš„åŸå› åº”è¯¥åªæœ‰ä¸€ä¸ªã€‚ç®€å•çš„è¯´å°±æ˜¯æ¯ä¸€ä¸ªç±»åªè´Ÿè´£è‡ªå·±çš„äº‹æƒ…ï¼Œåªæœ‰å•ä¸€çš„åŠŸèƒ½ã€‚\næˆ‘ä»¬ç°åœ¨ä»¥é“¶è¡Œå·¥ä½œäººå‘˜ä¸¾ä¾‹ï¼š\nåçš„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 // Package main å•ä¸€èŒè´£åŸåˆ™ Single-Responsibility Principle package main import \u0026#34;fmt\u0026#34; type Banker struct{} // Save å­˜é’± func (b *Banker) Save(money uint64) error { fmt.Printf(\u0026#34;æˆåŠŸå­˜å…¥: %d\\n\u0026#34;, money) return nil } // Transfer è½¬è´¦ func (b *Banker) Transfer(money uint64, to string) error { fmt.Printf(\u0026#34;æˆåŠŸå‘: %sè½¬å…¥: %d\\n\u0026#34;, to, money) return nil } å•ä¸€èŒè´£åŸåˆ™è¦æ±‚ä¸€ä¸ªç±»/æ¥å£åªæœ‰ä¸€ä¸ªèŒè´£ï¼Œè€Œå¼•èµ·ç±»å˜åŒ–çš„åŸå› åªèƒ½æœ‰ä¸€ä¸ªã€‚\nä»åŸåˆ™ä¸Šè®²ï¼Œæˆ‘ä»¬ä¸ºBankerå®šä¹‰å­˜é’±å’Œè½¬è´¦çš„æ“ä½œæ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ¥å£ä¸­å®šä¹‰çš„éƒ½æ˜¯é“¶è¡Œå·¥ä½œäººå‘˜å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼Œå¼•èµ·å˜åŒ–çš„åŸå› åªèƒ½æ˜¯Bankerçš„å±æ€§å’Œè¡Œä¸ºå‘ç”Ÿå˜åŒ–ã€‚\nä»è¿™æ–¹ä¾¿è€ƒè™‘ï¼Œè¿™ç§è®¾è®¡æ˜¯æœ‰åˆç†æ€§çš„ï¼Œå¦‚æœèƒ½ä¿è¯éœ€æ±‚ä¸ä¼šå˜åŒ–æˆ–è€…éœ€æ±‚å˜åŒ–çš„å¯èƒ½è¡Œå¾ˆå°ï¼Œé‚£ä¹ˆè¿™ç§è®¾è®¡å°±æ˜¯åˆç†çš„ã€‚\nä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬çŸ¥é“ï¼Œéœ€æ±‚æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œä»Šæ—¥å¢åŠ ä¸€ä¸ªè‚¡ç¥¨ä¸šåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¢åŠ ä¸€ä¸ªè‚¡ç¥¨çš„ç›¸å…³å±æ€§å’Œè¡Œä¸ºï¼Œæˆ‘ä»¬çš„æ¥å£å’Œå®ç°å°±éœ€è¦å…¨éƒ¨å˜åŠ¨ã€‚\næœ€å¥½çš„æ–¹å¼å°±æ˜¯å½“æˆ‘ä»¬å¼€å§‹å®šä¹‰çš„æ—¶å€™ï¼Œæ ¹æ®å±æ€§å’Œè¡Œä¸ºè¿›è¡Œç»†åˆ†ï¼ŒæŠ½è±¡ä¸åŒçš„æ¥å£å‡ºæ¥ï¼Œåœ¨Goé‡Œé¢ä¹Ÿæ˜¯ä¸»å¼ å°æ¥å£ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆçš„æ‰‹æ®µæ¥éšæ„æ„é€ æˆ‘ä»¬æƒ³è¦çš„å¤§æ¥å£ã€‚\nå¥½çš„ æˆ‘ä»¬å°†Bankerè¿›è¡ŒæŠ½è±¡ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„è¿›è¡Œæ‰©å±•ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 // Package main å•ä¸€èŒè´£åŸåˆ™ Single-Responsibility Principle package main import \u0026#34;fmt\u0026#34; type Config struct { Money uint64 To string } type Banker interface { DoSomething(Config) error } type SaveBanker struct{} func (sb *SaveBanker) DoSomething(cfg Config) error { fmt.Printf(\u0026#34;æˆåŠŸå­˜å…¥: %d\\n\u0026#34;, cfg.Money) return nil } type TransferBanker struct{} func (tb *TransferBanker) DoSomething(cfg Config) error { fmt.Printf(\u0026#34;æˆåŠŸå‘: %sè½¬å…¥: %d\\n\u0026#34;, cfg.To, cfg.Money) return nil } æˆ‘ä»¬æŠ½è±¡å‡ºæ¥äº†Bankeræ¥å£ï¼Œæ¯ä¸€ä¸ªä¸å¤ªçš„ä¸šåŠ¡å‘˜éƒ½å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå¯¹è¡Œä¸ºè¿›è¡Œè‡ªå®šä¹‰ã€‚\nç°åœ¨æˆ‘ä»¬ä¹Ÿå¯ä»¥å¢åŠ è‚¡ç¥¨çš„æ¥å£ï¼Œæ¥è¿›è¡Œè‚¡ç¥¨ç›¸å…³çš„ä¸šåŠ¡æ“ä½œï¼Œè€Œè¿™ä¸ä¼šå½±å“åˆ°å…¶ä»–çš„ä¸šåŠ¡å‘˜çš„åŠŸèƒ½ã€‚\né€šè¿‡å•ä¸€èŒè´£åŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½çš„å¯¹ä»£ç è¿›è¡Œæ‰©å±•ã€‚\næ€»ç»“ å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼ŒæŠ½è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€æ˜¯ï¼šè‡ªä¸‹è€Œä¸Šçš„ï¼Œä¸€æ˜¯ï¼šè‡ªä¸Šè€Œä¸‹çš„ã€‚\nå¯¹äºç¬¬ä¸€ç§ï¼Œå°±æ˜¯ä¸€å¼€å§‹æ²¡æœ‰ç»†ç²’åº¦çš„æ¥å£å¯ä»¥æ‹†åˆ†ï¼Œä½†æ˜¯éšç€éœ€æ±‚çš„æ¼”è¿›ï¼ŒåŠŸèƒ½è¶Šæ¥è¶Šå¤æ‚ï¼Œè¿™æ—¶å€™å°±å¯ä»¥è¿›è¡Œè‡ªä¸‹è€Œä¸Šçš„æŠ½è±¡äº†ï¼Œè¿™æ ·æŠ½è±¡åä¹Ÿèƒ½æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œçµæ´»çš„å¼€å‘ï¼Œè€Œä¸è‡³äºç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚\nå¯¹äºç¬¬äºŒç§ï¼Œå°±æ˜¯ä¸€å¼€å§‹å°±å¯ä»¥è¿›è¡Œæ‹†åˆ†ï¼Œä¾‹å¦‚ä¸Šæ–‡ä¸­çš„æ‰‹æœºï¼Œç°å®ä¸­åŠ¨ç‰©çš„ä½“é‡ã€å¹´é¾„å’Œå«å£°ã€è¡Œä¸ºå°±å¯ä»¥è¿›è¡Œæ‹†åˆ†ã€‚\næ€»è€Œè¨€ä¹‹ï¼Œäº†è§£äº†å•ä¸€èŒè´£åŸåˆ™ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¾è®¡å’Œé˜…è¯»ä¼˜ç§€çš„å¼€æºä»£ç ã€‚\n","permalink":"https://zzhaolei.github.io/posts/go%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99/","summary":"\u003ch2 id=\"ä»‹ç»\"\u003eä»‹ç»\u003c/h2\u003e\n\u003cp\u003eç±»çš„èŒè´£åº”è¯¥æ˜¯å•ä¸€çš„ï¼Œå¯¹å¤–åªæä¾›ä¸€ç§åŠŸèƒ½ï¼Œè€Œå¼•èµ·ç±»å˜åŒ–çš„åŸå› åº”è¯¥åªæœ‰ä¸€ä¸ªã€‚ç®€å•çš„è¯´å°±æ˜¯æ¯ä¸€ä¸ªç±»åªè´Ÿè´£è‡ªå·±çš„äº‹æƒ…ï¼Œåªæœ‰å•ä¸€çš„åŠŸèƒ½ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬ç°åœ¨ä»¥é“¶è¡Œå·¥ä½œäººå‘˜ä¸¾ä¾‹ï¼š\u003c/p\u003e\n\u003ch2 id=\"åçš„\"\u003eåçš„\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Package main å•ä¸€èŒè´£åŸåˆ™ Single-Responsibility Principle\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eBanker\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Save å­˜é’±\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eBanker\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eSave\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emoney\u003c/span\u003e \u003cspan class=\"kt\"\u003euint64\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;æˆåŠŸå­˜å…¥: %d\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emoney\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Transfer è½¬è´¦\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eb\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eBanker\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eTransfer\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003emoney\u003c/span\u003e \u003cspan class=\"kt\"\u003euint64\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;æˆåŠŸå‘: %sè½¬å…¥: %d\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003eto\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003emoney\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eå•ä¸€èŒè´£åŸåˆ™è¦æ±‚ä¸€ä¸ªç±»/æ¥å£åªæœ‰ä¸€ä¸ªèŒè´£ï¼Œè€Œå¼•èµ·ç±»å˜åŒ–çš„åŸå› åªèƒ½æœ‰ä¸€ä¸ªã€‚\u003c/p\u003e\n\u003cp\u003eä»åŸåˆ™ä¸Šè®²ï¼Œæˆ‘ä»¬ä¸ºBankerå®šä¹‰å­˜é’±å’Œè½¬è´¦çš„æ“ä½œæ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ¥å£ä¸­å®šä¹‰çš„éƒ½æ˜¯é“¶è¡Œå·¥ä½œäººå‘˜å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼Œå¼•èµ·å˜åŒ–çš„åŸå› åªèƒ½æ˜¯Bankerçš„å±æ€§å’Œè¡Œä¸ºå‘ç”Ÿå˜åŒ–ã€‚\u003c/p\u003e\n\u003cp\u003eä»è¿™æ–¹ä¾¿è€ƒè™‘ï¼Œè¿™ç§è®¾è®¡æ˜¯æœ‰åˆç†æ€§çš„ï¼Œå¦‚æœèƒ½ä¿è¯éœ€æ±‚ä¸ä¼šå˜åŒ–æˆ–è€…éœ€æ±‚å˜åŒ–çš„å¯èƒ½è¡Œå¾ˆå°ï¼Œé‚£ä¹ˆè¿™ç§è®¾è®¡å°±æ˜¯åˆç†çš„ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯å®é™…ä¸Šæˆ‘ä»¬çŸ¥é“ï¼Œéœ€æ±‚æ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œä»Šæ—¥å¢åŠ ä¸€ä¸ªè‚¡ç¥¨ä¸šåŠ¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦å¢åŠ ä¸€ä¸ªè‚¡ç¥¨çš„ç›¸å…³å±æ€§å’Œè¡Œä¸ºï¼Œæˆ‘ä»¬çš„æ¥å£å’Œå®ç°å°±éœ€è¦å…¨éƒ¨å˜åŠ¨ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€å¥½çš„æ–¹å¼å°±æ˜¯å½“æˆ‘ä»¬å¼€å§‹å®šä¹‰çš„æ—¶å€™ï¼Œæ ¹æ®å±æ€§å’Œè¡Œä¸ºè¿›è¡Œç»†åˆ†ï¼ŒæŠ½è±¡ä¸åŒçš„æ¥å£å‡ºæ¥ï¼Œåœ¨Goé‡Œé¢ä¹Ÿæ˜¯ä¸»å¼ \u003ccode\u003eå°æ¥å£\u003c/code\u003eï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆçš„æ‰‹æ®µæ¥éšæ„æ„é€ æˆ‘ä»¬æƒ³è¦çš„\u003ccode\u003eå¤§æ¥å£\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch2 id=\"å¥½çš„\"\u003eå¥½çš„\u003c/h2\u003e\n\u003cp\u003eæˆ‘ä»¬å°†Bankerè¿›è¡ŒæŠ½è±¡ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½çš„è¿›è¡Œæ‰©å±•ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-go\" data-lang=\"go\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// Package main å•ä¸€èŒè´£åŸåˆ™ Single-Responsibility Principle\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003epackage\u003c/span\u003e \u003cspan class=\"nx\"\u003emain\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kn\"\u003eimport\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;fmt\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eConfig\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eMoney\u003c/span\u003e \u003cspan class=\"kt\"\u003euint64\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003eTo\u003c/span\u003e    \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eBanker\u003c/span\u003e \u003cspan class=\"kd\"\u003einterface\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nf\"\u003eDoSomething\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003eConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eSaveBanker\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003esb\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eSaveBanker\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoSomething\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecfg\u003c/span\u003e \u003cspan class=\"nx\"\u003eConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;æˆåŠŸå­˜å…¥: %d\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecfg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eMoney\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003etype\u003c/span\u003e \u003cspan class=\"nx\"\u003eTransferBanker\u003c/span\u003e \u003cspan class=\"kd\"\u003estruct\u003c/span\u003e\u003cspan class=\"p\"\u003e{}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kd\"\u003efunc\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003etb\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nx\"\u003eTransferBanker\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"nf\"\u003eDoSomething\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nx\"\u003ecfg\u003c/span\u003e \u003cspan class=\"nx\"\u003eConfig\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"kt\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"nx\"\u003efmt\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nf\"\u003ePrintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;æˆåŠŸå‘: %sè½¬å…¥: %d\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecfg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eTo\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nx\"\u003ecfg\u003c/span\u003e\u003cspan class=\"p\"\u003e.\u003c/span\u003e\u003cspan class=\"nx\"\u003eMoney\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"kc\"\u003enil\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eæˆ‘ä»¬æŠ½è±¡å‡ºæ¥äº†Bankeræ¥å£ï¼Œæ¯ä¸€ä¸ªä¸å¤ªçš„ä¸šåŠ¡å‘˜éƒ½å¯ä»¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå¯¹è¡Œä¸ºè¿›è¡Œè‡ªå®šä¹‰ã€‚\u003c/p\u003e","title":"Goè®¾è®¡æ¨¡å¼â€”â€”å•ä¸€èŒè´£åŸåˆ™"},{"content":"go æœ¬èº«æä¾›çš„ semaphore åªèƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹å¤šä¸ªåç¨‹æˆ–çº¿ç¨‹é—´ä½¿ç”¨ï¼Œæ— æ³•åœ¨ä¸åŒçš„ go è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ï¼Œæ‰€ä»¥æœ¬æ–‡ä»‹ç»ï¼Œå¦‚ä½•ä½¿ç”¨ go ä¸­çš„ syscall æ¥ä½¿ç”¨ POSIX ç³»ç»Ÿæä¾›çš„å‘½åä¿¡å·é‡ã€‚\nGo ä¸­çš„ç³»ç»Ÿè°ƒç”¨ åœ¨ go ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯é€šè¿‡ syscall åŒ…æä¾›çš„ Syscall å‡½æ•°æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„ï¼Œä¸åŒçš„ç³»ç»Ÿè°ƒç”¨æœ‰ä¸åŒçš„ trapï¼Œä»¥åŠä¸åŒé•¿åº¦çš„å‚æ•°ã€‚\ntrap go åœ¨ syscall åŒ…ä¸­å®šä¹‰äº†å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ç ï¼Œå…·ä½“å®šä¹‰åœ¨æ–‡ä»¶1.20.6/go/src/syscall/zsysnum_darwin_arm64.go ã€‚ä¸åŒæ“ä½œç³»ç»Ÿä¸Šï¼Œå®šä¹‰æ‰€ä½¿ç”¨çš„æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œè¿™äº›å®šä¹‰éƒ½æ˜¯é€šè¿‡ä¸åŒç³»ç»Ÿçš„c è¯­è¨€å¤´æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„ã€‚æ¯”å¦‚ linux amd64 æ“ä½œç³»ç»Ÿçš„å®šä¹‰åœ¨1.20.6/go/src/syscall/zerrors_linux_amd64.goã€‚\nä¸åŒé•¿åº¦çš„å‚æ•° syscall åŒ…æœ‰ Syscallã€Syscall6 ä¸¤ä¸ªå‡½æ•°ï¼Œå¯¹åº”äºä¸åŒçš„æ“ä½œç³»ç»Ÿè°ƒç”¨å‚æ•°é•¿åº¦çš„æƒ…å†µã€‚\nSyscall æ€»å…±æ¥æ”¶ 4 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ trap å®šä¹‰ï¼Œæè¿°å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‰©ä¸‹çš„ 3 ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ã€‚\nSyscall6 æ€»å…±æ¥æ”¶ 7 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ trap å®šä¹‰ï¼Œæè¿°å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‰©ä¸‹çš„ 6 ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ã€‚\nå¦‚æœä½¿ç”¨ Syscall æˆ– Syscall6 æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ä¸æ»¡è¶³å‡½æ•°å½¢å‚æ‰€éœ€çš„æ•°é‡ï¼Œåˆ™å‰©ä¸‹çš„å‚æ•°ä¼ 0ã€‚\nä¾‹å¦‚ï¼Œåœ¨ POSIX ç³»ç»Ÿä¸Šæ‰“å¼€ä¸€ä¸ªå‘½åä¿¡å·é‡çš„ç³»ç»Ÿè°ƒç”¨æ˜¯:\n1 sem_t *sem_open(const char *name, int oflag, mode_t mode, unsigned int value); å› ä¸ºç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æœ‰ 4 ä¸ªï¼Œè€Œ Syscall æ¥æ”¶çš„å…¨éƒ¨å½¢å‚æ‰ 4 ä¸ªï¼Œæ‰€ä»¥ Syscall ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œåªèƒ½ä½¿ç”¨ Syscall6 è¿™ä¸ªå‡½æ•°ã€‚è€Œ Syscall6 æ€»å…±éœ€è¦ 7 ä¸ªå½¢å‚ï¼Œå…¶ä¸­æœ‰ 6 ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œæˆ‘ä»¬åªæœ‰ 4 ä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ 2 ä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ 0 æ›¿ä»£ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 9 r1, r2, err := syscall.Syscall6( syscall.SYS_SEM_OPEN, uintptr(unsafe.Pointer(cs)), // name uintptr(C.O_CREAT), // flag uintptr(mode), // mode uintptr(value), // value 0, // æ²¡æœ‰æ›´å¤šå‚æ•°ï¼Œä½¿ç”¨ 0 0, ) å®ç°Samephore ä¿¡å·é‡çš„æ“ä½œä¸»è¦æœ‰è¿™ä¹ˆå‡ ä¸ªç³»ç»Ÿè°ƒç”¨ï¼šsem_openã€sem_waitã€sem_trywaitã€sem_postã€sem_closeã€sem_unlinkã€‚\nåœ¨å…·ä½“å®ç°ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¼•å…¥ C å¤´æ–‡ä»¶å’Œå®šä¹‰ä¸€äº›ç»“æ„ï¼Œæ–¹ä¾¿æˆ‘ä»¬åç»­ä½¿ç”¨ã€‚\næˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª semaphore/semaphore.go çš„åŒ…ï¼Œç„¶ååœ¨ semaphore.go ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 package semaphore /* #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;fcntl.h\u0026gt; */ import \u0026#34;C\u0026#34; import ( \u0026#34;fmt\u0026#34; \u0026#34;syscall\u0026#34; \u0026#34;unsafe\u0026#34; ) // Semaphore æ˜¯ä¸€ä¸ªç”¨æ¥ä¿å­˜ ä¿¡å·æè¿°ç¬¦ çš„ç»“æ„ä½“ type Semaphore struct { sd uintptr } // New åˆ›å»ºä¸€ä¸ªç©ºçš„ä¿¡å·é‡ç»“æ„ä½“ func New() *Semaphore { return \u0026amp;Semaphore{} } ä¸‹æ–‡ä¸­æ¶‰åŠåˆ°çš„ Go ä»£ç ï¼Œå‡åœ¨ semaphore.go æ–‡ä»¶ä¸­ã€‚\nsem_open POSIX ç³»ç»Ÿè°ƒç”¨ï¼š\n1 2 3 4 #include \u0026lt;semaphore.h\u0026gt; sem_t * sem_open(const char *name, int oflag, mode_t mode, unsigned int value); è·å–ä¸€ä¸ª sem_t å€¼ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä»£è¡¨ä¸€ä¸ªè¢«æ‰“å¼€çš„ä¿¡å·é‡ã€‚\nGo è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 func (sem *Semaphore) Open(name string, mode int, value int) error { // å°† go å­—ç¬¦ä¸²è½¬ä¸º C å­—ç¬¦ä¸² cs := C.CString(name) // C.CString ä¼šåœ¨ C ä¾§é‡æ–°ç”³è¯·å†…å­˜ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä½¿ç”¨åé‡Šæ”¾(åœ¨ stdlib.h ä¸­) defer C.free(unsafe.Pointer(cs)) // è°ƒç”¨ sem_open ç³»ç»Ÿè°ƒç”¨ï¼Œä¼ é€’å¿…é¡»å‚æ•° // C.O_CREAT è¡¨ç¤ºåˆ›å»º(åœ¨ fcntl.h ä¸­)ï¼Œvalue æ˜¯ä¿¡å·é‡çš„å€¼ï¼Œmode ä¸ºæ‰“å¼€çš„ ä¿¡å·æè¿°ç¬¦ çš„çŠ¶æ€ r1, _, err := syscall.Syscall6( syscall.SYS_SEM_OPEN, uintptr(unsafe.Pointer(cs)), uintptr(C.O_CREAT), uintptr(mode), uintptr(value), 0, 0, ) if err != 0 { sem.Unlink(name) return fmt.Errorf(\u0026#34;create semaphore failed: %s\u0026#34;, err) } sem.sd = r1 return nil } sem_trywait å’Œ sem_wait POSIX ç³»ç»Ÿè°ƒç”¨ï¼š\n1 2 3 4 5 6 7 #include \u0026lt;semaphore.h\u0026gt; int sem_trywait(sem_t *sem); int sem_wait(sem_t *sem); sem_trywait å½“ sem çš„å€¼ä¸º 0 æ—¶ï¼Œæ­¤æ“ä½œä¸ä¼šé˜»å¡ç­‰å¾…ï¼Œè€Œæ˜¯ä¼šç«‹å³è¿”å›ã€‚\nsem_wait å½“ sem çš„å€¼ä¸º 0 æ—¶ï¼Œæ­¤æ“ä½œä¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°èƒ½è·å–ä¿¡å·é‡æˆ–è€…è°ƒç”¨è¢«ä¸­æ–­ã€‚\nè¿™ä¸¤ä¸ªæ“ä½œéƒ½ä¼š locked semï¼Œå¹¶ä¸”æ“ä½œç»“æœç›¸å½“äº sem å€¼å‡ä¸€ã€‚\nGo è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 func (sem *Semaphore) TryAcquire() error { _, _, err := syscall.Syscall(syscall.SYS_SEM_TRYWAIT, sem.sd, 0, 0) if err != 0 { return fmt.Errorf(\u0026#34;try acquire failed: %s\u0026#34;, err.Error()) } return nil } func (sem *Semaphore) Acquire() { _, _, _ = syscall.Syscall(syscall.SYS_SEM_WAIT, sem.sd, 0, 0) } sem_post POSIX ç³»ç»Ÿè°ƒç”¨ï¼š\n1 2 3 4 #include \u0026lt;semaphore.h\u0026gt; int sem_post(sem_t *sem); locked semï¼Œå¯¹ sem å€¼åŠ ä¸€ï¼Œå¹¶ä¸”ç­‰å¾…è¯¥ä¿¡å·é‡çš„æ‰€æœ‰è¿›ç¨‹/çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚\nGo è°ƒç”¨ï¼š\n1 2 3 func (sem *Semaphore) Release() { _, _, _ = syscall.Syscall(syscall.SYS_SEM_POST, sem.sd, 0, 0) } sem_close å’Œ sem_unlink POSIX ç³»ç»Ÿè°ƒç”¨ï¼š\n1 2 3 4 5 6 7 #include \u0026lt;semaphore.h\u0026gt; int sem_close(sem_t *sem); int sem_unlink(const char *name); sem_closeï¼šæ‰€å¼•ç”¨çš„å‘½åä¿¡å·é‡å…³è”çš„ç³»ç»Ÿå†…å­˜èµ„æºè¢«é‡Šæ”¾ï¼Œæè¿°ç¬¦æ— æ•ˆã€‚\nsem_unlinkï¼šç§»é™¤åä¸º name çš„å‘½åä¿¡å·é‡ã€‚å¦‚æœè¯¥ä¿¡å·é‡æ­£åœ¨è¢«å…¶ä»–è¿›ç¨‹ä½¿ç”¨ï¼Œé‚£ä¹ˆ name å°†ç«‹å³ä¸è¯¥ä¿¡å·é‡è§£é™¤å…³è”ï¼Œä½†æ˜¯è¯¥ä¿¡å·é‡æœ¬èº«ä¸ä¼šè¢«ç§»é™¤ï¼Œç›´åˆ°å¯¹å®ƒçš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«å…³é—­ã€‚ä½¿ç”¨ name å¯¹ sem_open() çš„åç»­è°ƒç”¨å°†å¼•ç”¨æˆ–åˆ›å»ºä¸€ä¸ªåä¸º name çš„æ–°ä¿¡å·é‡ã€‚\nGo è°ƒç”¨ï¼š\n1 2 3 4 5 6 7 8 9 10 11 func (sem *Semaphore) Unlink(name string) { cs := C.CString(name) defer C.free(unsafe.Pointer(cs)) sem.close() _, _, _ = syscall.Syscall(syscall.SYS_SEM_UNLINK, uintptr(unsafe.Pointer(cs)), 0, 0) } func (sem *Semaphore) close() { _, _, _ = syscall.Syscall(syscall.SYS_SEM_CLOSE, sem.sd, 0, 0) } ","permalink":"https://zzhaolei.github.io/posts/%E5%A6%82%E4%BD%95%E5%9C%A8go%E4%B8%AD%E4%BD%BF%E7%94%A8posix%E5%91%BD%E5%90%8D%E4%BF%A1%E5%8F%B7%E9%87%8F/","summary":"\u003cp\u003e\u003ccode\u003ego\u003c/code\u003e æœ¬èº«æä¾›çš„ \u003ccode\u003esemaphore\u003c/code\u003e åªèƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹å¤šä¸ªåç¨‹æˆ–çº¿ç¨‹é—´ä½¿ç”¨ï¼Œæ— æ³•åœ¨ä¸åŒçš„ \u003ccode\u003ego\u003c/code\u003e è¿›ç¨‹ä¹‹é—´ä½¿ç”¨ï¼Œæ‰€ä»¥æœ¬æ–‡ä»‹ç»ï¼Œå¦‚ä½•ä½¿ç”¨ \u003ccode\u003ego\u003c/code\u003e ä¸­çš„ \u003ccode\u003esyscall\u003c/code\u003e æ¥ä½¿ç”¨ \u003ccode\u003ePOSIX\u003c/code\u003e ç³»ç»Ÿæä¾›çš„\u003ccode\u003eå‘½åä¿¡å·é‡\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch2 id=\"go-ä¸­çš„ç³»ç»Ÿè°ƒç”¨\"\u003eGo ä¸­çš„ç³»ç»Ÿè°ƒç”¨\u003c/h2\u003e\n\u003cp\u003eåœ¨ \u003ccode\u003ego\u003c/code\u003e ä¸­ï¼Œç³»ç»Ÿè°ƒç”¨æ˜¯é€šè¿‡ \u003ccode\u003esyscall\u003c/code\u003e åŒ…æä¾›çš„ \u003ccode\u003eSyscall\u003c/code\u003e å‡½æ•°æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨çš„ï¼Œä¸åŒçš„ç³»ç»Ÿè°ƒç”¨æœ‰ä¸åŒçš„ \u003ccode\u003etrap\u003c/code\u003eï¼Œä»¥åŠ\u003ccode\u003eä¸åŒé•¿åº¦çš„å‚æ•°\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch3 id=\"trap\"\u003etrap\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ego\u003c/code\u003e åœ¨ \u003ccode\u003esyscall\u003c/code\u003e åŒ…ä¸­å®šä¹‰äº†å¤§é‡çš„ç³»ç»Ÿè°ƒç”¨ç ï¼Œå…·ä½“å®šä¹‰åœ¨æ–‡ä»¶\u003ccode\u003e1.20.6/go/src/syscall/zsysnum_darwin_arm64.go\u003c/code\u003e ã€‚ä¸åŒæ“ä½œç³»ç»Ÿä¸Šï¼Œå®šä¹‰æ‰€ä½¿ç”¨çš„æ–‡ä»¶æ˜¯ä¸åŒçš„ï¼Œè¿™äº›å®šä¹‰éƒ½æ˜¯é€šè¿‡ä¸åŒç³»ç»Ÿçš„c è¯­è¨€å¤´æ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆçš„ã€‚æ¯”å¦‚ \u003ccode\u003elinux amd64\u003c/code\u003e æ“ä½œç³»ç»Ÿçš„å®šä¹‰åœ¨\u003ccode\u003e1.20.6/go/src/syscall/zerrors_linux_amd64.go\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch3 id=\"ä¸åŒé•¿åº¦çš„å‚æ•°\"\u003eä¸åŒé•¿åº¦çš„å‚æ•°\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003esyscall\u003c/code\u003e åŒ…æœ‰ \u003ccode\u003eSyscallã€Syscall6\u003c/code\u003e ä¸¤ä¸ªå‡½æ•°ï¼Œå¯¹åº”äºä¸åŒçš„æ“ä½œç³»ç»Ÿè°ƒç”¨å‚æ•°é•¿åº¦çš„æƒ…å†µã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eSyscall\u003c/code\u003e æ€»å…±æ¥æ”¶ \u003ccode\u003e4\u003c/code\u003e ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ \u003ccode\u003etrap\u003c/code\u003e å®šä¹‰ï¼Œæè¿°å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‰©ä¸‹çš„ \u003ccode\u003e3\u003c/code\u003e ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eSyscall6\u003c/code\u003e æ€»å…±æ¥æ”¶ \u003ccode\u003e7\u003c/code\u003e ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ \u003ccode\u003etrap\u003c/code\u003e å®šä¹‰ï¼Œæè¿°å…·ä½“çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå‰©ä¸‹çš„ \u003ccode\u003e6\u003c/code\u003e ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœä½¿ç”¨ \u003ccode\u003eSyscall\u003c/code\u003e æˆ– \u003ccode\u003eSyscall6\u003c/code\u003e æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨æ‰€éœ€çš„å‚æ•°ä¸æ»¡è¶³å‡½æ•°å½¢å‚æ‰€éœ€çš„æ•°é‡ï¼Œåˆ™å‰©ä¸‹çš„å‚æ•°\u003ccode\u003eä¼ 0\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eä¾‹å¦‚ï¼Œåœ¨ \u003ccode\u003ePOSIX\u003c/code\u003e ç³»ç»Ÿä¸Šæ‰“å¼€ä¸€ä¸ªå‘½åä¿¡å·é‡çš„ç³»ç»Ÿè°ƒç”¨æ˜¯:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"kt\"\u003esem_t\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"nf\"\u003esem_open\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003econst\u003c/span\u003e \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003eoflag\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003emode_t\u003c/span\u003e \u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e \u003cspan class=\"n\"\u003evalue\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eå› ä¸ºç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æœ‰ \u003ccode\u003e4\u003c/code\u003e ä¸ªï¼Œè€Œ \u003ccode\u003eSyscall\u003c/code\u003e æ¥æ”¶çš„å…¨éƒ¨å½¢å‚æ‰ \u003ccode\u003e4\u003c/code\u003e ä¸ªï¼Œæ‰€ä»¥ \u003ccode\u003eSyscall\u003c/code\u003e ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ï¼Œåªèƒ½ä½¿ç”¨ \u003ccode\u003eSyscall6\u003c/code\u003e è¿™ä¸ªå‡½æ•°ã€‚è€Œ \u003ccode\u003eSyscall6\u003c/code\u003e æ€»å…±éœ€è¦ \u003ccode\u003e7\u003c/code\u003e ä¸ªå½¢å‚ï¼Œå…¶ä¸­æœ‰ \u003ccode\u003e6\u003c/code\u003e ä¸ªæ˜¯ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œæˆ‘ä»¬åªæœ‰ \u003ccode\u003e4\u003c/code\u003e ä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„ \u003ccode\u003e2\u003c/code\u003e ä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ \u003ccode\u003e0\u003c/code\u003e æ›¿ä»£ï¼Œä¾‹å¦‚ï¼š\u003c/p\u003e","title":"å¦‚ä½•åœ¨Goä¸­ä½¿ç”¨POSIXå‘½åä¿¡å·é‡"},{"content":"1.åˆ—è¡¨ç»“æ„ä½“ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #define PyObject_VAR_HEAD PyVarObject ob_base; typedef struct { PyObject ob_base; Py_ssize_t ob_size; /* Number of items in variable part */ } PyVarObject; typedef struct { PyObject_VAR_HEAD /* Vector of pointers to list elements. list[0] is ob_item[0], etc. */ PyObject **ob_item; /* ob_item contains space for \u0026#39;allocated\u0026#39; elements. The number * currently in use is ob_size. * Invariants: * 0 \u0026lt;= ob_size \u0026lt;= allocated * len(list) == ob_size * ob_item == NULL implies ob_size == allocated == 0 * list.sort() temporarily sets allocated to -1 to detect mutations. * * Items must normally not be NULL, except during construction when * the list is not yet visible outside the function that builds it. */ Py_ssize_t allocated; } PyListObject; ob_itemæ˜¯æŒ‡å‘åˆ—è¡¨å…ƒç´ çš„æŒ‡é’ˆå‘é‡ï¼Œå½“æˆ‘ä»¬é€šè¿‡list[0]è·å–å…ƒç´ æ—¶ï¼Œå®é™…ä¸Šæ˜¯è·å–çš„ob_item[0]çš„å…ƒç´ ã€‚ob_itemçš„ç±»å‹æ˜¯PyObject*ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¸ºä»€ä¹ˆPythonä¸­çš„listèƒ½å­˜å‚¨ä»»æ„å¯¹è±¡çš„æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºä»»ä½•Pythonå¯¹è±¡éƒ½å¯ä»¥å¼ºè½¬ä¸ºPyObject*çš„æŒ‡é’ˆç±»å‹ã€‚\nallocatedç»´æŠ¤äº†ob_itemä¸­å¯å®¹çº³çš„å…ƒç´ çš„æ€»æ•°ï¼Œå³ç”³è¯·äº†å¤šå¤§çš„å†…å­˜ç©ºé—´ã€‚ob_sizeæ˜¯å…ƒç´ çš„æ•°é‡ï¼Œè®°å½•äº†å·²ä½¿ç”¨çš„å†…å­˜ç©ºé—´ã€‚\n0 â‰¤ ob_size â‰¤ allocated len(list) == ob_size ob_item == NULLéšå¼ç­‰äºob_size == allocated == 0 å½“è°ƒç”¨list.sort()å‡½æ•°æ—¶ï¼Œallocatedä¼šè¢«è®¾ç½®ä¸º-1ã€‚\nitemsé€šå¸¸ä¸èƒ½ä¸ºç©ºã€‚\n2.åˆ›å»º 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 #ifndef PyList_MAXFREELIST # define PyList_MAXFREELIST 80 // æœ€å¤šç¼“å­˜80ä¸ª #endif PyObject * PyList_New(Py_ssize_t size) { PyListObject *op; if (size \u0026lt; 0) { PyErr_BadInternalCall(); return NULL; } #if PyList_MAXFREELIST \u0026gt; 0 // ä»è§£é‡Šå™¨ä¸­è·å–åˆ°ç¼“å­˜é“¾è¡¨ struct _Py_list_state *state = get_list_state(); #ifdef Py_DEBUG // ä¸èƒ½åœ¨_PyList_Fini()å‡½æ•°ä¹‹åè°ƒç”¨PyList_New()å‡½æ•° // PyList_New() must not be called after _PyList_Fini() assert(state-\u0026gt;numfree != -1); #endif if (PyList_MAXFREELIST \u0026amp;\u0026amp; state-\u0026gt;numfree) { // ç¼“å­˜æ•°é‡å‡1 state-\u0026gt;numfree--; // è·å–æœ€åä¸€ä¸ªç¼“å­˜çš„PyListObjectå¯¹è±¡ã€‚ op = state-\u0026gt;free_list[state-\u0026gt;numfree]; OBJECT_STAT_INC(from_freelist); _Py_NewReference((PyObject *)op); } else #endif { // å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œå°±åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶é€šè¿‡GCåˆ›å»ºè¿™ä¸ªå¯¹è±¡ // - å®¹å™¨ç±»å‹ï¼Œæœ‰å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæ— æ³•ä»…æ ¹æ®å¼•ç”¨è®¡æ•°å™¨å›æ”¶å†…å­˜ op = PyObject_GC_New(PyListObject, \u0026amp;PyList_Type); if (op == NULL) { return NULL; } } // å¦‚æœé•¿åº¦ä¸º0ï¼Œåˆ™è¯´æ˜è¿™æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨å¯¹è±¡ if (size \u0026lt;= 0) { op-\u0026gt;ob_item = NULL; } else { // å¦åˆ™å°±æ ¹æ®å®¹é‡ã€PyObject*æŒ‡é’ˆé•¿åº¦ç”³è¯·æ‰€éœ€çš„å†…å­˜ç©ºé—´ op-\u0026gt;ob_item = (PyObject **) PyMem_Calloc(size, sizeof(PyObject *)); if (op-\u0026gt;ob_item == NULL) { Py_DECREF(op); // å¦‚æœä¾ç„¶ä¸ºNULLï¼Œåˆ™è¯´æ˜å†…å­˜ç©ºé—´ä¸è¶³ return PyErr_NoMemory(); } } // è®¾ç½® ob_sizeï¼Œå³ob-\u0026gt;ob_size = size; Py_SET_SIZE(op, size); op-\u0026gt;allocated = size; // å› ä¸ºå®¹å™¨ç±»å‹å¯èƒ½å­˜åœ¨å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œæ‰€ä»¥é€šè¿‡gcæ¥è¿›è¡Œè¾…åŠ©çš„æ ‡è®°æ¸…é™¤å’Œè¿­ä»£å›æ”¶ _PyObject_GC_TRACK(op); return (PyObject *) op; } åˆ›å»ºå‡½æ•°åªéœ€è¦æŒ‡å®šå‚æ•°sizeï¼ŒæŒ‡æ˜è¿™ä¸ªlistçš„å®¹é‡ã€‚\nåœ¨åˆ›å»ºæ–°çš„PyListObjectå¯¹è±¡ä¹‹å‰ï¼Œä¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨ç¼“å­˜ï¼Œå¹¶ä»è§£é‡Šå™¨ä¸­è·å–ï¼ˆget_list_state()ï¼‰åˆ°ä¸ºlistå¯¹è±¡ç¼“å­˜çš„æ•°ç»„ï¼Œç„¶åä»ç¼“å­˜æ•°ç»„free_listä¸­è·å–æœ€åä¸€ä¸ªç¼“å­˜çš„PyObject*å¯¹è±¡ï¼Œå¹¶å°†è¿™ä¸ªPyObject*å¯¹è±¡çš„å¼•ç”¨è®¡æ•°åŠ ä¸€ï¼Œå°†numfreeå‡ä¸€ï¼Œã€‚numfreeæ˜¯ç”¨æ¥è®°å½•free_listä¸­å­˜äº†å¤šå°‘å…ƒç´ çš„ã€‚ å¦‚æœæ²¡æœ‰ç¼“å­˜æˆ–è€…ç¼“å­˜æ•°ç»„ä¸­è¿˜æ²¡æœ‰æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šæ ¹æ®sizeå®¹é‡ã€PyObject*æŒ‡é’ˆé•¿åº¦å»ç”³è¯·å†…å­˜ç©ºé—´ï¼Œä¹‹åä¼šè®¾ç½®å¯¹è±¡ob_sizeä¸ºsizeï¼Œè®¾ç½®allocatedä¸ºsizeï¼Œå¹¶ä½¿ç”¨gcè·Ÿä¸­è¿™ä¸ªæ•°ç»„å¯¹è±¡ã€‚ æœ€åä¼šå°†PyListObject*å¯¹è±¡è½¬ä¸ºPyObject*å¯¹è±¡è¿”å›ã€‚ è¿™ä¸ªæµç¨‹åªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰ç›¸åº”å†…å­˜ç©ºé—´çš„è¿˜æ²¡æœ‰å­˜å…¥å…ƒç´ çš„listå¯¹è±¡ã€‚\n3.æ·»åŠ å…ƒç´  1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 int PyList_SetItem(PyObject *op, Py_ssize_t i, PyObject *newitem) { PyObject **p; // æ ¡éªŒæ˜¯å¦æ˜¯PyListObjectçš„å­—ç±» if (!PyList_Check(op)) { // å¦‚æœä¸æ˜¯opä¸æ˜¯PyListObjectå¯¹è±¡æˆ–å­ç±»ï¼Œåˆ™å°†newitemçš„å¼•ç”¨è®¡æ•°å™¨å‡ä¸€ï¼Œ // è¯´æ˜æ­¤å¤„æ²¡æœ‰å¼•ç”¨newitemã€‚ // Py_XDECREFå†…éƒ¨ä¼šæ ¡éªŒob_refcntæ˜¯å¦ä¸º0ï¼Œè‹¥ä¸º0ï¼Œåˆ™è°ƒç”¨_Py_Dealloc(op) Py_XDECREF(newitem); PyErr_BadInternalCall(); return -1; } // valid_indexå°±åšäº†ä¸€ä»¶äº‹å„¿ï¼Œåˆ¤æ–­ç´¢å¼•æ˜¯å¦åœ¨0ï½len(op)ä¹‹é—´ // Py_ssize_t == longï¼Œsize_t == unsigned long // (size_t) i \u0026lt; (size_t) limit if (!valid_index(i, Py_SIZE(op))) { Py_XDECREF(newitem); PyErr_SetString(PyExc_IndexError, \u0026#34;list assignment index out of range\u0026#34;); return -1; } // æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šç´¢å¼•ä½ç½®çš„å†…å­˜é¦–åœ°å€ p = ((PyListObject *)op) -\u0026gt; ob_item + i; // æ­¤å¤„ä¼šå°†å‘pæŒ‡é’ˆä½ç½®è®¾ç½®å…ƒç´ ï¼Œå¹¶å°†æ—§å†…å­˜ä½ç½®çš„å¯¹è±¡å¼•ç”¨è®¡æ•°å‡ä¸€ Py_XSETREF(*p, newitem); return 0; } #define Py_XSETREF(op, op2) \\ do { \\ PyObject *_py_tmp = _PyObject_CAST(op); \\ (op) = (op2); \\ Py_XDECREF(_py_tmp); \\ } while (0) è®¾ç½®å…ƒç´ æ—¶ä¸»è¦ä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ã€ç´¢å¼•æ£€æŸ¥ï¼Œä¸»è¦ç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯listå­ç±»æˆ–è€…ç´¢å¼•æ˜¯å¦è¶Šç•Œã€‚ è·å–æŒ‡å®šç´¢å¼•å†…å­˜çš„é¦–åœ°å€ï¼Œè·å–åˆ°å†…å­˜ä¸­çš„æ—§å¯¹è±¡ï¼Œå¹¶è®¾ç½®ä¸ºæ–°çš„å¯¹è±¡ æ—§å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å‡1ï¼Œå¦‚æœä¸º0ï¼Œåˆ™è§¦å‘å†…å­˜å›æ”¶ã€‚ 4.æ’å…¥å…ƒç´  æ’å…¥å…ƒç´ å’Œè®¾ç½®å…ƒç´ çš„é€»è¾‘ä¸åŒï¼Œè®¾ç½®å…ƒç´ åªéœ€è¦åœ¨æŒ‡å®šå†…å­˜ä½ç½®è®¾ç½®å€¼ï¼Œä½†æ˜¯æ’å…¥å…ƒç´ éœ€è¦è€ƒè™‘åˆ°åŸæ¥çš„å…ƒç´ çš„ç§»åŠ¨ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 \u0026gt;\u0026gt;\u0026gt; l = [0, 0, 0, 0, 0] \u0026gt;\u0026gt;\u0026gt; l[1] = 1 \u0026gt;\u0026gt;\u0026gt; l [0, 1, 0, 0, 0] \u0026gt;\u0026gt;\u0026gt; l.insert(1, 2) \u0026gt;\u0026gt;\u0026gt; l [0, 2, 1, 0, 0, 0] ä»ç¤ºä¾‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œinsertæ—¶ï¼ŒåŸæœ¬ç´¢å¼•1ä¸Šçš„å…ƒç´ 1ï¼Œè¢«ç§»åŠ¨åˆ°ç´¢å¼•2ä¸Šäº†ï¼Œç´¢å¼•1ç°åœ¨çš„å…ƒç´ æ˜¯2ã€‚\næ’å…¥å…ƒç´ çš„ä¸»è¦é€»è¾‘æ˜¯static int ins1(PyListObject *self, Py_ssize_t where, PyObject *v)å‡½æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 static int ins1(PyListObject *self, Py_ssize_t where, PyObject *v) { Py_ssize_t i, n = Py_SIZE(self); PyObject **items; ... // æ£€æŸ¥ assert((size_t)n + 1 \u0026lt; PY_SSIZE_T_MAX); // ä¿è¯PyListObjectæœ‰è¶³å¤Ÿçš„å†…å­˜æ¥å®¹çº³æˆ‘ä»¬æœŸæœ›æ’å…¥çš„å…ƒç´  // å¦‚æœå†…å­˜ä¸å¤Ÿï¼Œåˆ™ä¼šé‡æ–°ç”³è¯·ç©ºé—´ if (list_resize(self, n+1) \u0026lt; 0) return -1; // ç¡®å®šæ’å…¥çš„ä½ç½® if (where \u0026lt; 0) { where += n; // å¦‚æœwhereå°äº0ï¼Œåˆ™å°†å…ƒç´ æ’å…¥èµ·å§‹ä½ç½®ï¼Œå³ç´¢å¼•ä¸º0 if (where \u0026lt; 0) where = 0; } // å¦‚æœwhereå¤§äºnï¼Œåˆ™å°†å…ƒç´ æ’å…¥åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ çš„åé¢ï¼Œå³ç´¢å¼•ä¸ºlen(list) if (where \u0026gt; n) where = n; // å°†items[i]çš„å…ƒç´ åç§»åˆ°items[i+1]çš„ä½ç½® items = self-\u0026gt;ob_item; for (i = n; --i \u0026gt;= where; ) items[i+1] = items[i]; Py_INCREF(v); // åœ¨whereç´¢å¼•ä½ç½®è®¾ç½®å…ƒç´  items[where] = v; return 0; } int PyList_Insert(PyObject *op, Py_ssize_t where, PyObject *newitem) { if (!PyList_Check(op)) { PyErr_BadInternalCall(); return -1; } return ins1((PyListObject *)op, where, newitem); } åœ¨ins1å‡½æ•°ä¸­ï¼Œä¸ºäº†å®Œæˆå…ƒç´ çš„æ’å…¥å·¥ä½œï¼Œå¿…é¡»é¦–å…ˆç¡®ä¿PyListObjectå¯¹è±¡æœ‰è¶³å¤Ÿçš„å†…å­˜æ¥å®¹çº³æˆ‘ä»¬æœŸæœ›æ’å…¥çš„å…ƒç´ ã€‚Pythoné€šè¿‡è°ƒç”¨list_resizeå‡½æ•°ç¡®ä¿è¿™ä¸€ç‚¹ã€‚\nåœ¨list_resizeå‡½æ•°ä¸­ï¼š\nallocated \u0026gt;= (n + 1) \u0026amp;\u0026amp; (n + 1) \u0026gt;= (allocated \u0026gt;\u0026gt; 1)ï¼Œå¦‚æœå·²ç”³è¯·çš„å†…å­˜å·²æ»¡è¶³ä½¿ç”¨ï¼Œåˆ™å°†selfâ†’ob_baseâ†’ob_sizeè®¾ç½®ä¸ºn+1çš„å€¼ é‡æ–°è°ƒç”¨PyMem_Reallocç”³è¯·å†…å­˜ç©ºé—´ ç¡®è®¤å…ƒç´ çš„æ’å…¥ç‚¹ï¼Œå¦‚æœwhere\u0026lt;0å°±åŠ ä¸Šnï¼Œnå³æ˜¯lenï¼Œä¾‹å¦‚where=-1ï¼Œn=5é‚£ä¹ˆå°±è®¾ç½®whereä¸º-1+5=4çš„ä½ç½®ã€‚å¦‚æœè®¡ç®—å®Œæˆåè¿˜å°äº0ï¼Œå°±è®¾ç½®where=0ã€‚å¦‚æœwhere\u0026gt;nï¼Œåˆ™å°†whereè®¾ç½®ä¸ºnï¼Œå³åœ¨åˆ—è¡¨æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹ä¸€ä¸ªä½ç½®æ’å…¥å…ƒç´ ã€‚\n1 2 3 4 5 6 7 8 9 10 \u0026gt;\u0026gt;\u0026gt; l = [0, 0, 0, 0, 0] \u0026gt;\u0026gt;\u0026gt; l.insert(-1, 1) // åœ¨where=-1+5çš„ä½ç½®æ’å…¥ \u0026gt;\u0026gt;\u0026gt; l [0, 0, 0, 0, 1, 0] \u0026gt;\u0026gt;\u0026gt; l.insert(-10, 1) // åœ¨where=0çš„ä½ç½®æ’å…¥ \u0026gt;\u0026gt;\u0026gt; l [1, 0, 0, 0, 0, 1, 0] \u0026gt;\u0026gt;\u0026gt; l.insert(10, 1) // åœ¨where=7çš„ä½ç½®æ’å…¥ \u0026gt;\u0026gt;\u0026gt; l [1, 0, 0, 0, 0, 1, 0, 1] å°†whereåˆ°nä¹‹é—´çš„å…ƒç´ å…¨éƒ¨åç§»ï¼Œé—­åŒºé—´ [where, n]ã€‚\nä¸ºè¦æ·»åŠ çš„å…ƒç´ vå¢åŠ å¼•ç”¨è®¡æ•°\nå› ä¸ºæ­¥éª¤3çš„æ“ä½œï¼Œç°åœ¨items[where]çš„ä½ç½®å·²ç»æ²¡æœ‰å…ƒç´ äº†ï¼Œæ‰€ä»¥ins1å‡½æ•°çš„æœ€åä¸€æ­¥å°±æ˜¯å°†è¦æ·»åŠ çš„å…ƒç´ vè®¾ç½®åˆ°whereçš„ä½ç½®ä¸Šï¼šitems[where] = v;ã€‚\nåœ¨Pythonè¿˜æœ‰appendå‡½æ•°ï¼ˆPyList_Appendå‡½æ•°ï¼‰ä¹Ÿå¯ä»¥æ’å…¥æ•°æ®ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 int _PyList_AppendTakeRefListResize(PyListObject *self, PyObject *newitem) { Py_ssize_t len = PyList_GET_SIZE(self); assert(self-\u0026gt;allocated == -1 || self-\u0026gt;allocated == len); // é‡æ–°ç”³è¯·ç©ºé—´ if (list_resize(self, len + 1) \u0026lt; 0) { Py_DECREF(newitem); return -1; } // è®¾ç½®å…ƒç´  PyList_SET_ITEM(self, len, newitem); return 0; } static inline int _PyList_AppendTakeRef(PyListObject *self, PyObject *newitem) { ... // æ£€æŸ¥ä¸¤ä¸ªæŒ‡é’ˆå’Œselfç±»å‹ Py_ssize_t len = PyList_GET_SIZE(self); Py_ssize_t allocated = self-\u0026gt;allocated; assert((size_t)len + 1 \u0026lt; PY_SSIZE_T_MAX); // å¦‚æœå·²ç”³è¯·çš„å†…å­˜ç©ºé—´å·²ç»å¤§äºlenï¼Œè¯´æ˜æœ‰å¤šä½™çš„å†…å­˜ç©ºé—´ï¼Œç›´æ¥åœ¨lenä½ç½®è¿½åŠ å…ƒç´  if (allocated \u0026gt; len) { PyList_SET_ITEM(self, len, newitem); Py_SET_SIZE(self, len + 1); return 0; } return _PyList_AppendTakeRefListResize(self, newitem); } int PyList_Append(PyObject *op, PyObject *newitem) { if (PyList_Check(op) \u0026amp;\u0026amp; (newitem != NULL)) { Py_INCREF(newitem); return _PyList_AppendTakeRef((PyListObject *)op, newitem); } PyErr_BadInternalCall(); return -1; } åœ¨è¿›è¡Œappendæ“ä½œæ—¶ï¼Œä¹Ÿä¼šè¿›è¡Œå†…å­˜ç©ºé—´çš„åˆ¤æ–­ï¼Œå¦‚æœallocated\u0026gt;lenï¼Œåˆ™è¯´æ˜å·²ç”³è¯·å†…å­˜ç©ºé—´å¤§äºå·²ä½¿ç”¨å†…å­˜ç©ºé—´ï¼Œå¯ä»¥ç›´æ¥åœ¨lenä½ç½®è¿½åŠ å…ƒç´ ã€‚å¦‚æœç©ºé—´ä¸å¤Ÿä¹Ÿä¼šé‡æ–°ç”³è¯·å†…å­˜ç©ºé—´ã€‚\n5.è·å–å…ƒç´  1 2 3 4 5 6 7 8 9 10 11 12 13 14 PyObject * PyList_GetItem(PyObject *op, Py_ssize_t i) { if (!PyList_Check(op)) { PyErr_BadInternalCall(); return NULL; } if (!valid_index(i, Py_SIZE(op))) { _Py_DECLARE_STR(list_err, \u0026#34;list index out of range\u0026#34;); PyErr_SetObject(PyExc_IndexError, \u0026amp;_Py_STR(list_err)); return NULL; } return ((PyListObject *)op) -\u0026gt; ob_item[i]; } è·å–å…ƒç´ æ—¶ï¼Œå°±æ˜¯ç›´æ¥åœ¨PyListObjectå¯¹è±¡çš„ob_itemä¸Šè¿›è¡Œç´¢å¼•å¯¹åº”çš„å…ƒç´ ã€‚\n6.åˆ é™¤å…ƒç´  é€šè¿‡è°ƒç”¨list.remove(1)å‡½æ•°åˆ é™¤å¯¹è±¡æ—¶ï¼Œå¯¹åº”çš„Cæºç æ˜¯list_removeå‡½æ•°ã€‚\nåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šå¾ªç¯æ¯”è¾ƒob_itemä¸­çš„å…ƒç´ æ˜¯ä¸æ˜¯å’Œè¦åˆ é™¤çš„valueä¸€æ ·ï¼Œåˆ é™¤ç¬¬ä¸€ä¸ªç›¸åŒçš„å…ƒç´ å¹¶è¿”å›ã€‚å…·ä½“åˆ é™¤é€»è¾‘åœ¨list_ass_sliceå‡½æ•°ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 static PyObject * list_remove(PyListObject *self, PyObject *value) { Py_ssize_t i; for (i = 0; i \u0026lt; Py_SIZE(self); i++) { PyObject *obj = self-\u0026gt;ob_item[i]; Py_INCREF(obj); int cmp = PyObject_RichCompareBool(obj, value, Py_EQ); Py_DECREF(obj); if (cmp \u0026gt; 0) { if (list_ass_slice(self, i, i+1, (PyObject *)NULL) == 0) Py_RETURN_NONE; return NULL; } else if (cmp \u0026lt; 0) return NULL; } PyErr_SetString(PyExc_ValueError, \u0026#34;list.remove(x): x not in list\u0026#34;); return NULL; } list_ass_sliceå¯¹åº”äº†ä¸¤ç§æ“ä½œï¼š\na[ilow:ihigh] = v if v != NULL del a[ilow:ihigh] if v == NULL å½“è°ƒç”¨list.remove(1)æ—¶ï¼Œv = NULLï¼Œæ‰€ä»¥è¿™æ˜¯å¯¹åº”çš„åˆ é™¤æ“ä½œã€‚\nåœ¨list_ass_sliceå‡½æ•°ä¸­è¿›è¡Œå…ƒç´ åˆ é™¤åŠ¨ä½œæ—¶ï¼Œå®é™…ä¸Šæ˜¯é€šè¿‡memmoveå’Œmemcpyæ¥å®ç°çš„ã€‚\n7.ç¼“å­˜æœºåˆ¶ å‰é¢æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†free_listï¼Œè€Œfree_listæ˜¯åœ¨Pythonè§£é‡Šå™¨å¯åŠ¨çš„æ—¶å€™åˆ›å»ºçš„ï¼Œé‚£ä¹ˆfree_listä¸­ç¼“å­˜çš„å¯¹è±¡æ—¶ä»€ä¹ˆæ—¶å€™æ·»åŠ çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åœ¨PyListObjecté”€æ¯è¿‡ç¨‹ä¸­ã€‚PyListObjectçš„é”€æ¯é€»è¾‘æ˜¯åœ¨list_deallocå‡½æ•°ä¸­ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 static void list_dealloc(PyListObject *op) { Py_ssize_t i; PyObject_GC_UnTrack(op); Py_TRASHCAN_BEGIN(op, list_dealloc) // å°†ob_itemä¸­çš„å…ƒç´ æ•°æ®çš„å¼•ç”¨è®¡æ•°å‡1ï¼Œå¹¶é‡Šæ”¾ob_itemçš„å†…å­˜ã€‚ if (op-\u0026gt;ob_item != NULL) { /* Do it backwards, for Christian Tismer. There\u0026#39;s a simple test case where somehow this reduces thrashing when a *very* large list is created and immediately deleted. */ i = Py_SIZE(op); while (--i \u0026gt;= 0) { Py_XDECREF(op-\u0026gt;ob_item[i]); } PyMem_Free(op-\u0026gt;ob_item); } #if PyList_MAXFREELIST \u0026gt; 0 struct _Py_list_state *state = get_list_state(); #ifdef Py_DEBUG // list_dealloc() must not be called after _PyList_Fini() assert(state-\u0026gt;numfree != -1); #endif // å¦‚æœnumfreeè¿˜æœªæ»¡80ä¸ªï¼Œåˆ™åœ¨free_listä¸Šç»§ç»­ç¼“å­˜PyListObjectå¯¹è±¡ if (state-\u0026gt;numfree \u0026lt; PyList_MAXFREELIST \u0026amp;\u0026amp; PyList_CheckExact(op)) { state-\u0026gt;free_list[state-\u0026gt;numfree++] = op; OBJECT_STAT_INC(to_freelist); } else #endif { // å¦åˆ™å°±é‡Šæ”¾PyListObjectçš„å†…å­˜ Py_TYPE(op)-\u0026gt;tp_free((PyObject *)op); } Py_TRASHCAN_END } åœ¨list_deallocå‡½æ•°ä¸­ï¼Œç¬¬ä¸€æ­¥æ˜¯å…ˆé‡Šæ”¾ob_itemä¸­çš„å…ƒç´ å’Œob_itemçš„å†…å­˜ ç„¶åä¼šåˆ¤æ–­free_listç¼“å­˜æ˜¯å¦å·²ç»å­˜æ»¡çš„PyListObjectå¯¹è±¡ å¦‚æœå­˜æ»¡äº†ï¼Œå°±ç›´æ¥è°ƒç”¨PyListObjectå¯¹è±¡çš„PyTypeObjectå¯¹è±¡ä¸­çš„tp_freeå‡½æ•°é‡Šæ”¾å†…å­˜ç©ºé—´ å¦‚æœæœªå­˜æ»¡ï¼Œåˆ™numfreeåŠ ä¸€ï¼Œå¹¶å°†ç¼“å­˜å¯¹è±¡æ”¾å…¥free_list[numfree]ä½ç½®ã€‚ å½“åˆ›å»ºæ–°çš„PyListObjectå¯¹è±¡æ—¶ï¼Œä¼šå°è¯•ä»free_listæ•°ç»„ä¸­è·å–ï¼Œè¿™æ ·å°±çœå»äº†é‡Šæ”¾å†…å­˜å’Œé‡æ–°ç”³è¯·å†…å­˜çš„æ“ä½œã€‚\n","permalink":"https://zzhaolei.github.io/posts/python%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0python%E4%B8%AD%E7%9A%84%E5%88%97%E8%A1%A8%E5%AF%B9%E8%B1%A1/","summary":"\u003ch2 id=\"1åˆ—è¡¨ç»“æ„ä½“\"\u003e1.åˆ—è¡¨ç»“æ„ä½“\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define PyObject_VAR_HEAD      PyVarObject ob_base;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyObject\u003c/span\u003e \u003cspan class=\"n\"\u003eob_base\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePy_ssize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eob_size\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e \u003cspan class=\"cm\"\u003e/* Number of items in variable part */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ePyVarObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyObject_VAR_HEAD\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"cm\"\u003e/* Vector of pointers to list elements.  list[0] is ob_item[0], etc. */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyObject\u003c/span\u003e \u003cspan class=\"o\"\u003e**\u003c/span\u003e\u003cspan class=\"n\"\u003eob_item\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"cm\"\u003e/* ob_item contains space for \u0026#39;allocated\u0026#39; elements.  The number\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     * currently in use is ob_size.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     * Invariants:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     *     0 \u0026lt;= ob_size \u0026lt;= allocated\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     *     len(list) == ob_size\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     *     ob_item == NULL implies ob_size == allocated == 0\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     * list.sort() temporarily sets allocated to -1 to detect mutations.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     * Items must normally not be NULL, except during construction when\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     * the list is not yet visible outside the function that builds it.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e     */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePy_ssize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eallocated\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ePyListObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003eob_item\u003c/code\u003eæ˜¯æŒ‡å‘åˆ—è¡¨å…ƒç´ çš„æŒ‡é’ˆå‘é‡ï¼Œå½“æˆ‘ä»¬é€šè¿‡\u003ccode\u003elist[0]\u003c/code\u003eè·å–å…ƒç´ æ—¶ï¼Œå®é™…ä¸Šæ˜¯è·å–çš„\u003ccode\u003eob_item[0]\u003c/code\u003eçš„å…ƒç´ ã€‚\u003ccode\u003eob_item\u003c/code\u003eçš„ç±»å‹æ˜¯\u003ccode\u003ePyObject*\u003c/code\u003eï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œä¸ºä»€ä¹ˆ\u003ccode\u003ePython\u003c/code\u003eä¸­çš„\u003ccode\u003elist\u003c/code\u003eèƒ½å­˜å‚¨ä»»æ„å¯¹è±¡çš„æ•°æ®ï¼Œè¿™æ˜¯å› ä¸ºä»»ä½•\u003ccode\u003ePython\u003c/code\u003eå¯¹è±¡éƒ½å¯ä»¥å¼ºè½¬ä¸º\u003ccode\u003ePyObject*\u003c/code\u003eçš„æŒ‡é’ˆç±»å‹ã€‚\u003c/p\u003e","title":"Pythonæºç ç¬”è®°â€”â€”Pythonä¸­çš„åˆ—è¡¨å¯¹è±¡"},{"content":"1.å­—ç¬¦ä¸²å¯¹è±¡ åœ¨Python3.11.2ä¸­ï¼Œå­—ç¬¦ä¸²ç±»å‹PyUnicodeObjectçš„å®ç°ç›¸å½“çš„å¤æ‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 typedef struct { PyObject_HEAD Py_ssize_t length; /* Number of code points in the string */ Py_hash_t hash; /* Hash value; -1 if not set */ struct { ... } state; wchar_t *wstr; /* wchar_t representation (null-terminated) */ } PyASCIIObject; typedef struct { PyASCIIObject _base; Py_ssize_t utf8_length; /* Number of bytes in utf8, excluding the * terminating \\0. */ char *utf8; /* UTF-8 representation (null-terminated) */ Py_ssize_t wstr_length; /* Number of code points in wstr, possible * surrogates count as two code points. */ } PyCompactUnicodeObject; typedef struct { PyCompactUnicodeObject _base; union { void *any; Py_UCS1 *latin1; Py_UCS2 *ucs2; Py_UCS4 *ucs4; } data; /* Canonical, smallest-form Unicode buffer */ } PyUnicodeObject; ç±»å‹å¯¹è±¡\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 PyTypeObject PyUnicode_Type = { PyVarObject_HEAD_INIT(\u0026amp;PyType_Type, 0) \u0026#34;str\u0026#34;, /* tp_name */ sizeof(PyUnicodeObject), /* tp_basicsize */ 0, /* tp_itemsize */ /* Slots */ (destructor)unicode_dealloc, /* tp_dealloc */ ... unicode_repr, /* tp_repr */ \u0026amp;unicode_as_number, /* tp_as_number */ \u0026amp;unicode_as_sequence, /* tp_as_sequence */ \u0026amp;unicode_as_mapping, /* tp_as_mapping */ ... (reprfunc) unicode_str, /* tp_str */ ... unicode_doc, /* tp_doc */ ... 0, /* tp_init */ 0, /* tp_alloc */ unicode_new, /* tp_new */ PyObject_Del, /* tp_free */ }; 2.åˆ›å»º åˆ›å»ºå­—ç¬¦ä¸²æ—¶ä¼šè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœé•¿åº¦ä¸º0ï¼Œå°±ä¼šä½¿ç”¨è§£é‡Šå™¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¥½çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 PyObject * PyUnicode_New(Py_ssize_t size, Py_UCS4 maxchar) { /* Optimization for empty strings */ if (size == 0) { return unicode_new_empty(); } PyObject *obj; PyCompactUnicodeObject *unicode; void *data; enum PyUnicode_Kind kind; int is_sharing, is_ascii; Py_ssize_t char_size; Py_ssize_t struct_size; ... /* Ensure we won\u0026#39;t overflow the size. */ if (size \u0026lt; 0) { PyErr_SetString(PyExc_SystemError, \u0026#34;Negative size passed to PyUnicode_New\u0026#34;); return NULL; } if (size \u0026gt; ((PY_SSIZE_T_MAX - struct_size) / char_size - 1)) return PyErr_NoMemory(); /* Duplicated allocation code from _PyObject_New() instead of a call to * PyObject_New() so we are able to allocate space for the object and * it\u0026#39;s data buffer. */ obj = (PyObject *) PyObject_Malloc(struct_size + (size + 1) * char_size); if (obj == NULL) { return PyErr_NoMemory(); } _PyObject_Init(obj, \u0026amp;PyUnicode_Type); unicode = (PyCompactUnicodeObject *)obj; if (is_ascii) data = ((PyASCIIObject*)obj) + 1; else data = unicode + 1; _PyUnicode_LENGTH(unicode) = size; _PyUnicode_HASH(unicode) = -1; _PyUnicode_STATE(unicode).interned = 0; _PyUnicode_STATE(unicode).kind = kind; _PyUnicode_STATE(unicode).compact = 1; _PyUnicode_STATE(unicode).ready = 1; _PyUnicode_STATE(unicode).ascii = is_ascii; ... assert(_PyUnicode_CheckConsistency((PyObject*)unicode, 0)); return obj; } é’ˆå¯¹ä»…åŒ…å«ASCIIå­—ç¬¦çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„å€¼ç›¸åŒï¼Œé‚£ä¹ˆPythonä¸ä¼šæ–°å¼€è¾Ÿç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥å¼•ç”¨åŒä¸€å—å†…å­˜ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # ä»…æœ‰ASCII \u0026gt;\u0026gt;\u0026gt; a = \u0026#34;asdfasdfasfsdfasfsddsfadsf\u0026#34; \u0026gt;\u0026gt;\u0026gt; b = \u0026#34;asdfasdfasfsdfasfsddsfadsf\u0026#34; \u0026gt;\u0026gt;\u0026gt; id(a) 4528982496 \u0026gt;\u0026gt;\u0026gt; id(b) 4528982496 \u0026gt;\u0026gt;\u0026gt; import sys \u0026gt;\u0026gt;\u0026gt; sys.getrefcount(a) 3 \u0026gt;\u0026gt;\u0026gt; sys.getrefcount(b) 3 # åŒ…å«ä¸­æ–‡ \u0026gt;\u0026gt;\u0026gt; a = \u0026#34;ä¸­å›½\u0026#34; \u0026gt;\u0026gt;\u0026gt; b = \u0026#34;ä¸­å›½\u0026#34; \u0026gt;\u0026gt;\u0026gt; id(a) 4528970928 \u0026gt;\u0026gt;\u0026gt; id(b) 4528969488 \u0026gt;\u0026gt;\u0026gt; sys.getrefcount(a) 2 \u0026gt;\u0026gt;\u0026gt; sys.getrefcount(b) 2 # åŒ…å«ä¸­æ–‡ï¼Œä½†ç›´æ¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ \u0026gt;\u0026gt;\u0026gt; a = \u0026#34;ä¸­å›½\u0026#34; \u0026gt;\u0026gt;\u0026gt; b = a \u0026gt;\u0026gt;\u0026gt; id(a) 4528970928 \u0026gt;\u0026gt;\u0026gt; id(b) 4528970928 \u0026gt;\u0026gt;\u0026gt; sys.getrefcount(a) 3 \u0026gt;\u0026gt;\u0026gt; sys.getrefcount(b) 3 3.é”€æ¯ å½“é”€æ¯æ—¶ï¼Œä¼šè°ƒç”¨PyUnicode_Typeä¸­çš„tp_deallocå‡½æ•°ï¼Œå‡½æ•°ä¸­ä¼šåˆ¤æ–­state.internedçš„å€¼ï¼Œå¦‚æœæ˜¯1ï¼Œåˆ™å°†å­—ç¬¦ä¸²çš„ä»state.internedä¸­åˆ é™¤ï¼Œå¹¶è®¾ç½®å¼•ç”¨è®¡æ•°ä¸º0ï¼Œæœ€åä¼šé‡Šæ”¾ç©ºé—´ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 static void unicode_dealloc(PyObject *unicode) { #ifdef Py_DEBUG if (!unicode_is_finalizing() \u0026amp;\u0026amp; unicode_is_singleton(unicode)) { _Py_FatalRefcountError(\u0026#34;deallocating an Unicode singleton\u0026#34;); } #endif switch (PyUnicode_CHECK_INTERNED(unicode)) { case SSTATE_NOT_INTERNED: break; case SSTATE_INTERNED_MORTAL: { /* Revive the dead object temporarily. PyDict_DelItem() removes two references (key and value) which were ignored by PyUnicode_InternInPlace(). Use refcnt=3 rather than refcnt=2 to prevent calling unicode_dealloc() again. Adjust refcnt after PyDict_DelItem(). */ assert(Py_REFCNT(unicode) == 0); Py_SET_REFCNT(unicode, 3); if (PyDict_DelItem(interned, unicode) != 0) { _PyErr_WriteUnraisableMsg(\u0026#34;deletion of interned string failed\u0026#34;, NULL); } assert(Py_REFCNT(unicode) == 1); Py_SET_REFCNT(unicode, 0); break; } case SSTATE_INTERNED_IMMORTAL: _PyObject_ASSERT_FAILED_MSG(unicode, \u0026#34;Immortal interned string died\u0026#34;); break; default: Py_UNREACHABLE(); } if (_PyUnicode_HAS_WSTR_MEMORY(unicode)) { PyObject_Free(_PyUnicode_WSTR(unicode)); } if (_PyUnicode_HAS_UTF8_MEMORY(unicode)) { PyObject_Free(_PyUnicode_UTF8(unicode)); } if (!PyUnicode_IS_COMPACT(unicode) \u0026amp;\u0026amp; _PyUnicode_DATA_ANY(unicode)) { PyObject_Free(_PyUnicode_DATA_ANY(unicode)); } Py_TYPE(unicode)-\u0026gt;tp_free(unicode); } ","permalink":"https://zzhaolei.github.io/posts/python%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0python%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E8%B1%A1/","summary":"\u003ch2 id=\"1å­—ç¬¦ä¸²å¯¹è±¡\"\u003e1.å­—ç¬¦ä¸²å¯¹è±¡\u003c/h2\u003e\n\u003cp\u003eåœ¨\u003ccode\u003ePython3.11.2\u003c/code\u003eä¸­ï¼Œå­—ç¬¦ä¸²ç±»å‹\u003ccode\u003ePyUnicodeObject\u003c/code\u003eçš„å®ç°ç›¸å½“çš„å¤æ‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyObject_HEAD\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePy_ssize_t\u003c/span\u003e \u003cspan class=\"n\"\u003elength\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e          \u003cspan class=\"cm\"\u003e/* Number of code points in the string */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePy_hash_t\u003c/span\u003e \u003cspan class=\"n\"\u003ehash\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e             \u003cspan class=\"cm\"\u003e/* Hash value; -1 if not set */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003ewchar_t\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003ewstr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e              \u003cspan class=\"cm\"\u003e/* wchar_t representation (null-terminated) */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ePyASCIIObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyASCIIObject\u003c/span\u003e \u003cspan class=\"n\"\u003e_base\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePy_ssize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eutf8_length\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"cm\"\u003e/* Number of bytes in utf8, excluding the\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e                                 * terminating \\0. */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"kt\"\u003echar\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eutf8\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                 \u003cspan class=\"cm\"\u003e/* UTF-8 representation (null-terminated) */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePy_ssize_t\u003c/span\u003e \u003cspan class=\"n\"\u003ewstr_length\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e     \u003cspan class=\"cm\"\u003e/* Number of code points in wstr, possible\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e                                 * surrogates count as two code points. */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ePyCompactUnicodeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyCompactUnicodeObject\u003c/span\u003e \u003cspan class=\"n\"\u003e_base\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eunion\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"kt\"\u003evoid\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eany\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ePy_UCS1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003elatin1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ePy_UCS2\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eucs2\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ePy_UCS4\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eucs4\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e                     \u003cspan class=\"cm\"\u003e/* Canonical, smallest-form Unicode buffer */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ePyUnicodeObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eç±»å‹å¯¹è±¡\u003c/p\u003e","title":"Pythonæºç ç¬”è®°â€”â€”Pythonä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡"},{"content":"1.æ•´æ•°å¯¹è±¡ åœ¨Python3.11.2ä¸­ï¼Œæ•´æ•°ç»“æ„ä½“å«åšPyLongObjectã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #if PYLONG_BITS_IN_DIGIT == 30 typedef uint32_t digit; ... #elif PYLONG_BITS_IN_DIGIT == 15 typedef unsigned short digit; ... #else #error \u0026#34;PYLONG_BITS_IN_DIGIT should be 15 or 30\u0026#34; #endif typedef struct _longobject { /* PyObject ob_base; Py_ssize_t ob_size; */ PyObject_VAR_HEAD digit ob_digit[1]; } PyLongObject; é€šè¿‡PyObject_VAR_HEADæˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œåœ¨æ–°ç‰ˆPythonä¸­ï¼Œæ•´å½¢æ˜¯ä¸€ä¸ªä¸å®šé•¿å¯¹è±¡ã€‚\né€šè¿‡å‰é¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºPythonä¸­çš„å¯¹è±¡ï¼Œä¸å¯¹è±¡ç›¸å…³çš„å…ƒä¿¡æ¯å®é™…ä¸Šéƒ½ä¿å­˜åœ¨ä¸å¯¹è±¡å¯¹åº”çš„ç±»å‹å¯¹è±¡ä¸­ï¼Œå¯¹äºPyLongObjectï¼Œè¿™ä¸ªç±»å‹å¯¹è±¡æ˜¯PyLong_Typeã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 PyTypeObject PyLong_Type = { PyVarObject_HEAD_INIT(\u0026amp;PyType_Type, 0) \u0026#34;int\u0026#34;, /* tp_name */ offsetof(PyLongObject, ob_digit), /* tp_basicsize */ sizeof(digit), /* tp_itemsize */ 0, /* tp_dealloc */ 0, /* tp_vectorcall_offset */ 0, /* tp_getattr */ 0, /* tp_setattr */ 0, /* tp_as_async */ long_to_decimal_string, /* tp_repr */ \u0026amp;long_as_number, /* tp_as_number */ 0, /* tp_as_sequence */ 0, /* tp_as_mapping */ (hashfunc)long_hash, /* tp_hash */ 0, /* tp_call */ 0, /* tp_str */ PyObject_GenericGetAttr, /* tp_getattro */ 0, /* tp_setattro */ 0, /* tp_as_buffer */ Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE | Py_TPFLAGS_LONG_SUBCLASS | _Py_TPFLAGS_MATCH_SELF, /* tp_flags */ long_doc, /* tp_doc */ 0, /* tp_traverse */ 0, /* tp_clear */ long_richcompare, /* tp_richcompare */ 0, /* tp_weaklistoffset */ 0, /* tp_iter */ 0, /* tp_iternext */ long_methods, /* tp_methods */ 0, /* tp_members */ long_getset, /* tp_getset */ 0, /* tp_base */ 0, /* tp_dict */ 0, /* tp_descr_get */ 0, /* tp_descr_set */ 0, /* tp_dictoffset */ 0, /* tp_init */ 0, /* tp_alloc */ long_new, /* tp_new */ PyObject_Free, /* tp_free */ }; PyLongObjectå¯¹è±¡çš„å„ç§æ“ä½œï¼ˆæ¯”è¾ƒã€è¿ç®—ç­‰ï¼‰å®é™…ä¸Šå°±æ˜¯è°ƒç”¨PyLong_Typeä¸­çš„tp_as_numberè¿™ä¸ªç»“æ„ä½“ä¸­å®šä¹‰çš„å„ç§å‡½æ•°æŒ‡é’ˆã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 static PyNumberMethods long_as_number = { (binaryfunc)long_add, /*nb_add*/ (binaryfunc)long_sub, /*nb_subtract*/ (binaryfunc)long_mul, /*nb_multiply*/ long_mod, /*nb_remainder*/ long_divmod, /*nb_divmod*/ long_pow, /*nb_power*/ (unaryfunc)long_neg, /*nb_negative*/ long_long, /*tp_positive*/ (unaryfunc)long_abs, /*tp_absolute*/ (inquiry)long_bool, /*tp_bool*/ (unaryfunc)long_invert, /*nb_invert*/ long_lshift, /*nb_lshift*/ long_rshift, /*nb_rshift*/ long_and, /*nb_and*/ long_xor, /*nb_xor*/ long_or, /*nb_or*/ long_long, /*nb_int*/ 0, /*nb_reserved*/ long_float, /*nb_float*/ 0, /* nb_inplace_add */ 0, /* nb_inplace_subtract */ 0, /* nb_inplace_multiply */ 0, /* nb_inplace_remainder */ 0, /* nb_inplace_power */ 0, /* nb_inplace_lshift */ 0, /* nb_inplace_rshift */ 0, /* nb_inplace_and */ 0, /* nb_inplace_xor */ 0, /* nb_inplace_or */ long_div, /* nb_floor_divide */ long_true_divide, /* nb_true_divide */ 0, /* nb_inplace_floor_divide */ 0, /* nb_inplace_true_divide */ long_long, /* nb_index */ }; åœ¨3.11.2ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°long_addå‡½æ•°ä¸éœ€è¦è¿›è¡Œæº¢å‡ºæ£€æŸ¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 #define CHECK_BINOP(v,w) \\ do { \\ if (!PyLong_Check(v) || !PyLong_Check(w)) \\ Py_RETURN_NOTIMPLEMENTED; \\ } while(0) static PyObject * long_add(PyLongObject *a, PyLongObject *b) { CHECK_BINOP(a, b); return _PyLong_Add(a, b); } PyObject * _PyLong_Add(PyLongObject *a, PyLongObject *b) { if (IS_MEDIUM_VALUE(a) \u0026amp;\u0026amp; IS_MEDIUM_VALUE(b)) { return _PyLong_FromSTwoDigits(medium_value(a) + medium_value(b)); } PyLongObject *z; if (Py_SIZE(a) \u0026lt; 0) { if (Py_SIZE(b) \u0026lt; 0) { z = x_add(a, b); if (z != NULL) { /* x_add received at least one multiple-digit int, and thus z must be a multiple-digit int. That also means z is not an element of small_ints, so negating it in-place is safe. */ assert(Py_REFCNT(z) == 1); Py_SET_SIZE(z, -(Py_SIZE(z))); } } else z = x_sub(b, a); } else { if (Py_SIZE(b) \u0026lt; 0) z = x_sub(a, b); else z = x_add(a, b); } return (PyObject *)z; } 2.åˆ›å»º 1 2 3 4 5 6 7 8 9 10 PyObject * PyLong_FromLong(long ival) ... PyObject * PyLong_FromString(const char *str, char **pend, int base) PyObject * PyLong_FromUnicodeObject(PyObject *u, int base) æˆ‘ä»¬é€šè¿‡PyLong_FromLongæ¥äº†è§£Pythonæ˜¯æ€ä¹ˆåˆ›å»ºä¸€ä¸ªPyLongObjectå¯¹è±¡çš„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 #define IS_SMALL_INT(ival) (-_PY_NSMALLNEGINTS \u0026lt;= (ival) \u0026amp;\u0026amp; (ival) \u0026lt; _PY_NSMALLPOSINTS) typedef int32_t sdigit; static PyObject * get_small_int(sdigit ival) { assert(IS_SMALL_INT(ival)); // å°†å€¼è½¬ä¸ºç´¢å¼•ï¼Œä¾‹å¦‚ival=-5ï¼Œ_PY_NSMALLNEGINTS + -5 == 5 + -5 == 0ï¼Œå³è·å–small_ints // æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯-5ã€‚ PyObject *v = (PyObject *)\u0026amp;_PyLong_SMALL_INTS[_PY_NSMALLNEGINTS + ival]; Py_INCREF(v); return v; } PyObject * PyLong_FromLong(long ival) { PyLongObject *v; unsigned long abs_ival, t; int ndigits; /* Handle small and medium cases. */ // å°æ•´æ•°åˆ¤æ–­ if (IS_SMALL_INT(ival)) { return get_small_int((sdigit)ival); } if (-(long)PyLong_MASK \u0026lt;= ival \u0026amp;\u0026amp; ival \u0026lt;= (long)PyLong_MASK) { return _PyLong_FromMedium((sdigit)ival); } /* Count digits (at least two - smaller cases were handled above). */ abs_ival = ival \u0026lt; 0 ? 0U-(unsigned long)ival : (unsigned long)ival; /* Do shift in two steps to avoid possible undefined behavior. */ t = abs_ival \u0026gt;\u0026gt; PyLong_SHIFT \u0026gt;\u0026gt; PyLong_SHIFT; ndigits = 2; while (t) { ++ndigits; t \u0026gt;\u0026gt;= PyLong_SHIFT; } /* Construct output value. */ v = _PyLong_New(ndigits); if (v != NULL) { digit *p = v-\u0026gt;ob_digit; Py_SET_SIZE(v, ival \u0026lt; 0 ? -ndigits : ndigits); t = abs_ival; while (t) { *p++ = (digit)(t \u0026amp; PyLong_MASK); t \u0026gt;\u0026gt;= PyLong_SHIFT; } } return (PyObject *)v; } 3.é”€æ¯ å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œå½“ä¸€ä¸ªå¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶ï¼Œä¼šå°†å¼•ç”¨è®¡æ•°å™¨å‡1ï¼Œå¦‚æœå¼•ç”¨è®¡æ•°å™¨ç­‰äº0ï¼Œé‚£ä¹ˆå°±ä¼šé”€æ¯ï¼ˆå¦‚æœå¯¹è±¡æœ‰ç¼“å­˜æœºåˆ¶ï¼Œå°±ä¼šç¼“å­˜ï¼‰å¯¹è±¡ã€‚\né’ˆå¯¹PyLongObjectå¯¹è±¡ï¼Œå½“æœ€åä¸€æ¬¡å¼•ç”¨PyLongObjectçš„å¯¹è±¡é”€æ¯æ—¶ï¼Œä¼šè§¦å‘PyLongObjectçš„é”€æ¯ã€‚\n1 2 3 4 5 6 7 8 9 static inline void Py_DECREF(PyObject *op) { // Non-limited C API and limited C API for Python 3.9 and older access // directly PyObject.ob_refcnt. if (--op-\u0026gt;ob_refcnt == 0) { _Py_Dealloc(op); } } #define Py_DECREF(op) Py_DECREF(_PyObject_CAST(op)) åœ¨_Py_Deallocå‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨å¯¹è±¡çš„tp_deallocå‡½æ•°ç”¨äºé”€æ¯å¯¹åº”å¯¹è±¡çš„å†…å­˜(*dealloc)(op)ã€‚\n4.ç¼“å­˜æœºåˆ¶ Pythonä¸ºé¿å…é¢‘ç¹åœ¨å †ä¸Šç”³è¯·å’Œé‡Šæ”¾å°æ•´æ•°å¯¹è±¡çš„å†…å­˜ï¼Œä½¿ç”¨äº†å¯¹è±¡æ± ï¼Œç”¨äºç¼“å­˜å°æ•´æ•°å¯¹è±¡ã€‚\né»˜è®¤å°æ•´æ•°æ± çš„å¤§å°ä¸º5+257ä¸ªï¼ŒåŒºé—´ä¸º[-5, 257)ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å®å®šä¹‰æ¥ä¿®æ”¹å°æ•´æ•°æ± çš„æ•°é‡ã€‚\n1 2 3 4 5 #define _PY_NSMALLPOSINTS 257 #define _PY_NSMALLNEGINTS 5 // -5 ~ 256 = [-5, 257) PyLongObject small_ints[_PY_NSMALLNEGINTS + _PY_NSMALLPOSINTS]; å½“Pythonè§£é‡Šå™¨å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åˆå§‹åŒ–å°æ•´æ•°æ± ã€‚\n1 2 3 4 5 6 7 8 9 10 11 /* The following is auto-generated by Tools/scripts/generate_global_objects.py. */ #define _Py_global_objects_INIT { \\ .singletons = { \\ .small_ints = { \\ _PyLong_DIGIT_INIT(-5), \\ _PyLong_DIGIT_INIT(-4), \\ ... }, \\ ... }, \\ } ä»¥å‰çš„Pythonç‰ˆæœ¬è¿˜æœ‰free_listç”¨äºç¼“å­˜å¤§æ•´æ•°å¯¹è±¡ï¼Œä½†æ˜¯ç°åœ¨æ•´æ•°å¯¹è±¡çš„å®ç°æœºåˆ¶æ”¹äº†ï¼Œå»é™¤äº†å¤§æ•´æ•°å¯¹è±¡çš„ç¼“å†²æœºåˆ¶ã€‚\n","permalink":"https://zzhaolei.github.io/posts/python%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0python%E4%B8%AD%E7%9A%84%E6%95%B4%E6%95%B0%E5%AF%B9%E8%B1%A1/","summary":"\u003ch2 id=\"1æ•´æ•°å¯¹è±¡\"\u003e1.æ•´æ•°å¯¹è±¡\u003c/h2\u003e\n\u003cp\u003eåœ¨\u003ccode\u003ePython3.11.2\u003c/code\u003eä¸­ï¼Œæ•´æ•°ç»“æ„ä½“å«åš\u003ccode\u003ePyLongObject\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#if PYLONG_BITS_IN_DIGIT == 30\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"kt\"\u003euint32_t\u003c/span\u003e \u003cspan class=\"n\"\u003edigit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#elif PYLONG_BITS_IN_DIGIT == 15\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"kt\"\u003eunsigned\u003c/span\u003e \u003cspan class=\"kt\"\u003eshort\u003c/span\u003e \u003cspan class=\"n\"\u003edigit\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e...\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#error \u0026#34;PYLONG_BITS_IN_DIGIT should be 15 or 30\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_longobject\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"cm\"\u003e/* PyObject ob_base;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    Py_ssize_t ob_size; */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyObject_VAR_HEAD\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003edigit\u003c/span\u003e \u003cspan class=\"n\"\u003eob_digit\u003c/span\u003e\u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e];\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ePyLongObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eé€šè¿‡\u003ccode\u003ePyObject_VAR_HEAD\u003c/code\u003eæˆ‘ä»¬å¯ä»¥ç¡®å®šï¼Œåœ¨æ–°ç‰ˆ\u003ccode\u003ePython\u003c/code\u003eä¸­ï¼Œæ•´å½¢æ˜¯ä¸€ä¸ªä¸å®šé•¿å¯¹è±¡ã€‚\u003c/p\u003e\n\u003cp\u003eé€šè¿‡å‰é¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äº\u003ccode\u003ePython\u003c/code\u003eä¸­çš„å¯¹è±¡ï¼Œä¸å¯¹è±¡ç›¸å…³çš„å…ƒä¿¡æ¯å®é™…ä¸Šéƒ½ä¿å­˜åœ¨ä¸å¯¹è±¡å¯¹åº”çš„ç±»å‹å¯¹è±¡ä¸­ï¼Œå¯¹äº\u003ccode\u003ePyLongObject\u003c/code\u003eï¼Œè¿™ä¸ªç±»å‹å¯¹è±¡æ˜¯\u003ccode\u003ePyLong_Type\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ePyTypeObject\u003c/span\u003e \u003cspan class=\"n\"\u003ePyLong_Type\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nf\"\u003ePyVarObject_HEAD_INIT\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003ePyType_Type\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s\"\u003e\u0026#34;int\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                      \u003cspan class=\"cm\"\u003e/* tp_name */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nf\"\u003eoffsetof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ePyLongObject\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eob_digit\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e           \u003cspan class=\"cm\"\u003e/* tp_basicsize */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003esizeof\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edigit\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e                              \u003cspan class=\"cm\"\u003e/* tp_itemsize */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_dealloc */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_vectorcall_offset */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_getattr */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_setattr */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_as_async */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003elong_to_decimal_string\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                     \u003cspan class=\"cm\"\u003e/* tp_repr */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e\u0026amp;\u003c/span\u003e\u003cspan class=\"n\"\u003elong_as_number\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                            \u003cspan class=\"cm\"\u003e/* tp_as_number */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_as_sequence */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_as_mapping */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehashfunc\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"n\"\u003elong_hash\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                        \u003cspan class=\"cm\"\u003e/* tp_hash */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_call */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_str */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyObject_GenericGetAttr\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                    \u003cspan class=\"cm\"\u003e/* tp_getattro */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_setattro */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_as_buffer */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePy_TPFLAGS_DEFAULT\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e \u003cspan class=\"n\"\u003ePy_TPFLAGS_BASETYPE\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ePy_TPFLAGS_LONG_SUBCLASS\u003c/span\u003e \u003cspan class=\"o\"\u003e|\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003e_Py_TPFLAGS_MATCH_SELF\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e               \u003cspan class=\"cm\"\u003e/* tp_flags */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003elong_doc\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                   \u003cspan class=\"cm\"\u003e/* tp_doc */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_traverse */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_clear */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003elong_richcompare\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                           \u003cspan class=\"cm\"\u003e/* tp_richcompare */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_weaklistoffset */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_iter */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_iternext */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003elong_methods\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                               \u003cspan class=\"cm\"\u003e/* tp_methods */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_members */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003elong_getset\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                \u003cspan class=\"cm\"\u003e/* tp_getset */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_base */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_dict */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_descr_get */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_descr_set */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_dictoffset */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_init */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"cm\"\u003e/* tp_alloc */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003elong_new\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                                   \u003cspan class=\"cm\"\u003e/* tp_new */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyObject_Free\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e                              \u003cspan class=\"cm\"\u003e/* tp_free */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003ePyLongObject\u003c/code\u003eå¯¹è±¡çš„å„ç§æ“ä½œï¼ˆæ¯”è¾ƒã€è¿ç®—ç­‰ï¼‰å®é™…ä¸Šå°±æ˜¯è°ƒç”¨\u003ccode\u003ePyLong_Type\u003c/code\u003eä¸­çš„\u003ccode\u003etp_as_number\u003c/code\u003eè¿™ä¸ªç»“æ„ä½“ä¸­å®šä¹‰çš„å„ç§å‡½æ•°æŒ‡é’ˆã€‚\u003c/p\u003e","title":"Pythonæºç ç¬”è®°â€”â€”Pythonä¸­çš„æ•´æ•°å¯¹è±¡"},{"content":" æ‰€æœ‰æºç å‡åŸºäºPython 3.11.2\n1.PyObjectå®šä¹‰ 1 2 3 4 5 6 7 8 // å®é™…ä¸Šæ²¡æœ‰ä»»ä½•ä¸œè¥¿è¢«å£°æ˜ä¸ºPyObjectï¼Œä½†æ˜¯æ¯ä¸ªæŒ‡å‘Pythonå¯¹è±¡çš„æŒ‡é’ˆéƒ½å¯ä»¥è½¬æ¢ä¸ºPyObject*ã€‚ // è¿™æ˜¯æ‰‹åŠ¨æ¨¡æ‹Ÿçš„ç»§æ‰¿ã€‚åŒæ ·çš„ï¼Œæ¯ä¸ªæŒ‡å‘å¯å˜å¤§å°çš„Pythonå¯¹è±¡çš„æŒ‡é’ˆä¹Ÿå¯ä»¥è½¬æ¢ä¸ºPyObject*ï¼Œæ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è½¬æ¢ä¸ºPyVarObject*ã€‚ typedef struct _object { _PyObject_HEAD_EXTRA // å®šä¹‰æŒ‡é’ˆä»¥æ”¯æŒæ‰€æœ‰æ´»åŠ¨å †å¯¹è±¡çš„åŒå‘é“¾è¡¨refchain Py_ssize_t ob_refcnt; PyTypeObject *ob_type; } PyObject; Pythoné€šè¿‡ob_refcntå­—æ®µå®ç°åŸºäºå¼•ç”¨è®¡æ•°çš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚å¯¹äºæŸä¸€ä¸ªå¯¹è±¡Aï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„PyObject*å¼•ç”¨Aå¯¹è±¡æ—¶ï¼ŒAçš„å¼•ç”¨è®¡æ•°ä¼šå¢åŠ 1ï¼Œå½“è¿™ä¸ªPyObject*å¼•ç”¨è¢«åˆ é™¤æ—¶ï¼ŒAçš„å¼•ç”¨è®¡æ•°åº”å½“å‡1ï¼Œå½“æ­¤å­—æ®µä¸º0æ—¶ï¼Œè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆä¸ä¸€å®šä¼šé‡Šæ”¾å†…å­˜ç©ºé—´ï¼ŒPythonä¸­è¿˜æœ‰ç¼“å­˜æœºåˆ¶ï¼‰ã€‚\n_PyObject_HEAD_EXTRAæ˜¯ä¸€ä¸ªå®ï¼Œå½“ç¼–è¯‘Pythonæ—¶æŒ‡å®šå‚æ•°--with-trace-refsï¼Œé‚£ä¹ˆPy_TRACE_REFS ä¼šè¢«å®šä¹‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 #ifdef Py_TRACE_REFS /* Define pointers to support a doubly-linked list of all live heap objects. */ #define _PyObject_HEAD_EXTRA \\ PyObject *_ob_next; \\ PyObject *_ob_prev; #define _PyObject_EXTRA_INIT _Py_NULL, _Py_NULL, #else # define _PyObject_HEAD_EXTRA # define _PyObject_EXTRA_INIT #endif ob_typeæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå¯¹åº”ç€Pythonå†…éƒ¨çš„ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œç”¨æ¥æŒ‡å®šä¸€ä¸ªå¯¹è±¡ç±»å‹çš„ç±»å‹å¯¹è±¡ã€‚\n2.å®šé•¿å¯¹è±¡å’Œå˜é•¿å¯¹è±¡ åœ¨Pythonä¸­é™¤äº†PyObjectç»“æ„ä½“ä¹‹å¤–ï¼Œè¿˜æœ‰PyVarObjectç»“æ„ä½“ã€‚\n1 2 3 4 5 6 #define PyObject_VAR_HEAD PyVarObject ob_base; typedef struct { PyObject ob_base; Py_ssize_t ob_size; /* Number of items in variable part */ } PyVarObject; æˆ‘ä»¬æŠŠä¸åŒ…å«å¯å˜é•¿åº¦æ•°æ®çš„å¯¹è±¡ç§°ä¸ºå®šé•¿å¯¹è±¡ï¼Œè€Œå­—ç¬¦ä¸²å¯¹è±¡ã€æ•´æ•°å¯¹è±¡è¿™æ ·åŒ…å«å¯å˜é•¿åº¦æ•°æ®çš„å¯¹è±¡ç§°ä¸ºå˜é•¿å¯¹è±¡ã€‚å®ƒä»¬çš„åŒºåˆ«åœ¨äºå®šé•¿å¯¹è±¡çš„ä¸åŒå¯¹è±¡å ç”¨çš„å†…å­˜å¤§å°æ˜¯ä¸€æ ·çš„ï¼Œè€Œå˜é•¿å¯¹è±¡çš„ä¸åŒå¯¹è±¡å ç”¨çš„å†…å­˜å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚\nå˜é•¿å¯¹è±¡é€šå¸¸æ˜¯å®¹å™¨ç±»å‹ï¼Œob_sizeè¿™ä¸ªå­—æ®µå®é™…ä¸Šå°±æ˜¯æŒ‡æ˜äº†å˜é•¿å¯¹è±¡ä¸­ä¸€å…±å®¹çº³äº†å¤šå°‘ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯å­—èŠ‚çš„æ•°é‡ã€‚\nä¸ºä»€ä¹ˆæ•´æ•°å¯¹è±¡æ˜¯å¯å˜é•¿åº¦å¯¹è±¡å‘¢ï¼Ÿå› ä¸ºåœ¨Pythonä¸­ï¼Œæ•´æ•°å¯¹è±¡æ˜¯æ²¡æœ‰ä½æ•°é™åˆ¶çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§æ•´æ•°å¯¹è±¡çš„å®ç°ï¼Œåœ¨æ•´æ•°å¯¹è±¡çš„ç»“æ„ä½“PyLongObjectå®šä¹‰ä¸­ï¼Œä½¿ç”¨åˆ°äº†PyVarObjectï¼Œç”¨äºæŒ‡å®šsizeã€‚ 3.ä¸ºä»€ä¹ˆPyObjectè¦å®šä¹‰åœ¨æ¯ä¸€ä¸ªPythonå¯¹è±¡çš„æœ€å¼€å§‹å­—èŠ‚ä¸­ ä»PyVarObjectçš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼ŒPyVarObjectåªæ˜¯PyObjectçš„ä¸€ä¸ªæ‰©å±•è€Œå·²ã€‚å› æ­¤ï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªPyVarObjectï¼Œå…¶æ‰€å ç”¨çš„å†…å­˜ï¼Œå¼€å§‹éƒ¨åˆ†çš„å­—èŠ‚çš„æ„ä¹‰å’ŒPyObjectæ˜¯ä¸€æ ·çš„ã€‚æ¢å¥è¯è¯´ï¼Œåœ¨Pythonå†…éƒ¨ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½æ‹¥æœ‰ç›¸åŒçš„å¯¹è±¡å¤´éƒ¨ã€‚è¿™å°±ä½¿å¾—åœ¨Pythonä¸­ï¼Œå¯¹å¯¹è±¡çš„å¼•ç”¨å˜å¾—éå¸¸ç»Ÿä¸€ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ä¸€ä¸ªPyObject*æŒ‡é’ˆå°±å¯ä»¥å¼•ç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸è®ºè¯¥å¯¹è±¡å®é™…æ˜¯ä¸€ä¸ªä»€ä¹ˆå¯¹è±¡ã€‚\nè¿™æ˜¯ä¸€ä¸ªç®€å•çš„è½¬æ¢ç¤ºä¾‹ç¨‹åºï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 #include \u0026lt;stdio.h\u0026gt; struct PyObject { int _ob; int _type; }; struct PyVarObject { struct PyObject ob_base; int ob_size; }; // Listç»“æ„ä½“ struct PyListObject { struct PyVarObject ob_var; int ob_item; }; // Pythonä¸­çš„åŒå‘é“¾è¡¨ struct refchain { struct PyObject *prev; struct PyObject *next; }; int main() { struct PyListObject list = { .ob_var.ob_size = 2, .ob_var.ob_base._ob = 0, .ob_var.ob_base._type = 1, .ob_item = 3, }; struct PyListObject *p_list = \u0026amp;list; // Objectå’ŒListå¯ä»¥é€šè¿‡æŒ‡é’ˆè¿›è¡Œå¼ºè½¬ struct PyObject *p_ob = (struct PyObject *)(p_list); printf(\u0026#34;Object: %d\\n\u0026#34;, p_ob-\u0026gt;_ob); // Object: 0 struct PyListObject *p_list1 = (struct PyListObject *)(p_ob); printf(\u0026#34;List: %d\\n\u0026#34;, p_list1-\u0026gt;ob_item); // List: 3 return 0; } 4.ç±»å‹å¯¹è±¡ å½“åœ¨å†…å­˜ä¸­åˆ†é…ç©ºé—´ï¼Œåˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ç”³è¯·å¤šå¤§çš„ç©ºé—´ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå®šå€¼ï¼Œå› ä¸ºä¸åŒçš„å¯¹è±¡ï¼Œéœ€è¦ä¸åŒçš„ç©ºé—´ï¼Œä¸€ä¸ªæ•´æ•°å¯¹è±¡å’Œä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ‰€éœ€çš„ç©ºé—´è‚¯å®šä¸åŒã€‚\nåœ¨PyObjectä¸­ï¼ŒPyTypeObject *ob_typeå­—æ®µå°±è¡¨ç¤ºç±»å‹å¯¹è±¡ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 typedef struct _typeobject { PyObject_VAR_HEAD const char *tp_name; /* ç”¨äºæ‰“å°ï¼Œæ ¼å¼ä¸º\u0026#34;\u0026lt;moudle\u0026gt;.\u0026lt;name\u0026gt;\u0026#34; */ Py_ssize_t tp_basicsize, tp_itemsize; /* For allocation */ /* Methods to implement standard operations */ destructor tp_dealloc; ... /* Method suites for standard classes */ PyNumberMethods *tp_as_number; PySequenceMethods *tp_as_sequence; PyMappingMethods *tp_as_mapping; ... hashfunc tp_hash; ternaryfunc tp_call; } PyTypeObject; ä¸€ä¸ªPyTypeObjectå¯¹è±¡å°±æ˜¯Pythonä¸­é¢å‘å¯¹è±¡ç†è®ºä¸­çš„â€ç±»â€œçš„å®ç°ã€‚\nåœ¨PyTypeObjectçš„å®šä¹‰ä¸­ï¼Œæœ‰ä¸‰ç»„éå¸¸é‡è¦çš„æ“ä½œæ—ï¼Œtp_as_numberã€tp_as_sequenceã€tp_as_mappingã€‚å®ƒä»¬åˆ†åˆ«æŒ‡å‘PyNumberMethodsã€PySequenceMethodsã€PyMappingMethodså‡½æ•°æ—ã€‚\n1 2 3 4 5 6 7 typedef PyObject * (*binaryfunc)(PyObject *, PyObject *); typedef struct { binaryfunc nb_add; binaryfunc nb_subtract; ... } PyNumberMethods; åœ¨PyNumberMethodsä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªæ•°å€¼å¯¹è±¡åº”è¯¥æ”¯æŒçš„æ“ä½œã€‚\nå¯¹äºä¸€ç§ç±»å‹æ¥è¯´ï¼Œå®ƒå®Œå…¨å¯ä»¥åŒæ—¶å®šä¹‰ä¸‰ä¸ªå‡½æ•°ä¸­çš„æ‰€æœ‰æ“ä½œã€‚å³ä¸€ä¸ªå¯¹è±¡æ—¢å¯ä»¥è¡¨ç°å‡ºæ•°å€¼å¯¹è±¡çš„ç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥è¡¨ç°å‡ºmapå¯¹è±¡çš„ç‰¹æ€§ã€‚\n1 2 3 4 5 6 7 8 9 10 \u0026gt;\u0026gt;\u0026gt; class Int(int): ... def __getitem__(self, key: str) -\u0026gt; str: ... return key + str(self) ... \u0026gt;\u0026gt;\u0026gt; a = Int(1) \u0026gt;\u0026gt;\u0026gt; b = Int(2) \u0026gt;\u0026gt;\u0026gt; print(a + b) 3 \u0026gt;\u0026gt;\u0026gt; a[\u0026#34;key\u0026#34;] \u0026#39;key1\u0026#39; aæ˜¯ä¸€ä¸ªæ•°å€¼ç±»å‹çš„å¯¹è±¡å®ä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡é‡å†™__getitem__æ–¹æ³•ï¼Œå¯ä»¥è§†ä¸ºæŒ‡å®šäº†Intåœ¨Pythonå†…éƒ¨å¯¹åº”çš„PyTypeObjectå¯¹è±¡çš„tp_as_mapping.mp_subcriptæ“ä½œï¼Œæœ€ç»ˆIntçš„å®ä¾‹å¯¹è±¡å¯ä»¥è¡¨ç°å¾—åƒmapå¯¹è±¡ä¸€æ ·ã€‚åŸå› å°±æ˜¯PyTypeObjectå…è®¸ä¸€ç§ç±»å‹åŒæ—¶æŒ‡å®šä¸‰ç§ä¸åŒå¯¹è±¡çš„è¡Œä¸ºç‰¹æ€§ã€‚\n5.å¼•ç”¨è®¡æ•° ç±»å‹å¯¹è±¡æ˜¯ä¸ä¼šè¢«ææ„çš„ï¼Œå› ä¸ºæ²¡æœ‰äººå›å»å¢åŠ å’Œå‡å°‘ç±»å‹å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼ŒPythonç¨‹åºå¯åŠ¨åï¼Œç±»å‹å¯¹è±¡å°±å·²ç»å®šä¹‰å¥½äº†ã€‚\nåœ¨æ¯ä¸ªå¯¹è±¡åˆ›å»ºçš„æ—¶å€™ï¼ŒPythonä¼šä½¿ç”¨_Py_NewReference(op)å®æ¥å°†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°åˆå§‹åŒ–ä¸º1ã€‚\nå½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ç­‰äº0æ—¶ï¼ŒPythonä¸ä¸€å®šä¼šå°†å†…å­˜ç©ºé—´é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šé‡‡ç”¨å†…å­˜ç¼“å†²æ± çš„æœºåˆ¶ï¼Œå°†ä¸ä½¿ç”¨çš„å¯¹è±¡ç¼“å­˜èµ·æ¥ï¼Œå¢åŠ Pythonçš„æ‰§è¡Œæ•ˆç‡ã€‚æˆ‘ä»¬åç»­ä»‹ç»Pythonçš„ç¼“å†²æœºåˆ¶ã€‚\n","permalink":"https://zzhaolei.github.io/posts/python%E6%BA%90%E7%A0%81%E7%AC%94%E8%AE%B0python%E5%AF%B9%E8%B1%A1%E6%9C%BA%E5%88%B6%E7%9A%84%E5%9F%BA%E7%9F%B3pyobject/","summary":"\u003cblockquote\u003e\n\u003cp\u003eæ‰€æœ‰æºç å‡åŸºäº\u003ccode\u003ePython 3.11.2\u003c/code\u003e\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"1pyobjectå®šä¹‰\"\u003e1.PyObjectå®šä¹‰\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// å®é™…ä¸Šæ²¡æœ‰ä»»ä½•ä¸œè¥¿è¢«å£°æ˜ä¸ºPyObjectï¼Œä½†æ˜¯æ¯ä¸ªæŒ‡å‘Pythonå¯¹è±¡çš„æŒ‡é’ˆéƒ½å¯ä»¥è½¬æ¢ä¸ºPyObject*ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// è¿™æ˜¯æ‰‹åŠ¨æ¨¡æ‹Ÿçš„ç»§æ‰¿ã€‚åŒæ ·çš„ï¼Œæ¯ä¸ªæŒ‡å‘å¯å˜å¤§å°çš„Pythonå¯¹è±¡çš„æŒ‡é’ˆä¹Ÿå¯ä»¥è½¬æ¢ä¸ºPyObject*ï¼Œæ­¤å¤–ï¼Œä¹Ÿå¯ä»¥è½¬æ¢ä¸ºPyVarObject*ã€‚\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003etypedef\u003c/span\u003e \u003cspan class=\"k\"\u003estruct\u003c/span\u003e \u003cspan class=\"n\"\u003e_object\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003e_PyObject_HEAD_EXTRA\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// å®šä¹‰æŒ‡é’ˆä»¥æ”¯æŒæ‰€æœ‰æ´»åŠ¨å †å¯¹è±¡çš„åŒå‘é“¾è¡¨refchain\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\t\t\u003cspan class=\"n\"\u003ePy_ssize_t\u003c/span\u003e \u003cspan class=\"n\"\u003eob_refcnt\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ePyTypeObject\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e\u003cspan class=\"n\"\u003eob_type\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"n\"\u003ePyObject\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003ePython\u003c/code\u003eé€šè¿‡\u003ccode\u003eob_refcnt\u003c/code\u003eå­—æ®µå®ç°åŸºäºå¼•ç”¨è®¡æ•°çš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚å¯¹äºæŸä¸€ä¸ª\u003ccode\u003eå¯¹è±¡A\u003c/code\u003eï¼Œå½“æœ‰ä¸€ä¸ªæ–°çš„\u003ccode\u003ePyObject*\u003c/code\u003eå¼•ç”¨\u003ccode\u003eAå¯¹è±¡\u003c/code\u003eæ—¶ï¼Œ\u003ccode\u003eA\u003c/code\u003eçš„å¼•ç”¨è®¡æ•°ä¼šå¢åŠ \u003ccode\u003e1\u003c/code\u003eï¼Œå½“è¿™ä¸ª\u003ccode\u003ePyObject*\u003c/code\u003eå¼•ç”¨è¢«åˆ é™¤æ—¶ï¼Œ\u003ccode\u003eA\u003c/code\u003eçš„å¼•ç”¨è®¡æ•°åº”å½“å‡\u003ccode\u003e1\u003c/code\u003eï¼Œå½“æ­¤å­—æ®µä¸º\u003ccode\u003e0\u003c/code\u003eæ—¶ï¼Œè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆä¸ä¸€å®šä¼šé‡Šæ”¾å†…å­˜ç©ºé—´ï¼Œ\u003ccode\u003ePython\u003c/code\u003eä¸­è¿˜æœ‰ç¼“å­˜æœºåˆ¶ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003e_PyObject_HEAD_EXTRA\u003c/code\u003eæ˜¯ä¸€ä¸ªå®ï¼Œå½“ç¼–è¯‘\u003ccode\u003ePython\u003c/code\u003eæ—¶æŒ‡å®šå‚æ•°\u003ccode\u003e--with-trace-refs\u003c/code\u003eï¼Œé‚£ä¹ˆ\u003ccode\u003ePy_TRACE_REFS\u003c/code\u003e ä¼šè¢«å®šä¹‰ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-c\" data-lang=\"c\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#ifdef Py_TRACE_REFS\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\u003cspan class=\"cm\"\u003e/* Define pointers to support a doubly-linked list of all live heap objects. */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define _PyObject_HEAD_EXTRA            \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e    PyObject *_ob_next;           \\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e    PyObject *_ob_prev;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#define _PyObject_EXTRA_INIT _Py_NULL, _Py_NULL,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#else\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#  define _PyObject_HEAD_EXTRA\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#  define _PyObject_EXTRA_INIT\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#endif\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003eob_type\u003c/code\u003eæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå¯¹åº”ç€\u003ccode\u003ePython\u003c/code\u003eå†…éƒ¨çš„ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼Œç”¨æ¥æŒ‡å®šä¸€ä¸ªå¯¹è±¡ç±»å‹çš„ç±»å‹å¯¹è±¡ã€‚\u003c/p\u003e","title":"Pythonæºç ç¬”è®°â€”â€”Pythonå¯¹è±¡æœºåˆ¶çš„åŸºçŸ³ã€PyObjectã€‘"},{"content":"åœ¨ä½¿ç”¨moshè¿æ¥åˆ°æœåŠ¡å™¨Ubuntu 20.04æ—¶ï¼Œå‘ç°ç»ˆç«¯(ç»ˆç«¯æ˜¯Kittyï¼Œæ”¯æŒ256color)çš„é¢œè‰²ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚\nä½¿ç”¨å‘½ä»¤æŸ¥çœ‹äº†ä¸€ä¸‹$TERMçš„è®¾ç½®\n1 2 $ echo $TERM xterm-256color æ˜¾ç¤ºçš„æ˜¯xterm-256colorï¼Œè¯´æ˜é…ç½®çš„æ˜¯æ²¡é—®é¢˜çš„ã€‚\næŸ¥çœ‹moshçš„ç‰ˆæœ¬ï¼š\n1 2 $ mosh --version 1.3.2 å¯ä»¥çœ‹åˆ°moshçš„ç‰ˆæœ¬æ˜¯1.3.2ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„å‘å¸ƒæ—¥æœŸæ˜¯2017-07-22ï¼Œä½†æ˜¯githubä¸Šmasteråˆ†æ”¯ä¸€ç›´åœ¨å¼€å‘ä¸­ã€‚\næƒ³ç€æ—¶é—´å·²ç»è¿‡å»è¿™ä¹ˆä¹…äº†ï¼Œå®˜æ–¹åº”è¯¥å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæ¯•ç«Ÿç°åœ¨çš„å¾ˆå¤šç»ˆç«¯éƒ½æ˜¯æ”¯æŒ256colorçš„ï¼Œæ‰€ä»¥å°±åœ¨issueä¸­æœç´¢äº†ä¸€ä¸‹ï¼ŒçœŸçš„æ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚\nå®šä½é—®é¢˜ åœ¨2017å¹´11æœˆ23å·å°±æœ‰äººæè¿‡å…³äºmoshçš„256coloræ˜¾ç¤ºæ”¯æŒé—®é¢˜ï¼Œè€Œå®˜æ–¹ä¹Ÿå·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆéƒ½å·²ç»è¿‡å»è¿™ä¹ˆä¹…äº†è¿˜æ²¡æœ‰å‘å¸ƒæ–°çš„ç‰ˆæœ¬ã€‚\nå…·ä½“çš„issueã€‚ä¸è¿‡è¯„è®ºä¸­è¯´çš„PPAä¹Ÿå·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°çš„æ–¹æ¡ˆè§£å†³Linuxç³»ç»Ÿçš„é—®é¢˜ã€‚\nè§£å†³æ–¹æ¡ˆ æƒ³è¦è®©moshèƒ½æ­£ç¡®çš„æ˜¾ç¤º256colorï¼Œå°±åªèƒ½æ‰‹åŠ¨ç¼–è¯‘moshçš„masteråˆ†æ”¯ã€‚\nå¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„å®‰è£…æ•™ç¨‹ï¼ŒåŒ…å«æ‰‹åŠ¨ç¼–è¯‘çš„æ•™ç¨‹ã€‚\nè®°å¾—å…ˆå°†ä¹‹å‰çš„å®‰è£…å¸è½½æ‰ã€‚\nMac åœ¨MacOSå¹³å°ä¸Šï¼Œå¯ä»¥ä½¿ç”¨brewæ¥è¿›è¡Œè‡ªåŠ¨çš„ç¼–è¯‘å’Œå®‰è£…ã€‚\n1 2 $ brew uninstall mosh $ brew install --HEAD mosh Macåœ¨ç¼–è¯‘å®‰è£…çš„æ—¶å€™ï¼Œä¼šæç¤ºæ›´æ–°æˆ–è€…å®‰è£…xcodeå‘½ä»¤è¡Œå·¥å…·ï¼Œå°±æŒ‰ç…§brewæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æç¤ºæ“ä½œå³å¯ã€‚\nLinux åœ¨Ubuntu 20.04ä¸Šå®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨å…‹éš†moshçš„ä»“åº“ åœ¨å®‰è£…ä¹‹å‰ä¸­ï¼Œéœ€è¦å®‰è£…ä¾èµ–ï¼ŒUbuntuæœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼Œæ¯”è¾ƒå°‘ã€‚å¦‚æœä½ æ˜¯æ¯”è¾ƒæ—§çš„ç‰ˆæœ¬ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„ç¼–è¯‘æ•™ç¨‹ï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„ä¾èµ–ã€‚\n1 $ sudo apt install libncurses5-dev protobuf-compiler 1 2 3 4 5 6 $ git clone https://github.com/mobile-shell/mosh.git $ cd mosh $ ./autogen.sh $ ./configure $ make $ sudo make install æœ€åæ‰§è¡Œmake installçš„æ—¶å€™ï¼Œæœ€å¥½æ·»åŠ sudoï¼Œå› ä¸ºæ¶‰åŠåˆ°å°†ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»Ÿå¯æŸ¥æ‰¾åˆ°çš„binç›®å½•ä¸‹ã€‚\nç»“å°¾ ç°åœ¨å†ä½¿ç”¨mosh username@server_hostè¿æ¥æœåŠ¡å™¨ï¼Œå°±å¯ä»¥æ˜¾ç¤º256coloräº†ã€‚\n","permalink":"https://zzhaolei.github.io/posts/mosh%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%97%B6%E7%BB%88%E7%AB%AF%E9%A2%9C%E8%89%B2%E6%98%BE%E7%A4%BA%E9%97%AE%E9%A2%98/","summary":"\u003cp\u003eåœ¨ä½¿ç”¨\u003ccode\u003emosh\u003c/code\u003eè¿æ¥åˆ°æœåŠ¡å™¨\u003ccode\u003eUbuntu 20.04\u003c/code\u003eæ—¶ï¼Œå‘ç°ç»ˆç«¯(\u003ccode\u003eç»ˆç«¯æ˜¯Kittyï¼Œæ”¯æŒ256color\u003c/code\u003e)çš„é¢œè‰²ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚\u003c/p\u003e\n\u003cp\u003eä½¿ç”¨å‘½ä»¤æŸ¥çœ‹äº†ä¸€ä¸‹\u003ccode\u003e$TERM\u003c/code\u003eçš„è®¾ç½®\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"nb\"\u003eecho\u003c/span\u003e \u003cspan class=\"nv\"\u003e$TERM\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003exterm-256color\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eæ˜¾ç¤ºçš„æ˜¯\u003ccode\u003exterm-256color\u003c/code\u003eï¼Œè¯´æ˜é…ç½®çš„æ˜¯æ²¡é—®é¢˜çš„ã€‚\u003c/p\u003e\n\u003cp\u003eæŸ¥çœ‹\u003ccode\u003emosh\u003c/code\u003eçš„ç‰ˆæœ¬ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ mosh --version\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e1.3.2\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eå¯ä»¥çœ‹åˆ°\u003ccode\u003emosh\u003c/code\u003eçš„ç‰ˆæœ¬æ˜¯\u003ccode\u003e1.3.2\u003c/code\u003eï¼Œè¿™ä¸ªç‰ˆæœ¬çš„\u003ccode\u003eå‘å¸ƒæ—¥æœŸæ˜¯2017-07-22\u003c/code\u003eï¼Œä½†æ˜¯\u003ccode\u003egithub\u003c/code\u003eä¸Š\u003ccode\u003emaster\u003c/code\u003eåˆ†æ”¯ä¸€ç›´åœ¨å¼€å‘ä¸­ã€‚\u003c/p\u003e\n\u003cp\u003eæƒ³ç€æ—¶é—´å·²ç»è¿‡å»è¿™ä¹ˆä¹…äº†ï¼Œå®˜æ–¹åº”è¯¥å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæ¯•ç«Ÿç°åœ¨çš„å¾ˆå¤šç»ˆç«¯éƒ½æ˜¯æ”¯æŒ\u003ccode\u003e256color\u003c/code\u003eçš„ï¼Œæ‰€ä»¥å°±åœ¨\u003ccode\u003eissue\u003c/code\u003eä¸­æœç´¢äº†ä¸€ä¸‹ï¼ŒçœŸçš„æ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚\u003c/p\u003e\n\u003ch3 id=\"å®šä½é—®é¢˜\"\u003eå®šä½é—®é¢˜\u003c/h3\u003e\n\u003cp\u003eåœ¨\u003ccode\u003e2017å¹´11æœˆ23å·\u003c/code\u003eå°±æœ‰äººæè¿‡å…³äº\u003ccode\u003emoshçš„256color\u003c/code\u003eæ˜¾ç¤ºæ”¯æŒé—®é¢˜ï¼Œè€Œå®˜æ–¹ä¹Ÿå·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆéƒ½å·²ç»è¿‡å»è¿™ä¹ˆä¹…äº†è¿˜æ²¡æœ‰å‘å¸ƒæ–°çš„ç‰ˆæœ¬ã€‚\u003c/p\u003e\n\u003cp\u003eå…·ä½“çš„\u003ca href=\"https://github.com/mobile-shell/mosh/issues/945#issuecomment-346627355\"\u003eissue\u003c/a\u003eã€‚ä¸è¿‡è¯„è®ºä¸­è¯´çš„\u003ccode\u003ePPA\u003c/code\u003eä¹Ÿå·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ–°çš„æ–¹æ¡ˆè§£å†³\u003ccode\u003eLinux\u003c/code\u003eç³»ç»Ÿçš„é—®é¢˜ã€‚\u003c/p\u003e\n\u003ch3 id=\"è§£å†³æ–¹æ¡ˆ\"\u003eè§£å†³æ–¹æ¡ˆ\u003c/h3\u003e\n\u003cp\u003eæƒ³è¦è®©\u003ccode\u003emosh\u003c/code\u003eèƒ½æ­£ç¡®çš„æ˜¾ç¤º\u003ccode\u003e256color\u003c/code\u003eï¼Œå°±åªèƒ½\u003ccode\u003eæ‰‹åŠ¨ç¼–è¯‘moshçš„masteråˆ†æ”¯\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„å®‰è£…\u003ca href=\"https://mosh.org/#getting\"\u003eæ•™ç¨‹\u003c/a\u003eï¼ŒåŒ…å«æ‰‹åŠ¨ç¼–è¯‘çš„æ•™ç¨‹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eè®°å¾—å…ˆå°†ä¹‹å‰çš„å®‰è£…å¸è½½æ‰ã€‚\u003c/code\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eMac\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eMacOS\u003c/code\u003eå¹³å°ä¸Šï¼Œå¯ä»¥ä½¿ç”¨\u003ccode\u003ebrew\u003c/code\u003eæ¥è¿›è¡Œè‡ªåŠ¨çš„ç¼–è¯‘å’Œå®‰è£…ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ brew uninstall mosh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ brew install --HEAD mosh\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003eMac\u003c/code\u003eåœ¨ç¼–è¯‘å®‰è£…çš„æ—¶å€™ï¼Œä¼šæç¤ºæ›´æ–°æˆ–è€…å®‰è£…\u003ccode\u003excodeå‘½ä»¤è¡Œå·¥å…·\u003c/code\u003eï¼Œå°±æŒ‰ç…§\u003ccode\u003ebrew\u003c/code\u003eæ‰§è¡Œè¿‡ç¨‹ä¸­çš„æç¤ºæ“ä½œå³å¯ã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eLinux\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eUbuntu 20.04\u003c/code\u003eä¸Šå®‰è£…ï¼Œéœ€è¦æ‰‹åŠ¨å…‹éš†\u003ccode\u003emosh\u003c/code\u003eçš„ä»“åº“\nåœ¨å®‰è£…ä¹‹å‰ä¸­ï¼Œéœ€è¦å®‰è£…ä¾èµ–ï¼Œ\u003ccode\u003eUbuntu\u003c/code\u003eæœ€æ–°ç‰ˆæœ¬çš„ä¾èµ–ï¼Œæ¯”è¾ƒå°‘ã€‚å¦‚æœä½ æ˜¯æ¯”è¾ƒæ—§çš„ç‰ˆæœ¬ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹çš„ç¼–è¯‘\u003ca href=\"https://mosh.org/#getting\"\u003eæ•™ç¨‹\u003c/a\u003eï¼Œé‡Œé¢æœ‰è¯¦ç»†çš„ä¾èµ–ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ sudo apt install libncurses5-dev protobuf-compiler\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ git clone https://github.com/mobile-shell/mosh.git\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ \u003cspan class=\"nb\"\u003ecd\u003c/span\u003e mosh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ ./autogen.sh\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ ./configure\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ make\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ sudo make install\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eæœ€åæ‰§è¡Œ\u003ccode\u003emake install\u003c/code\u003eçš„æ—¶å€™ï¼Œæœ€å¥½æ·»åŠ \u003ccode\u003esudo\u003c/code\u003eï¼Œå› ä¸ºæ¶‰åŠåˆ°å°†ç¼–è¯‘ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»Ÿå¯æŸ¥æ‰¾åˆ°çš„\u003ccode\u003ebin\u003c/code\u003eç›®å½•ä¸‹ã€‚\u003c/p\u003e","title":"Moshè¿æ¥æœåŠ¡å™¨æ—¶ç»ˆç«¯é¢œè‰²æ˜¾ç¤ºé—®é¢˜"},{"content":"å¯ç”¨Go Modules go modåœ¨Go \u0026gt;= 1.13æ‰é»˜è®¤å¯ç”¨ï¼Œåœ¨Go \u0026gt;= 1.11å·²ç»å¼€å§‹æ”¯æŒäº†go modã€‚\nè®¾ç½®ç¯å¢ƒå˜é‡\n1 2 3 4 5 6 7 8 9 # å¯ç”¨go module export GO111MODULE=on # è®¾ç½®GOPATHï¼Œå¼€å¯go modä¹‹åï¼Œè¿™ä¸ªç›®å½•ä¸»è¦ç”¨æ¥å­˜æ”¾ä¾èµ–åŒ… export GOPATH=~/go_modules # è®¾ç½®goä»£ç†ï¼Œåœ¨è¿è¡Œgo test/buildç­‰æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ– # ä½¿ç”¨go getä¸‹è½½ä¾èµ–éœ€è¦åœ¨GOPATHä¸­æ‰§è¡Œæ‰ä¼šä½¿ç”¨ä»£ç† export GOPROXY=https://goproxy.io go modä½¿ç”¨ åœ¨$GOPATH/srcä¹‹å¤–çš„ä»»æ„ç›®å½•åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œ\n1 2 mkdir -p /home/gopher/project cd /home/gopher/project è¿™ä¸ªç›®å½•å°±æ˜¯ä½ é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œåœ¨ç›®å½•ä¸­åˆ›å»ºmodç®¡ç†æ–‡ä»¶\n1 go mod init project å¦‚æœä½ è¿™ä¸ªé¡¹ç›®æ˜¯æ”¾åœ¨githubä¸Šçš„ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºæ–‡ä»¶çš„æ—¶å€™å¯ä»¥è¿™æ ·å†™ï¼Œprojectä¸ºä½ githubé¡¹ç›®åç§°\n1 go mod init github.com/YourName/project go.modçš„åˆå§‹å†…å®¹cat go.modä¸º:\n1 2 3 module project go 1.12 go.modåªéœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€æ¬¡å³å¯ï¼Œåœ¨é¡¹ç›®ä¸­Goä¼šè‡ªåŠ¨æŸ¥æ‰¾å½“å‰ç›®å½•çš„å…¨éƒ¨çˆ¶çº§ç›®å½•ï¼Œç›´åˆ°æ‰¾åˆ°go.modã€‚\nå…³äºåŒ…çš„å®šä¹‰å’Œè‡ªå®šä¹‰åŒ…çš„å¯¼å…¥ ä¸€ä¸ªç›®å½•ä¸‹åªèƒ½ç”±ä¸€ä¸ªå®šä¹‰çš„package\n1 2 æ¯”å¦‚åœ¨projecté¡¹ç›®ä¸­æœ‰äº†ä¸€ä¸ªhello.goçš„æ–‡ä»¶ï¼Œæ–‡ä¸­å®šä¹‰äº†package helloï¼Œ è¿™æ ·ï¼Œå½“ä½ å†åœ¨projectä¸­åˆ›å»ºäº†ä¸€ä¸ªworld.goçš„æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº†package worldä¼šæŠ¥é”™ï¼Œæ— æ³•åŠ è½½package æ¯ä¸ªpackageå®šä¹‰ï¼Œä½äºä¸€ä¸ªç›®å½•ä¸­ã€‚æ¨èç›®å½•åå’Œpackageå®šä¹‰çš„åŒ…åå­—ç›¸åŒã€‚\n1 2 3 4 5 6 7 8 9 10 11 project â”œâ”€â”€ go.mod â”œâ”€â”€ hello â”‚Â â”œâ”€â”€ hello.go â”‚Â â””â”€â”€ hello1.go â”œâ”€â”€ main.go â””â”€â”€ world â”œâ”€â”€ world.go â””â”€â”€ world1.go å…¶ä¸­helloç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„åŒ…å®šä¹‰å‡ä¸ºpackage helloï¼Œhelloç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶çš„åŒ…å®šä¹‰å‡ä¸ºpackage world go modç®¡ç† åˆ›å»ºæ–°çš„æ¨¡å—\n1 2 # åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ¨¡å—ï¼Œåˆå§‹åŒ– `go.mod` æ–‡ä»¶å¹¶ä¸”ç”Ÿæˆç›¸åº”çš„æè¿° go mod init æ·»åŠ ä¾èµ–é¡¹\n1 2 3 4 5 # buildï¼Œtestå’Œå…¶å®ƒæ„å»ºä»£ç åŒ…çš„å‘½ä»¤ï¼Œä¼šåœ¨éœ€è¦çš„æ—¶å€™åœ¨go.modæ–‡ä»¶ä¸­æ·»åŠ æ–°çš„ä¾èµ–é¡¹ # æœ€å¥½ä¸è¦è‡ªå·±ä¿®æ”¹go.modæ–‡ä»¶ï¼Œå› ä¸ºåœ¨Goåœ¨å‘go.modä¸­æ·»åŠ ä¾èµ–é¡¹çš„æ—¶å€™ # åŒæ—¶ä¼šå‘go.sumä¸­çš„hashå¯¹æ¯”ï¼Œç¡®å®šä¾èµ–æ˜¯å¦ä¿®æ”¹ã€‚ go build go test æŸ¥çœ‹å½“å‰å…¨éƒ¨ä¾èµ–é¡¹\n1 2 # åˆ—å‡ºäº†å½“å‰æ¨¡å—æ‰€æœ‰çš„ä¾èµ–é¡¹ go list -m all ä¿®æ”¹æŒ‡å®šä¾èµ–é¡¹çš„ç‰ˆæœ¬ï¼ˆæˆ–æ·»åŠ ä¸€ä¸ªæ–°çš„ä¾èµ–é¡¹ï¼‰\n1 2 3 4 # ä¿®æ”¹æˆ–æ·»åŠ  # go get -u ä¼šæ›´æ–°ä¾èµ– # è·å–æŒ‡å®šç‰ˆæœ¬çš„å½¢å¼ go get rsc.io/sampler@v1.3.1 go get ç§»é™¤æ— ç”¨çš„ä¾èµ–é¡¹\n1 go mod tidy ","permalink":"https://zzhaolei.github.io/posts/%E5%85%B3%E4%BA%8Ego-modules%E7%9A%84%E4%B8%80%E4%BA%9B%E5%86%85%E5%AE%B9/","summary":"\u003ch2 id=\"å¯ç”¨go-modules\"\u003eå¯ç”¨Go Modules\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003ego mod\u003c/code\u003eåœ¨\u003ccode\u003eGo \u0026gt;= 1.13\u003c/code\u003eæ‰é»˜è®¤å¯ç”¨ï¼Œåœ¨\u003ccode\u003eGo \u0026gt;= 1.11\u003c/code\u003eå·²ç»å¼€å§‹æ”¯æŒäº†\u003ccode\u003ego mod\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eè®¾ç½®ç¯å¢ƒå˜é‡\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e9\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# å¯ç”¨go module\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGO111MODULE\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003eon\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è®¾ç½®GOPATHï¼Œå¼€å¯go modä¹‹åï¼Œè¿™ä¸ªç›®å½•ä¸»è¦ç”¨æ¥å­˜æ”¾ä¾èµ–åŒ…\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGOPATH\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e~/go_modules\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# è®¾ç½®goä»£ç†ï¼Œåœ¨è¿è¡Œgo test/buildç­‰æ—¶ä¼šè‡ªåŠ¨ä¸‹è½½ä¾èµ–\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# ä½¿ç”¨go getä¸‹è½½ä¾èµ–éœ€è¦åœ¨GOPATHä¸­æ‰§è¡Œæ‰ä¼šä½¿ç”¨ä»£ç†\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eexport\u003c/span\u003e \u003cspan class=\"nv\"\u003eGOPROXY\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003ehttps://goproxy.io\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"go-modä½¿ç”¨\"\u003ego modä½¿ç”¨\u003c/h2\u003e\n\u003cp\u003eåœ¨\u003ccode\u003e$GOPATH/src\u003c/code\u003eä¹‹å¤–çš„ä»»æ„ç›®å½•åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œ\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emkdir -p /home/gopher/project\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003ecd\u003c/span\u003e /home/gopher/project\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eè¿™ä¸ªç›®å½•å°±æ˜¯ä½ é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œåœ¨ç›®å½•ä¸­åˆ›å»ºmodç®¡ç†æ–‡ä»¶\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ego mod init project\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eå¦‚æœä½ è¿™ä¸ªé¡¹ç›®æ˜¯æ”¾åœ¨githubä¸Šçš„ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºæ–‡ä»¶çš„æ—¶å€™å¯ä»¥è¿™æ ·å†™ï¼Œprojectä¸ºä½ githubé¡¹ç›®åç§°\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ego mod init github.com/YourName/project\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003ego.mod\u003c/code\u003eçš„åˆå§‹å†…å®¹\u003ccode\u003ecat go.mod\u003c/code\u003eä¸º:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e3\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003emodule project\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003ego 1.12\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003e\u003ccode\u003ego.mod\u003c/code\u003eåªéœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»ºä¸€æ¬¡å³å¯ï¼Œåœ¨é¡¹ç›®ä¸­\u003ccode\u003eGo\u003c/code\u003eä¼šè‡ªåŠ¨æŸ¥æ‰¾å½“å‰ç›®å½•çš„å…¨éƒ¨\u003ccode\u003eçˆ¶çº§ç›®å½•\u003c/code\u003eï¼Œç›´åˆ°æ‰¾åˆ°\u003ccode\u003ego.mod\u003c/code\u003eã€‚\u003c/p\u003e","title":"å…³äºGo Modulesçš„ä¸€äº›å†…å®¹"},{"content":"jenkinså®‰è£…Generic Webhook Trigger Pluginæ’ä»¶\n{% asset_img Generic_Webhook_Trgger.png Generic\\ Webhook\\ Trggerå…·ä½“é…ç½® %}\nåˆ›å»ºä»»åŠ¡ï¼Œåœ¨æ„å»ºè§¦å‘å™¨ä¸­å‹¾é€‰Generic Webhook Trigger, åœ¨å±•å¼€çš„é¡µé¢ä¸­ä¼šæœ‰ä¸€ä¸ªURL, è¿™ä¸ªURLæ˜¯é…ç½®Webhookä½¿ç”¨çš„ï¼Œä¸€èˆ¬å½¢å¼æ˜¯http://JENKINS_URL/generic-webhook-trigger/invoke, JENKINS_URLæ˜¯åˆå§‹é…ç½®jenkinsæ—¶ä¼šæœ‰çš„ï¼Œä¸€èˆ¬æ˜¯http://IP:8080çš„å½¢å¼ã€‚\nå¦‚æœä¹‹å‰æœ‰é…ç½®è¿‡GitLab webhook, è¯·å»é™¤è¿™ä¸ªï¼Œä¸ç„¶Generic Webhook Triggerä¸ä¼šç”Ÿæ•ˆã€‚\nå¦‚æœGitä»“åº“çš„éªŒè¯ä½¿ç”¨çš„æ˜¯ç”¨æˆ·åå’Œå¯†ç ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦é…ç½®Token.\nå¤åˆ¶è¿™ä¸ªURLï¼Œå°†JENKINS_URLæ›¿æ¢ä¸ºè‡ªå·±çš„çœŸå®æ•°æ®ï¼Œåœ¨GitLabçš„å¯¹åº”çš„é¡¹ç›®çš„è®¾ç½®--\u0026gt;é›†æˆä¸­è¾“å…¥ï¼Œæ²¡æœ‰å®‰å…¨ä»¤ç‰Œï¼Œå‹¾é€‰è‡ªå·±éœ€è¦çš„è§¦å‘å™¨äº‹ä»¶ï¼ŒSSLè¯ä¹¦éªŒè¯å¯ä»¥å¼€å¯ï¼Œä¹Ÿå¯ä»¥ä¸å¼€å¯ï¼Œæ¨èå¼€å¯ã€‚\nä»»åŠ¡è®¾ç½®ç•Œé¢è¿˜æœ‰Post content parameters, Header parameters, Request parameters, åˆ†åˆ«æ˜¯è¯·æ±‚çš„postæ•°æ®ï¼Œheaderå¤´ï¼Œè¯·æ±‚å¤´ã€‚\nä¸€èˆ¬æˆ‘ä»¬åªéœ€è¦postçš„æ•°æ®é‡Œçš„å†…å®¹å°±å¤Ÿäº†ã€‚\nå›¾ç‰‡çš„3ï¼Œ4åˆ†åˆ«æ˜¯å˜é‡åï¼ˆ3ï¼‰ï¼Œå€¼ï¼ˆ4ï¼‰ã€‚å€¼æ˜¯ç›´æ¥ä»postçš„jsonæ ¼å¼çš„æ•°æ®ä¸­å–å‡ºæ¥çš„ï¼Œæ³¨æ„ï¼Œå€¼çš„è·å–æ–¹å¼æ˜¯JSONPathï¼Œå¹¶ä¸”é‡Œé¢æœ‰ç‚¹ï¼Œå¦‚æœjsonæ•°æ®æœ‰å¤šå±‚ï¼Œé‚£ä¹ˆå°±å¤šç‚¹å‡ æ¬¡ï¼Œæ¯”å¦‚$.project.nameç­‰ï¼Œå¯ä»¥é…ç½®å¤šä¸ªå˜é‡ç»„ã€‚\næˆ‘ä»¬è¿˜å¯ä»¥Generic Webhook Triggeré…ç½®Optional filterï¼Œè®¾ç½®ä¸€ä¸ªè§¦å‘äº‹ä»¶ï¼Œæ¯”å¦‚åªæœ‰å½“ä½ æ¨é€çš„åˆ†æ”¯æ˜¯developçš„æ—¶å€™ï¼Œæ‰å»æ„å»ºã€‚\nåœ¨Optional filterçš„Expressionæ¡†ä¸­è¾“å…¥^(refs/heads/develop)$, åœ¨ä¸‹é¢çš„Textæ¡†ä¸­è¾“å…¥æ­¥éª¤3çš„å˜é‡åï¼Œè¿™é‡Œå†™$refã€‚\nåœ¨shellä¸­ä½¿ç”¨å˜é‡åçš„æ–¹å¼ä¹Ÿæ˜¯ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚echo $refï¼Œ æ³¨æ„æ²¡æœ‰ç‚¹ã€‚\né…ç½®å®Œæˆåï¼Œä¿å­˜ï¼Œå¯ä»¥ç‚¹å‡»åˆšåˆšé…ç½®çš„GitLabçš„webhooké¡µé¢çš„Testå¯¹åº”çš„äº‹ä»¶æµ‹è¯•ã€‚\nGitLabçš„pushçš„hookæ•°æ®ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 { \u0026#34;object_kind\u0026#34;: \u0026#34;push\u0026#34;, \u0026#34;before\u0026#34;: \u0026#34;95790bf891e76fee5e1747ab589903a6a1f80f22\u0026#34;, \u0026#34;after\u0026#34;: \u0026#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;, \u0026#34;ref\u0026#34;: \u0026#34;refs/heads/master\u0026#34;, \u0026#34;checkout_sha\u0026#34;: \u0026#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;, \u0026#34;user_id\u0026#34;: 4, \u0026#34;user_name\u0026#34;: \u0026#34;John Smith\u0026#34;, \u0026#34;user_username\u0026#34;: \u0026#34;jsmith\u0026#34;, \u0026#34;user_email\u0026#34;: \u0026#34;john@example.com\u0026#34;, \u0026#34;user_avatar\u0026#34;: \u0026#34;https://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=8://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=80\u0026#34;, \u0026#34;project_id\u0026#34;: 15, \u0026#34;project\u0026#34;:{ \u0026#34;id\u0026#34;: 15, \u0026#34;name\u0026#34;:\u0026#34;Diaspora\u0026#34;, \u0026#34;description\u0026#34;:\u0026#34;\u0026#34;, \u0026#34;web_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora\u0026#34;, \u0026#34;avatar_url\u0026#34;:null, \u0026#34;git_ssh_url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;, \u0026#34;git_http_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora.git\u0026#34;, \u0026#34;namespace\u0026#34;:\u0026#34;Mike\u0026#34;, \u0026#34;visibility_level\u0026#34;:0, \u0026#34;path_with_namespace\u0026#34;:\u0026#34;mike/diaspora\u0026#34;, \u0026#34;default_branch\u0026#34;:\u0026#34;master\u0026#34;, \u0026#34;homepage\u0026#34;:\u0026#34;http://example.com/mike/diaspora\u0026#34;, \u0026#34;url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;, \u0026#34;ssh_url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;, \u0026#34;http_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora.git\u0026#34; }, \u0026#34;repository\u0026#34;:{ \u0026#34;name\u0026#34;: \u0026#34;Diaspora\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;git@example.com:mike/diaspora.git\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;homepage\u0026#34;: \u0026#34;http://example.com/mike/diaspora\u0026#34;, \u0026#34;git_http_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora.git\u0026#34;, \u0026#34;git_ssh_url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;, \u0026#34;visibility_level\u0026#34;:0 }, \u0026#34;commits\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;b6568db1bc1dcd7f8b4d5a946b0b91f9dacd7327\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Update Catalan translation to e38cb41.\u0026#34;, \u0026#34;timestamp\u0026#34;: \u0026#34;2011-12-12T14:27:31+02:00\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;http://example.com/mike/diaspora/commit/b6568db1bc1dcd7f8b4d5a946b0b91f9dacd7327\u0026#34;, \u0026#34;author\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Jordi Mallach\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;jordi@softcatala.org\u0026#34; }, \u0026#34;added\u0026#34;: [\u0026#34;CHANGELOG\u0026#34;], \u0026#34;modified\u0026#34;: [\u0026#34;app/controller/application.rb\u0026#34;], \u0026#34;removed\u0026#34;: [] }, { \u0026#34;id\u0026#34;: \u0026#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;fixed readme\u0026#34;, \u0026#34;timestamp\u0026#34;: \u0026#34;2012-01-03T23:36:29+02:00\u0026#34;, \u0026#34;url\u0026#34;: \u0026#34;http://example.com/mike/diaspora/commit/da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;, \u0026#34;author\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;GitLab dev user\u0026#34;, \u0026#34;email\u0026#34;: \u0026#34;gitlabdev@dv6700.(none)\u0026#34; }, \u0026#34;added\u0026#34;: [\u0026#34;CHANGELOG\u0026#34;], \u0026#34;modified\u0026#34;: [\u0026#34;app/controller/application.rb\u0026#34;], \u0026#34;removed\u0026#34;: [] } ], \u0026#34;total_commits_count\u0026#34;: 4 } ","permalink":"https://zzhaolei.github.io/posts/jenkins%E5%A4%84%E7%90%86gitlab-hook/","summary":"\u003cp\u003e\u003ccode\u003ejenkins\u003c/code\u003eå®‰è£…\u003ccode\u003eGeneric Webhook Trigger Plugin\u003c/code\u003eæ’ä»¶\u003c/p\u003e\n\u003cp\u003e{% asset_img Generic_Webhook_Trgger.png Generic\\ Webhook\\ Trggerå…·ä½“é…ç½® %}\u003c/p\u003e\n\u003cp\u003eåˆ›å»ºä»»åŠ¡ï¼Œåœ¨\u003ccode\u003eæ„å»ºè§¦å‘å™¨ä¸­\u003c/code\u003eå‹¾é€‰\u003ccode\u003eGeneric Webhook Trigger\u003c/code\u003e, åœ¨å±•å¼€çš„é¡µé¢ä¸­ä¼šæœ‰ä¸€ä¸ª\u003ccode\u003eURL\u003c/code\u003e, è¿™ä¸ª\u003ccode\u003eURL\u003c/code\u003eæ˜¯é…ç½®\u003ccode\u003eWebhook\u003c/code\u003eä½¿ç”¨çš„ï¼Œä¸€èˆ¬å½¢å¼æ˜¯\u003ccode\u003ehttp://JENKINS_URL/generic-webhook-trigger/invoke\u003c/code\u003e, \u003ccode\u003eJENKINS_URL\u003c/code\u003eæ˜¯åˆå§‹é…ç½®\u003ccode\u003ejenkins\u003c/code\u003eæ—¶ä¼šæœ‰çš„ï¼Œä¸€èˆ¬æ˜¯\u003ccode\u003ehttp://IP:8080\u003c/code\u003eçš„å½¢å¼ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœä¹‹å‰æœ‰é…ç½®è¿‡\u003ccode\u003eGitLab webhook\u003c/code\u003e, è¯·å»é™¤è¿™ä¸ªï¼Œä¸ç„¶\u003ccode\u003eGeneric Webhook Trigger\u003c/code\u003eä¸ä¼šç”Ÿæ•ˆã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœ\u003ccode\u003eGit\u003c/code\u003eä»“åº“çš„éªŒè¯ä½¿ç”¨çš„æ˜¯ç”¨æˆ·åå’Œå¯†ç ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦é…ç½®\u003ccode\u003eToken\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eå¤åˆ¶è¿™ä¸ª\u003ccode\u003eURL\u003c/code\u003eï¼Œå°†\u003ccode\u003eJENKINS_URL\u003c/code\u003eæ›¿æ¢ä¸ºè‡ªå·±çš„çœŸå®æ•°æ®ï¼Œåœ¨\u003ccode\u003eGitLab\u003c/code\u003eçš„å¯¹åº”çš„é¡¹ç›®çš„\u003ccode\u003eè®¾ç½®--\u0026gt;é›†æˆ\u003c/code\u003eä¸­è¾“å…¥ï¼Œæ²¡æœ‰å®‰å…¨ä»¤ç‰Œï¼Œå‹¾é€‰è‡ªå·±éœ€è¦çš„è§¦å‘å™¨äº‹ä»¶ï¼ŒSSLè¯ä¹¦éªŒè¯å¯ä»¥å¼€å¯ï¼Œä¹Ÿå¯ä»¥ä¸å¼€å¯ï¼Œæ¨èå¼€å¯ã€‚\u003c/p\u003e\n\u003cp\u003eä»»åŠ¡è®¾ç½®ç•Œé¢è¿˜æœ‰\u003ccode\u003ePost content parameters\u003c/code\u003e, \u003ccode\u003eHeader parameters\u003c/code\u003e, \u003ccode\u003eRequest parameters\u003c/code\u003e, åˆ†åˆ«æ˜¯è¯·æ±‚çš„\u003ccode\u003epostæ•°æ®\u003c/code\u003eï¼Œ\u003ccode\u003eheaderå¤´\u003c/code\u003eï¼Œ\u003ccode\u003eè¯·æ±‚å¤´\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eä¸€èˆ¬æˆ‘ä»¬åªéœ€è¦\u003ccode\u003epost\u003c/code\u003eçš„æ•°æ®é‡Œçš„å†…å®¹å°±å¤Ÿäº†ã€‚\u003c/p\u003e\n\u003cp\u003eå›¾ç‰‡çš„3ï¼Œ4åˆ†åˆ«æ˜¯\u003ccode\u003eå˜é‡åï¼ˆ3ï¼‰\u003c/code\u003eï¼Œ\u003ccode\u003eå€¼ï¼ˆ4ï¼‰\u003c/code\u003eã€‚å€¼æ˜¯ç›´æ¥ä»\u003ccode\u003epost\u003c/code\u003eçš„\u003ccode\u003ejsonæ ¼å¼\u003c/code\u003eçš„æ•°æ®ä¸­å–å‡ºæ¥çš„ï¼Œæ³¨æ„ï¼Œå€¼çš„è·å–æ–¹å¼æ˜¯\u003ccode\u003eJSONPath\u003c/code\u003eï¼Œå¹¶ä¸”é‡Œé¢æœ‰\u003ccode\u003eç‚¹\u003c/code\u003eï¼Œå¦‚æœ\u003ccode\u003ejson\u003c/code\u003eæ•°æ®æœ‰å¤šå±‚ï¼Œé‚£ä¹ˆå°±å¤šç‚¹å‡ æ¬¡ï¼Œæ¯”å¦‚\u003ccode\u003e$.project.name\u003c/code\u003eç­‰ï¼Œå¯ä»¥é…ç½®å¤šä¸ªå˜é‡ç»„ã€‚\u003c/p\u003e\n\u003cp\u003eæˆ‘ä»¬è¿˜å¯ä»¥\u003ccode\u003eGeneric Webhook Trigger\u003c/code\u003eé…ç½®\u003ccode\u003eOptional filter\u003c/code\u003eï¼Œè®¾ç½®ä¸€ä¸ªè§¦å‘äº‹ä»¶ï¼Œæ¯”å¦‚åªæœ‰å½“ä½ æ¨é€çš„åˆ†æ”¯æ˜¯\u003ccode\u003edevelop\u003c/code\u003eçš„æ—¶å€™ï¼Œæ‰å»æ„å»ºã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eOptional filter\u003c/code\u003eçš„\u003ccode\u003eExpression\u003c/code\u003eæ¡†ä¸­è¾“å…¥\u003ccode\u003e^(refs/heads/develop)$\u003c/code\u003e, åœ¨ä¸‹é¢çš„\u003ccode\u003eText\u003c/code\u003eæ¡†ä¸­è¾“å…¥\u003ccode\u003eæ­¥éª¤3çš„å˜é‡å\u003c/code\u003eï¼Œè¿™é‡Œå†™\u003ccode\u003e$ref\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eshell\u003c/code\u003eä¸­ä½¿ç”¨å˜é‡åçš„æ–¹å¼ä¹Ÿæ˜¯ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚\u003ccode\u003eecho $ref\u003c/code\u003eï¼Œ æ³¨æ„æ²¡æœ‰\u003ccode\u003eç‚¹\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eé…ç½®å®Œæˆåï¼Œä¿å­˜ï¼Œå¯ä»¥ç‚¹å‡»åˆšåˆšé…ç½®çš„\u003ccode\u003eGitLab\u003c/code\u003eçš„\u003ccode\u003ewebhook\u003c/code\u003eé¡µé¢çš„\u003ccode\u003eTest\u003c/code\u003eå¯¹åº”çš„äº‹ä»¶æµ‹è¯•ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eGitLab\u003c/code\u003eçš„\u003ccode\u003epush\u003c/code\u003eçš„\u003ccode\u003ehook\u003c/code\u003eæ•°æ®ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e68\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;object_kind\u0026#34;: \u0026#34;push\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;before\u0026#34;: \u0026#34;95790bf891e76fee5e1747ab589903a6a1f80f22\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;after\u0026#34;: \u0026#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;ref\u0026#34;: \u0026#34;refs/heads/master\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;checkout_sha\u0026#34;: \u0026#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;user_id\u0026#34;: 4,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;user_name\u0026#34;: \u0026#34;John Smith\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;user_username\u0026#34;: \u0026#34;jsmith\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;user_email\u0026#34;: \u0026#34;john@example.com\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;user_avatar\u0026#34;: \u0026#34;https://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=8://s.gravatar.com/avatar/d4c74594d841139328695756648b6bd6?s=80\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;project_id\u0026#34;: 15,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;project\u0026#34;:{\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;id\u0026#34;: 15,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;name\u0026#34;:\u0026#34;Diaspora\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;description\u0026#34;:\u0026#34;\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;web_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;avatar_url\u0026#34;:null,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;git_ssh_url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;git_http_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora.git\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;namespace\u0026#34;:\u0026#34;Mike\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;visibility_level\u0026#34;:0,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;path_with_namespace\u0026#34;:\u0026#34;mike/diaspora\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;default_branch\u0026#34;:\u0026#34;master\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;homepage\u0026#34;:\u0026#34;http://example.com/mike/diaspora\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;ssh_url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;http_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora.git\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;repository\u0026#34;:{\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;name\u0026#34;: \u0026#34;Diaspora\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;url\u0026#34;: \u0026#34;git@example.com:mike/diaspora.git\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;description\u0026#34;: \u0026#34;\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;homepage\u0026#34;: \u0026#34;http://example.com/mike/diaspora\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;git_http_url\u0026#34;:\u0026#34;http://example.com/mike/diaspora.git\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;git_ssh_url\u0026#34;:\u0026#34;git@example.com:mike/diaspora.git\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u0026#34;visibility_level\u0026#34;:0\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  },\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;commits\u0026#34;: [\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;id\u0026#34;: \u0026#34;b6568db1bc1dcd7f8b4d5a946b0b91f9dacd7327\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;message\u0026#34;: \u0026#34;Update Catalan translation to e38cb41.\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;timestamp\u0026#34;: \u0026#34;2011-12-12T14:27:31+02:00\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;url\u0026#34;: \u0026#34;http://example.com/mike/diaspora/commit/b6568db1bc1dcd7f8b4d5a946b0b91f9dacd7327\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;author\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026#34;name\u0026#34;: \u0026#34;Jordi Mallach\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026#34;email\u0026#34;: \u0026#34;jordi@softcatala.org\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      },\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;added\u0026#34;: [\u0026#34;CHANGELOG\u0026#34;],\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;modified\u0026#34;: [\u0026#34;app/controller/application.rb\u0026#34;],\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;removed\u0026#34;: []\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    {\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;id\u0026#34;: \u0026#34;da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;message\u0026#34;: \u0026#34;fixed readme\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;timestamp\u0026#34;: \u0026#34;2012-01-03T23:36:29+02:00\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;url\u0026#34;: \u0026#34;http://example.com/mike/diaspora/commit/da1560886d4f094c3e6c9ef40349f7d38b5d27d7\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;author\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026#34;name\u0026#34;: \u0026#34;GitLab dev user\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u0026#34;email\u0026#34;: \u0026#34;gitlabdev@dv6700.(none)\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      },\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;added\u0026#34;: [\u0026#34;CHANGELOG\u0026#34;],\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;modified\u0026#34;: [\u0026#34;app/controller/application.rb\u0026#34;],\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u0026#34;removed\u0026#34;: []\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  ],\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u0026#34;total_commits_count\u0026#34;: 4\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e}\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Jenkinså¤„ç†GitLab Hook"},{"content":"Jenkinsä¸RocketChaté›†æˆ åœ¨Jenkinsä¸­å®‰è£…æ’ä»¶RocketChat Notifier é…ç½®ä¿¡æ¯ ç‚¹å‡»Jenkinså·¦ä¾§çš„ç³»ç»Ÿç®¡ç†--\u0026gt;ç³»ç»Ÿè®¾ç½®, æ‰¾åˆ°Global RocketChat Notifier Settings.\né…ç½®Rocket Server URL, æ˜¯URL:PORTçš„ç±»å‹, ä¾‹: http://chat.xxxx.com:80.\né…ç½®Login Usernameå’ŒLogin password, æ˜¯RocketChatçš„è´¦å·å¯†ç .\nChannel, å‘é€çš„é¢‘é“.\nBuild Server URL, æ„å»ºçš„æœåŠ¡å™¨å’Œç«¯å£, http://192.168.0.1:8080\nç‚¹å‡»Test Connection, Successè¡¨ç¤ºé…ç½®æˆåŠŸ.\n","permalink":"https://zzhaolei.github.io/posts/jenkins%E4%B8%8Erocketchat%E9%9B%86%E6%88%90/","summary":"\u003ch2 id=\"jenkinsä¸rocketchaté›†æˆ\"\u003eJenkinsä¸RocketChaté›†æˆ\u003c/h2\u003e\n\u003ch3 id=\"åœ¨jenkinsä¸­å®‰è£…æ’ä»¶rocketchat-notifier\"\u003eåœ¨Jenkinsä¸­å®‰è£…æ’ä»¶RocketChat Notifier\u003c/h3\u003e\n\u003ch3 id=\"é…ç½®ä¿¡æ¯\"\u003eé…ç½®ä¿¡æ¯\u003c/h3\u003e\n\u003cp\u003eç‚¹å‡»\u003ccode\u003eJenkins\u003c/code\u003eå·¦ä¾§çš„\u003ccode\u003eç³»ç»Ÿç®¡ç†--\u0026gt;ç³»ç»Ÿè®¾ç½®\u003c/code\u003e, æ‰¾åˆ°\u003ccode\u003eGlobal RocketChat Notifier Settings\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eé…ç½®\u003ccode\u003eRocket Server URL\u003c/code\u003e, æ˜¯\u003ccode\u003eURL:PORT\u003c/code\u003eçš„ç±»å‹, ä¾‹: \u003ccode\u003ehttp://chat.xxxx.com:80\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eé…ç½®\u003ccode\u003eLogin Username\u003c/code\u003eå’Œ\u003ccode\u003eLogin password\u003c/code\u003e, æ˜¯\u003ccode\u003eRocketChat\u003c/code\u003eçš„è´¦å·å¯†ç .\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eChannel\u003c/code\u003e, å‘é€çš„é¢‘é“.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eBuild Server URL\u003c/code\u003e, æ„å»ºçš„æœåŠ¡å™¨å’Œç«¯å£, \u003ccode\u003ehttp://192.168.0.1:8080\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»\u003ccode\u003eTest Connection\u003c/code\u003e, \u003ccode\u003eSuccess\u003c/code\u003eè¡¨ç¤ºé…ç½®æˆåŠŸ.\u003c/p\u003e","title":"Jenkinsä¸RocketChaté›†æˆ"},{"content":"åˆ›å»ºä»»åŠ¡ ç™»å½•Jenkinsï¼Œç‚¹å‡»å·¦ä¾§åˆ—è¡¨çš„æ–°å»ºé€‰é¡¹ã€‚è¾“å…¥ä»»åŠ¡åç§°ï¼Œé€‰æ‹©æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ï¼Œç‚¹å‡»ç¡®å®šã€‚\né…ç½® åœ¨ä»»åŠ¡é…ç½®ç•Œé¢ï¼Œå¯ä»¥è®¾ç½®Generalæ ‡ç­¾ä¸­çš„ä¸¢å¼ƒæ—§çš„æ„å»ºé€‰é¡¹ï¼Œè®¾ç½®ä¿æŒæ„å»ºçš„å¤©æ•°å’Œä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°ã€‚\nç‚¹å‡»æºç ç®¡ç†æ ‡ç­¾ï¼Œé€‰æ‹©gitï¼Œåœ¨Repository URLä¸­è¾“å…¥Gitä»“åº“çš„é“¾æ¥ã€‚\nå¦‚æœæ˜¯HTTPé“¾æ¥ï¼Œé€‰æ‹©Credentialsä¸€è¡Œçš„Add \u0026gt; Jenkins,åœ¨Kindä¸€è¡Œä¸‹æ‹‰é€‰æ‹©Username with password,åœ¨ä¸‹æ–¹Usernameå’ŒPasswordæ¡†ä¸­è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚\nä½¿ç”¨docker jenkinså®¹å™¨é‡Œé¢çš„ssh-keyã€‚ ç›´æ¥ä½¿ç”¨æœåŠ¡å™¨çš„ssh keyå°±å¯ä»¥äº†ã€‚å¦‚æœæŒ‡å®šPath to keyéœ€è¦ä½¿ç”¨dockerä¸­çš„ssh keyã€‚å¦‚æœä½¿ç”¨Source filesé‚£ä¹ˆéœ€è¦ä½¿ç”¨dockerå®¹å™¨ä¸­çš„key, å› ä¸ºSource filesçš„ç›¸å¯¹è·¯å¾„ä¸æ˜¯å›ºåŒ–åˆ°æœ¬åœ°çš„è·¯å¾„, è€Œæ˜¯dockerä¸­çš„è·¯å¾„.\nå¦‚æœæ˜¯SSHé“¾æ¥ï¼Œé€‰æ‹©SSH Username with private key,åœ¨Usernameæ¡†ä¸­è¾“å…¥ç”¨æˆ·åï¼ŒPrivate Key\té€‰æ‹©ä¸ºEnter directly,åœ¨æ˜¾ç¤ºçš„keyæ¡†ä¸­è¾“å…¥ç§é’¥ã€‚ï¼ˆç”Ÿæˆç§˜é’¥ssh-keygen -t rsa -C \u0026quot;email.com\u0026quot;,ç”Ÿæˆçš„æ–‡ä»¶åœ¨homeç›®å½•ä¸‹çš„.sshç›®å½•ä¸‹,ä½¿ç”¨å‘½ä»¤cat id_rsaæŸ¥çœ‹ç§é’¥ï¼Œå¤åˆ¶åˆ°keyæ¡†ä¸­ï¼‰ã€‚ç‚¹å‡»æœ€ä¸‹æ–¹çš„AddæŒ‰é’®ï¼Œä¿å­˜è®¾ç½®ã€‚\nåœ¨Credentialsçš„ä¸‹æ‹‰é€‰é¡¹ä¸­é€‰æ‹©åˆšåˆšåˆ›å»ºUsernameã€‚\nä½¿ç”¨å®šæ—¶ä»»åŠ¡ åœ¨æ„å»ºè§¦å‘å™¨æ ‡ç­¾é‡Œé€‰æ‹©Poll SCM,è¾“å…¥H/2 * * * *, æœ€åç‚¹å‡»ä¿å­˜ã€‚ è¿™æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”2åˆ†é’ŸæŸ¥è¯¢ä¸€æ¬¡ä»£ç ï¼Œå¦‚æœæœ‰æ›´æ–°ï¼Œå°±æ‰§è¡Œä»»åŠ¡ã€‚\nä½¿ç”¨webhook ä½¿ç”¨webhookæ¯”å®šæ—¶ä»»åŠ¡æ›´å¥½ï¼Œwebhookåªæœ‰åœ¨pushæˆ–æŒ‡å®šæ“ä½œæ—¶ï¼Œjenkinsä¼šæ‹‰å–ä»£ç ï¼Œä¸ç”¨å®šæ—¶è®¿é—®ï¼Œè€—è´¹èµ„æºã€‚\néœ€è¦å®‰è£…çš„æ’ä»¶Gitlab Hookã€GitLabã€Gitlab Authenticationã€Build Authorization Token Root é…ç½®jobï¼Œåœ¨æ„å»ºè§¦å‘å™¨ä¸­å‹¾é€‰Build when a change is pushed to GitLab. GitLab CI Service URL: http://æœåŠ¡å™¨IP:8080/project/demo ï¼ŒURLåé¢æ˜¯å›è°ƒåœ°å€ï¼Œå†ç‚¹å‡»é«˜çº§ï¼Œå†Secret tokenè¡Œï¼Œç‚¹å‡»Generateç”Ÿæˆtokenã€‚\nåœ¨GitLabæœåŠ¡å™¨ä¸Šçš„ç›¸å¯¹åº”çš„é¡¹ç›®çš„Settingsé‡Œé¢çš„Integrationsä¸­ï¼Œé…ç½®webhook,è¾“å…¥åœ¨jenkinsä¸­è·å–çš„URL,å’Œtokenï¼Œå¯ä»¥æ ¹æ®éœ€è¦å‹¾é€‰äº‹ä»¶ï¼Œå¼€å¯SSLï¼Œç‚¹å‡»Add webhookã€‚ä¼šåœ¨Add webhookæŒ‰é’®ä¸‹ç”Ÿæˆä¸€ä¸ªwebhookï¼Œç‚¹å‡»test,ä¼šå¼¹å‡ºå‹¾é€‰çš„äº‹ä»¶ï¼Œé€‰æ‹©ç›¸åº”çš„äº‹ä»¶ï¼Œä¼šåœ¨é¡µé¡¶å¼¹å‡ºHook executed successfully: HTTP 200,åˆ°æ­¤ï¼Œwebhooké…ç½®å®Œæˆã€‚\næ³¨æ„ï¼šåœ¨è„šæœ¬ä¸­ä½¿ç”¨docker execæ‰§è¡Œå®¹å™¨ä¸­çš„å‘½ä»¤æ˜¯, ä¸è¦æŒ‡å®š-it, -tæ˜¯æŒ‡å®štty, è€Œjenkinsä¸­æ²¡æœ‰tty, åªéœ€è¦æŒ‡å®š-iå³å¯. 1 å°†ä»£ç éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨ ä¸éœ€è¦ä½¿ç”¨å®¹å™¨ä¸­çš„ssh-keyã€‚ åœ¨jenkinsæœåŠ¡å™¨ä¸Šç”Ÿæˆkeyssh-keygen -t rsa -C \u0026quot;email.com\u0026quot;ï¼Œ ä½¿ç”¨ssh-copy-id -i ~/.ssh/id_rsa.pub user@ip(å¦‚æœç«¯å£ä¸æ˜¯22ï¼Œå¯ä»¥æ·»åŠ å‚æ•°-p portè¿›è¡Œä¿®æ”¹ï¼Œportä¸ºç«¯å£æ•°å€¼), å°†ç”Ÿæˆçš„å…¬é’¥ä¿å­˜åœ¨ç›®æ ‡æœåŠ¡å™¨ã€‚è¿™æ ·å¯ä»¥å…å¯†ç ç™»å½•ã€‚\nå®‰è£…Publish over SSHæ’ä»¶ï¼Œåœ¨ç³»ç»Ÿç®¡ç†\u0026ndash;\u0026gt;ç³»ç»Ÿè®¾ç½®é‡Œé¢æ‰¾åˆ°Publish over SSHã€‚ é…ç½®Jenkins SSH Keyï¼Œå¦‚æœkeyåœ¨ç”Ÿæˆæ—¶è®¾ç½®äº†å¯†ç ï¼Œå°±åœ¨Passphraseé‡Œè¾“å…¥å¯†ç ï¼Œæ²¡æœ‰åˆ™å¿½ç•¥ã€‚ å¤åˆ¶ç§é’¥ï¼Œç²˜è´´è¿›Keyé‡Œé¢ã€‚\né…ç½®SSH Servers,ç‚¹å‡»å¢åŠ ã€‚Nameä¸ºSSHçš„åç§°ï¼ŒHostnameæ˜¯è¿œç¨‹æœåŠ¡å™¨çš„IPåœ°å€ï¼ŒUsernameæ˜¯ç™»å½•çš„ç”¨æˆ·åï¼ŒRemote Directoryæ˜¯è¿œç¨‹æœåŠ¡å™¨çš„ç›®å½•ï¼Œå¿…é¡»æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œæ’ä»¶ä¸ä¼šè‡ªåŠ¨åˆ›å»ºã€‚\nç‚¹å‡»Test Configurationæµ‹è¯•é…ç½®æ˜¯å¦æˆåŠŸã€‚æˆåŠŸä¼šæ˜¾ç¤ºSuccessã€‚\n1.1è¿œç¨‹éƒ¨ç½²ä»»åŠ¡ å†åˆ›å»ºä¸€ä¸ªæ„å»ºä»»åŠ¡ï¼Œå½“æœ‰è§¦å‘ä»»åŠ¡æ—¶ï¼Œæ„å»ºä»»åŠ¡è¿è¡Œã€‚\nè¿˜æ˜¯ç‚¹å‡»æ–°å»ºï¼Œè¾“å…¥ä¸€ä¸ªä»»åŠ¡åç§°ï¼Œä¸ç‚¹å‡»æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®,åœ¨æœ€ä¸‹é¢çš„å¤åˆ¶æ¡†ä¸­ï¼Œè¾“å…¥åˆšåˆšåˆ›å»ºçš„è§¦å‘ä»»åŠ¡åç§°ã€‚ ç‚¹å‡»ç¡®å®šã€‚å¦‚æœè¾“å…¥çš„ä»»åŠ¡åä¸å­˜åœ¨ï¼Œä¼šæŠ¥é”™ï¼Œå¹¶è®©ä½ é‡æ–°è¾“å…¥ä¸€æ¬¡ã€‚\nåœ¨æ„å»ºè§¦å‘å™¨ä¸­é€‰æ‹©Build after other projects are builtï¼Œåœ¨å…¶ä»–é¡¹ç›®å»ºæˆåè¿›è¡Œæ„å»ºï¼ŒProjects to watché€‰æ‹©ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼Œå¯èƒ½ä¼šæŠ¥é”™No such project â€˜golâ€™. Did you mean â€˜golismeroâ€™?ï¼Œä¸ç”¨ç†ä¼šï¼Œå¦‚æœæ˜¯å•ä¸ªä»»åŠ¡ï¼Œå¯ä»¥æŠŠæœ€åé¢çš„, é€—å·å’Œç©ºæ ¼åˆ é™¤ï¼Œå°±ä¸ä¼šæŠ¥é”™äº†ï¼Œä¸åˆ ä¹Ÿæ²¡æœ‰å½±å“ã€‚ å‹¾é€‰ä¸‹é¢çš„Trigger only if build is stableï¼Œåªæœ‰åœ¨æ„å»ºç¨³å®šæ—¶æ‰è§¦å‘ã€‚\nå…¶ä»–è®¾ç½®ä¸å˜ï¼Œæ„å»ºåæ“ä½œä¸­å¢åŠ æ„å»ºåæ“ä½œæ­¥éª¤ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­é€‰æ‹©Send build artifacts SSH,è¾“å…¥SSH Server Name(æ˜¯è¿œç¨‹ä¸»æœºIP)ï¼Œç„¶ååœ¨Transfersä¸­çš„Exec commandä¸­è¾“å…¥è„šæœ¬å‘½ä»¤ï¼Œå…¶ä»–é€‰é¡¹æš‚æ—¶ä¸ç”¨å¡«å†™ã€‚\nSource filesæ˜¯ç›¸å¯¹äºworkspaceä¸‹é¡¹ç›®ç›®å½•çš„ç›®å½•, æ˜¯ä¸€ä¸ªç›¸å¯¹ç›®å½•, å¦‚æœåœ¨workspaceç›®å½•, å³jenkinsçš„å·¥ä½œç›®å½•, é‚£ä¹ˆéœ€è¦å¡«å†™**/, åé¢å¯ä»¥è·Ÿå·¥ä½œç›®å½•ä¸‹çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹.\nRemove prefixæ–‡ä»¶å¤åˆ¶æ—¶è¦è¿‡æ»¤çš„ç›®å½•.\nRemote directoryæ–‡ä»¶å¾—åˆ°åˆ°è¿œç¨‹æœºä¸Šçš„ç›®å½•ï¼Œæ­¤ç›®å½•æ˜¯ç›¸å¯¹äºSSH Serverä¸­çš„Remote directoryçš„ï¼Œå¦‚æœä¸å­˜åœ¨å°†ä¼šè‡ªåŠ¨åˆ›å»ºã€‚\nä¿å­˜ï¼Œå³å¯çœ‹åˆ°è§¦å‘ä»»åŠ¡å’Œæ„å»ºä»»åŠ¡ã€‚\nè¿˜æœ‰å¦ä¸€ç§æ–¹å¼å¯ä»¥éƒ¨ç½²\n2 SSHæ’ä»¶éƒ¨ç½² è¿™ç§æ–¹å¼éœ€è¦å®‰è£…SSHæ’ä»¶ã€‚\nç‚¹å‡»Credentials\u0026ndash;\u0026gt;System\u0026ndash;\u0026gt;Add domainï¼Œåœ¨Domain Nameä¸­è¾“å…¥åç§°ï¼ŒDescriptionæè¿°ï¼Œå¯å†™å¯ä¸å†™ï¼ŒSpecificationä¿æŒé»˜è®¤ä¸ºAddï¼Œç‚¹å‡»okã€‚åœ¨æ–°é¡µé¢ç‚¹å‡»å·¦ä¸Šçš„Add Credentialsï¼Œè¾“å…¥è¿œç¨‹ç™»å½•çš„Usernameå’ŒPasswordï¼Œç‚¹å‡»OKã€‚ ç‚¹å‡»ç³»ç»Ÿç®¡ç†\u0026ndash;\u0026gt;ç³»ç»Ÿè®¾ç½®ï¼Œæ‰¾åˆ°SSH remote hostsï¼Œé…ç½®SSH siteï¼Œç‚¹å‡»å¢åŠ ï¼Œè¾“å…¥Hostnameä¸»æœºIPï¼ŒPortè¿œç¨‹è¿æ¥ç«¯å£ï¼ˆä¸€èˆ¬ä¸º22ï¼‰ï¼ŒCredentialsé€‰æ‹©åˆšåˆšåˆ›å»ºDomainï¼Œå’ŒUsernameç›¸åŒï¼Œç‚¹å‡»Check connectionï¼Œæ˜¾ç¤ºSuccessfull connectionï¼ŒæˆåŠŸï¼Œç‚¹å‡»ä¿å­˜ã€‚\n2.1 è¿œç¨‹éƒ¨ç½²ä»»åŠ¡ åŸºæœ¬å’Œ1.1ç›¸åŒï¼Œä½†æ˜¯è¿™ä¸ªæ˜¯åœ¨æ„å»ºä¸­å¢åŠ æ„å»ºæ­¥éª¤ï¼Œåœ¨å¼¹å‡ºçš„é€‰é¡¹ä¸­é€‰æ‹©Execute shell script on remote host using sshï¼Œé»˜è®¤ä¼šè‡ªåŠ¨å¡«å†™SSH siteï¼ˆå¦‚æœæ²¡æœ‰å¡«å†™ï¼Œç‚¹å‡»è¾“å…¥æ¡†çœ‹çœ‹æœ‰æ²¡æœ‰ï¼Œå¦‚æœæ²¡æœ‰å¯èƒ½æ˜¯å‰é¢å‡ºç°é”™è¯¯ï¼‰ï¼Œå¯èƒ½ä¼šæœ‰çº¢å­—æŠ¥é”™SSH Site not specifiedï¼Œä¸ç”¨ç†ã€‚åœ¨Commandè¾“å…¥æ¡†ä¸­è¾“å…¥shellè„šæœ¬ã€‚ä¿å­˜å³å¯ã€‚\nè¿™ç§æ–¹å¼æ²¡æœ‰ç¬¬ä¸€ç§æ„å»ºçš„å¿«ã€‚\né…ç½®é‚®ä»¶ å¯ä»¥å®‰è£…Email Extension Pluginæ’ä»¶ï¼Œæ‰©å±•é‚®ç®±åŠŸèƒ½ã€‚\nç‚¹å‡»å·¦ä¾§çš„ç³»ç»Ÿç®¡ç†ï¼Œåœ¨ç®¡ç†Jenkinsåˆ—ç‚¹å‡»ç³»ç»Ÿè®¾ç½®ï¼Œåœ¨æ–°é¡µé¢æ‰¾åˆ°Jenkins Location,åœ¨ç³»ç»Ÿç®¡ç†å‘˜é‚®ä»¶åœ°å€æ ä¸­è¾“å…¥å‘ä»¶äººï¼Œæ ¼å¼ä¸ºæ ‡é¢˜\u0026lt;email.com\u0026gt;,å†æ‰¾åˆ°é‚®ä»¶é€šçŸ¥ï¼Œç‚¹å‡»é«˜çº§æŒ‰é’®ï¼Œæ·»åŠ SMTPæœåŠ¡å™¨,ä»¥åŠé‚®ä»¶åç¼€(@xxx.com)ï¼Œä½¿ç”¨SMTPéªŒè¯çš„ç”¨æˆ·åä¸ºå®Œæ•´çš„é‚®ç®±è´¦å·ï¼Œå¯†ç æ˜¯æˆæƒç ã€‚ï¼ˆè…¾è®¯ä¼ä¸šé‚®ç®±å¦‚æœç»‘å®šäº†å¾®ä¿¡ï¼Œåœ¨è®¾ç½®-å¾®ä¿¡ç»‘å®š-å®¢æˆ·ç«¯ä¸“ç”¨å¯†ç ï¼Œç”Ÿæˆæˆæƒç ï¼Œä¿å­˜è®¾ç½®ã€‚ï¼‰å‹¾é€‰ä½¿ç”¨SSLåè®®ï¼ŒSMTPç«¯å£æ˜¯465, Reply-To Addresså¡«å†™æ”¶ä»¶äººåœ°å€ã€‚\né«˜çº§ç‰ˆé‚®ä»¶é€šçŸ¥ éœ€è¦å®‰è£…Email Extensionæ’ä»¶ï¼Œå®‰è£…å¥½åï¼Œç‚¹å‡»ç³»ç»Ÿç®¡ç†\u0026ndash;\u0026gt;ç³»ç»Ÿè®¾ç½®æ‰¾åˆ°Extended E-mail Notificationï¼Œé…ç½®SMTP serveræœåŠ¡å™¨åœ°ï¼Œæ ¼å¼ä¸ºsmtp.exmail.qq.com(è¿™é‡Œç”¨è…¾è®¯ä¼ä¸šé‚®ç®±ä½œä¸ºä¾‹å­).\nDefault user E-mail suffixè®¾ç½®é‚®ç®±åç¼€ï¼Œå°±æ˜¯@åŠåé¢çš„å­—ç¬¦@xxx.com.\nDefault Content Typeé»˜è®¤å‘é€çš„å†…å®¹ç±»å‹é€‰æ‹©HTML/(text/html).\nDefault Recipientsé»˜è®¤æ”¶ä»¶äººï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªæ”¶ä»¶äººï¼Œä¸­é—´ç”¨, éš”å¼€ï¼Œè‹±æ–‡çŠ¶æ€ä¸‹çš„ç¬¦å·.\nDefault Subjecté»˜è®¤ä¸»é¢˜ä¸ç”¨æ”¹ï¼Œä¹Ÿå¯ä»¥åœ¨æœ€å‰é¢åŠ ä¸€äº›æ–‡å­—ï¼Œæ¯”å¦‚æ„å»ºé€šçŸ¥.\nDefault Contentè¿™é‡Œé¢æ˜¯é»˜è®¤æ¨¡æ¿ï¼Œå¯ä»¥åœ¨ç½‘ä¸Šæ‰¾æ¨¡æ¿æ›´æ”¹ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å†™ï¼Œhtmlç±»å‹ã€‚\nç‚¹å‡»ä¸Šé¢çš„é«˜çº§æŒ‰é’®ï¼Œå‹¾é€‰Use SMTP Authenticationï¼Œè¾“å…¥Usernameå’ŒPasswordï¼ŒPasswordæ˜¯å®¢æˆ·ç«¯æˆæƒå¯†ç è¦å’Œé…ç½®é‚®ä»¶ä¸­çš„æˆæƒç ä¸€æ ·ï¼Œå‹¾é€‰SSLï¼Œç‚¹å‡»ä¿å­˜ã€‚\nä¸ºå•ä¸ªçš„Jobå¢åŠ æ„å»ºåæ­¥éª¤, é€‰æ‹©Editable Email Notification, åœ¨Project Recipient Listæ”¶ä»¶äººåˆ—è¡¨ä¸­è¾“å…¥æ”¶ä»¶äººé‚®ç®±, å¤šä¸ªå¯ä»¥ç”¨, åˆ†å‰², æƒ³ä½¿ç”¨å…¨å±€é»˜è®¤é…ç½®çš„è¯, å¯ä»¥ä½¿ç”¨$DEFAULT_RECIPIENTS.\nProject Reply-To Listå…è®¸å›å¤äººåˆ—è¡¨, é»˜è®¤å€¼$DEFAULT_REPLYTOã€‚\nContent Typeæ–‡æ¡£ç±»å‹, å¯ä»¥è®¾ç½®HTMLã€‚\nAttach Build Logå‘é€çš„é‚®ä»¶æ˜¯å¦åŒ…å«æ—¥å¿—ã€‚\nç‚¹å‡»Advanced Settings, åœ¨Triggersä¸­, åˆ é™¤Sent Toé»˜è®¤çš„Developer List, ç‚¹å‡»Addæ·»åŠ Recipient List, ä¿å­˜å®Œæˆã€‚\n","permalink":"https://zzhaolei.github.io/posts/jenkins+python+gitlab%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/","summary":"\u003ch2 id=\"åˆ›å»ºä»»åŠ¡\"\u003eåˆ›å»ºä»»åŠ¡\u003c/h2\u003e\n\u003cp\u003eç™»å½•\u003ccode\u003eJenkins\u003c/code\u003eï¼Œç‚¹å‡»å·¦ä¾§åˆ—è¡¨çš„\u003ccode\u003eæ–°å»º\u003c/code\u003eé€‰é¡¹ã€‚è¾“å…¥ä»»åŠ¡åç§°ï¼Œé€‰æ‹©\u003ccode\u003eæ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®\u003c/code\u003eï¼Œç‚¹å‡»\u003ccode\u003eç¡®å®š\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch2 id=\"é…ç½®\"\u003eé…ç½®\u003c/h2\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eä»»åŠ¡é…ç½®\u003c/code\u003eç•Œé¢ï¼Œå¯ä»¥è®¾ç½®\u003ccode\u003eGeneralæ ‡ç­¾\u003c/code\u003eä¸­çš„\u003ccode\u003eä¸¢å¼ƒæ—§çš„æ„å»º\u003c/code\u003eé€‰é¡¹ï¼Œè®¾ç½®\u003ccode\u003eä¿æŒæ„å»ºçš„å¤©æ•°\u003c/code\u003eå’Œ\u003ccode\u003eä¿æŒæ„å»ºçš„æœ€å¤§ä¸ªæ•°\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eç‚¹å‡»\u003ccode\u003eæºç ç®¡ç†\u003c/code\u003eæ ‡ç­¾ï¼Œé€‰æ‹©\u003ccode\u003egit\u003c/code\u003eï¼Œåœ¨\u003ccode\u003eRepository URL\u003c/code\u003eä¸­è¾“å…¥Gitä»“åº“çš„é“¾æ¥ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯HTTPé“¾æ¥ï¼Œé€‰æ‹©\u003ccode\u003eCredentials\u003c/code\u003eä¸€è¡Œçš„\u003ccode\u003eAdd \u0026gt; Jenkins\u003c/code\u003e,åœ¨\u003ccode\u003eKind\u003c/code\u003eä¸€è¡Œä¸‹æ‹‰é€‰æ‹©\u003ccode\u003eUsername with password\u003c/code\u003e,åœ¨ä¸‹æ–¹\u003ccode\u003eUsername\u003c/code\u003eå’Œ\u003ccode\u003ePassword\u003c/code\u003eæ¡†ä¸­è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cdel\u003eä½¿ç”¨docker jenkinså®¹å™¨é‡Œé¢çš„ssh-keyã€‚\u003c/del\u003e\nç›´æ¥ä½¿ç”¨æœåŠ¡å™¨çš„\u003ccode\u003essh key\u003c/code\u003eå°±å¯ä»¥äº†ã€‚å¦‚æœæŒ‡å®š\u003ccode\u003ePath to key\u003c/code\u003eéœ€è¦ä½¿ç”¨\u003ccode\u003edocker\u003c/code\u003eä¸­çš„\u003ccode\u003essh key\u003c/code\u003eã€‚å¦‚æœä½¿ç”¨\u003ccode\u003eSource files\u003c/code\u003eé‚£ä¹ˆéœ€è¦ä½¿ç”¨\u003ccode\u003edocker\u003c/code\u003eå®¹å™¨ä¸­çš„\u003ccode\u003ekey\u003c/code\u003e, å› ä¸º\u003ccode\u003eSource files\u003c/code\u003eçš„ç›¸å¯¹è·¯å¾„ä¸æ˜¯å›ºåŒ–åˆ°æœ¬åœ°çš„è·¯å¾„, è€Œæ˜¯\u003ccode\u003edocker\u003c/code\u003eä¸­çš„è·¯å¾„.\u003c/p\u003e\n\u003cp\u003eå¦‚æœæ˜¯\u003ccode\u003eSSH\u003c/code\u003eé“¾æ¥ï¼Œé€‰æ‹©\u003ccode\u003eSSH Username with private key\u003c/code\u003e,åœ¨\u003ccode\u003eUsername\u003c/code\u003eæ¡†ä¸­è¾“å…¥ç”¨æˆ·åï¼Œ\u003ccode\u003ePrivate Key\t\u003c/code\u003eé€‰æ‹©ä¸º\u003ccode\u003eEnter directly\u003c/code\u003e,åœ¨æ˜¾ç¤ºçš„\u003ccode\u003ekey\u003c/code\u003eæ¡†ä¸­è¾“å…¥ç§é’¥ã€‚ï¼ˆç”Ÿæˆç§˜é’¥\u003ccode\u003essh-keygen -t rsa -C \u0026quot;email.com\u0026quot;\u003c/code\u003e,ç”Ÿæˆçš„æ–‡ä»¶åœ¨\u003ccode\u003ehome\u003c/code\u003eç›®å½•ä¸‹çš„\u003ccode\u003e.ssh\u003c/code\u003eç›®å½•ä¸‹,ä½¿ç”¨å‘½ä»¤\u003ccode\u003ecat id_rsa\u003c/code\u003eæŸ¥çœ‹ç§é’¥ï¼Œå¤åˆ¶åˆ°\u003ccode\u003ekey\u003c/code\u003eæ¡†ä¸­ï¼‰ã€‚ç‚¹å‡»æœ€ä¸‹æ–¹çš„\u003ccode\u003eAdd\u003c/code\u003eæŒ‰é’®ï¼Œä¿å­˜è®¾ç½®ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eCredentials\u003c/code\u003eçš„ä¸‹æ‹‰é€‰é¡¹ä¸­é€‰æ‹©åˆšåˆšåˆ›å»º\u003ccode\u003eUsername\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½¿ç”¨å®šæ—¶ä»»åŠ¡\"\u003eä½¿ç”¨å®šæ—¶ä»»åŠ¡\u003c/h2\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eæ„å»ºè§¦å‘å™¨\u003c/code\u003eæ ‡ç­¾é‡Œé€‰æ‹©\u003ccode\u003ePoll SCM\u003c/code\u003e,è¾“å…¥\u003ccode\u003eH/2 * * * *\u003c/code\u003e, æœ€åç‚¹å‡»\u003ccode\u003eä¿å­˜\u003c/code\u003eã€‚\nè¿™æ˜¯ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”2åˆ†é’ŸæŸ¥è¯¢ä¸€æ¬¡ä»£ç ï¼Œå¦‚æœæœ‰æ›´æ–°ï¼Œå°±æ‰§è¡Œä»»åŠ¡ã€‚\u003c/p\u003e\n\u003ch2 id=\"ä½¿ç”¨webhook\"\u003eä½¿ç”¨webhook\u003c/h2\u003e\n\u003cp\u003eä½¿ç”¨webhookæ¯”å®šæ—¶ä»»åŠ¡æ›´å¥½ï¼Œwebhookåªæœ‰åœ¨pushæˆ–æŒ‡å®šæ“ä½œæ—¶ï¼Œjenkinsä¼šæ‹‰å–ä»£ç ï¼Œä¸ç”¨å®šæ—¶è®¿é—®ï¼Œè€—è´¹èµ„æºã€‚\u003c/p\u003e\n\u003cp\u003eéœ€è¦å®‰è£…çš„æ’ä»¶\u003ccode\u003eGitlab Hookã€GitLabã€Gitlab Authenticationã€Build Authorization Token Root\u003c/code\u003e\né…ç½®\u003ccode\u003ejob\u003c/code\u003eï¼Œåœ¨\u003ccode\u003eæ„å»ºè§¦å‘å™¨\u003c/code\u003eä¸­å‹¾é€‰\u003ccode\u003eBuild when a change is pushed to GitLab. GitLab CI Service URL: http://æœåŠ¡å™¨IP:8080/project/demo\u003c/code\u003e ï¼Œ\u003ccode\u003eURL\u003c/code\u003eåé¢æ˜¯å›è°ƒåœ°å€ï¼Œå†ç‚¹å‡»\u003ccode\u003eé«˜çº§\u003c/code\u003eï¼Œå†\u003ccode\u003eSecret token\u003c/code\u003eè¡Œï¼Œç‚¹å‡»\u003ccode\u003eGenerate\u003c/code\u003eç”Ÿæˆ\u003ccode\u003etoken\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨\u003ccode\u003eGitLab\u003c/code\u003eæœåŠ¡å™¨ä¸Šçš„ç›¸å¯¹åº”çš„é¡¹ç›®çš„\u003ccode\u003eSettings\u003c/code\u003eé‡Œé¢çš„\u003ccode\u003eIntegrations\u003c/code\u003eä¸­ï¼Œé…ç½®\u003ccode\u003ewebhook\u003c/code\u003e,è¾“å…¥åœ¨jenkinsä¸­è·å–çš„\u003ccode\u003eURL\u003c/code\u003e,å’Œ\u003ccode\u003etoken\u003c/code\u003eï¼Œå¯ä»¥æ ¹æ®éœ€è¦å‹¾é€‰äº‹ä»¶ï¼Œå¼€å¯SSLï¼Œç‚¹å‡»\u003ccode\u003eAdd webhook\u003c/code\u003eã€‚ä¼šåœ¨\u003ccode\u003eAdd webhook\u003c/code\u003eæŒ‰é’®ä¸‹ç”Ÿæˆä¸€ä¸ª\u003ccode\u003ewebhook\u003c/code\u003eï¼Œç‚¹å‡»\u003ccode\u003etest\u003c/code\u003e,ä¼šå¼¹å‡ºå‹¾é€‰çš„äº‹ä»¶ï¼Œé€‰æ‹©ç›¸åº”çš„äº‹ä»¶ï¼Œä¼šåœ¨é¡µé¡¶å¼¹å‡º\u003ccode\u003eHook executed successfully: HTTP 200\u003c/code\u003e,åˆ°æ­¤ï¼Œ\u003ccode\u003ewebhook\u003c/code\u003eé…ç½®å®Œæˆã€‚\u003c/p\u003e","title":"Jenkins+Python+GitLabæŒç»­é›†æˆ"},{"content":"jenkins+Gitå­æ¨¡å—è‡ªåŠ¨æ‹‰å–ä»£ç  æ·»åŠ Gitå­æ¨¡å— å…ˆå…‹éš†æƒ³è¦æ·»åŠ å­æ¨¡å—çš„ä»“åº“git clone ssh://git@ip:port/user/project.gitï¼Œè¿™ä¸ªæ˜¯ä¸»ç›®å½•ã€‚\nè¿›å…¥ä»“åº“ï¼Œæ·»åŠ å­æ¨¡å—git submodule add ssh://git@ip:port/user/project.gitï¼Œå’Œä¸»ä»“åº“ä¸åŒã€‚\nlsæŸ¥çœ‹ï¼Œä¼šæœ‰.gitmoduleså’Œå­æ¨¡å—çš„é¡¹ç›®åã€‚\nå°†ç”Ÿæˆçš„æ–‡ä»¶å’Œç›®å½•pushåˆ°ä¸»ä»“åº“ä¸­ã€‚\nå…‹éš†æœ‰å­æ¨¡å—çš„ä»“åº“ æ·»åŠ è¿‡å­æ¨¡å—çš„ä»“åº“ï¼Œå¦‚æœæƒ³é‡æ–°å…‹éš†ï¼Œå’Œæ™®é€šå…‹éš†ä¸€æ ·ï¼Œä¸è¿‡å…‹éš†åéœ€è¦åœ¨ä»“åº“ç›®å½•ä¸‹æ‰§è¡Œ git submodule initå’Œgit submodule updateï¼Œå¦‚æœä¸æ‰§è¡Œï¼Œå­æ¨¡å—ä¸­ä¼šæ²¡æœ‰æ–‡ä»¶ã€‚\næ›´æ”¹å­æ¨¡å—çš„åˆ†æ”¯ åˆ‡æ¢åˆ°å­æ¨¡å—ç›®å½•ï¼Œé»˜è®¤å­æ¨¡å—æ˜¯masteråˆ†æ”¯ï¼Œgit submodule foreach git checkout devï¼Œ ç„¶åä½¿ç”¨git submodule foreach git pullåˆ‡æ¢åˆ†æ”¯ã€‚\néœ€è¦åœ¨jenkinsä»»åŠ¡çš„æ„å»ºæ­¥éª¤ä¸­æ·»åŠ git submodule initå’Œgit submodule updateï¼Œä»¥åŠä¸Šè¿°æ“ä½œï¼ˆå†™åœ¨è¿™ä¸¤ä¸ªå‘½ä»¤åé¢ï¼‰ï¼Œ jenkinsæ‰èƒ½æ‹‰å–åˆ°ä»£ç ã€‚\nsubmoduleå¯ä»¥è¿›è¡Œtagå’Œmerge git submodule foreachå¯ä»¥åˆ†åˆ«å¯¹å­æ¨¡å—è¿›è¡Œæ“ä½œ, æ‰€ä»¥å¯¹æ‰€æœ‰å­æ¨¡å—è¿›è¡Œtagå’Œmergeæ“ä½œ, å°±ç›¸å½“äºå¯¹æ€»é¡¹ç›®è¿›è¡Œç›¸åº”çš„æ“ä½œ.\n","permalink":"https://zzhaolei.github.io/posts/jenkins+git%E5%AD%90%E6%A8%A1%E5%9D%97%E8%87%AA%E5%8A%A8%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81/","summary":"\u003ch2 id=\"jenkinsgitå­æ¨¡å—è‡ªåŠ¨æ‹‰å–ä»£ç \"\u003ejenkins+Gitå­æ¨¡å—è‡ªåŠ¨æ‹‰å–ä»£ç \u003c/h2\u003e\n\u003cp\u003eæ·»åŠ Gitå­æ¨¡å—\nå…ˆå…‹éš†æƒ³è¦æ·»åŠ å­æ¨¡å—çš„ä»“åº“\u003ccode\u003egit clone ssh://git@ip:port/user/project.git\u003c/code\u003eï¼Œè¿™ä¸ªæ˜¯ä¸»ç›®å½•ã€‚\u003c/p\u003e\n\u003cp\u003eè¿›å…¥ä»“åº“ï¼Œæ·»åŠ å­æ¨¡å—\u003ccode\u003egit submodule add ssh://git@ip:port/user/project.git\u003c/code\u003eï¼Œå’Œä¸»ä»“åº“ä¸åŒã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003els\u003c/code\u003eæŸ¥çœ‹ï¼Œä¼šæœ‰\u003ccode\u003e.gitmodules\u003c/code\u003eå’Œå­æ¨¡å—çš„é¡¹ç›®åã€‚\u003c/p\u003e\n\u003cp\u003eå°†ç”Ÿæˆçš„æ–‡ä»¶å’Œç›®å½•pushåˆ°ä¸»ä»“åº“ä¸­ã€‚\u003c/p\u003e\n\u003ch2 id=\"å…‹éš†æœ‰å­æ¨¡å—çš„ä»“åº“\"\u003eå…‹éš†æœ‰å­æ¨¡å—çš„ä»“åº“\u003c/h2\u003e\n\u003cp\u003eæ·»åŠ è¿‡å­æ¨¡å—çš„ä»“åº“ï¼Œå¦‚æœæƒ³é‡æ–°å…‹éš†ï¼Œå’Œæ™®é€šå…‹éš†ä¸€æ ·ï¼Œä¸è¿‡å…‹éš†åéœ€è¦åœ¨ä»“åº“ç›®å½•ä¸‹æ‰§è¡Œ\n\u003ccode\u003egit submodule init\u003c/code\u003eå’Œ\u003ccode\u003egit submodule update\u003c/code\u003eï¼Œå¦‚æœä¸æ‰§è¡Œï¼Œå­æ¨¡å—ä¸­ä¼šæ²¡æœ‰æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003ch2 id=\"æ›´æ”¹å­æ¨¡å—çš„åˆ†æ”¯\"\u003eæ›´æ”¹å­æ¨¡å—çš„åˆ†æ”¯\u003c/h2\u003e\n\u003cp\u003eåˆ‡æ¢åˆ°å­æ¨¡å—ç›®å½•ï¼Œé»˜è®¤å­æ¨¡å—æ˜¯masteråˆ†æ”¯ï¼Œ\u003ccode\u003egit submodule foreach git checkout dev\u003c/code\u003eï¼Œ\nç„¶åä½¿ç”¨\u003ccode\u003egit submodule foreach git pull\u003c/code\u003eåˆ‡æ¢åˆ†æ”¯ã€‚\u003c/p\u003e\n\u003cp\u003eéœ€è¦åœ¨\u003ccode\u003ejenkins\u003c/code\u003eä»»åŠ¡çš„\u003ccode\u003eæ„å»ºæ­¥éª¤\u003c/code\u003eä¸­æ·»åŠ \u003ccode\u003egit submodule init\u003c/code\u003eå’Œ\u003ccode\u003egit submodule update\u003c/code\u003eï¼Œä»¥åŠä¸Šè¿°æ“ä½œï¼ˆå†™åœ¨è¿™ä¸¤ä¸ªå‘½ä»¤åé¢ï¼‰ï¼Œ\n\u003ccode\u003ejenkins\u003c/code\u003eæ‰èƒ½æ‹‰å–åˆ°ä»£ç ã€‚\u003c/p\u003e\n\u003ch2 id=\"submoduleå¯ä»¥è¿›è¡Œtagå’Œmerge\"\u003esubmoduleå¯ä»¥è¿›è¡Œtagå’Œmerge\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003egit submodule foreach\u003c/code\u003eå¯ä»¥åˆ†åˆ«å¯¹å­æ¨¡å—è¿›è¡Œæ“ä½œ, æ‰€ä»¥å¯¹æ‰€æœ‰å­æ¨¡å—è¿›è¡Œ\u003ccode\u003etag\u003c/code\u003eå’Œ\u003ccode\u003emerge\u003c/code\u003eæ“ä½œ, å°±ç›¸å½“äºå¯¹æ€»é¡¹ç›®è¿›è¡Œç›¸åº”çš„æ“ä½œ.\u003c/p\u003e","title":"Jenkins+Gitå­æ¨¡å—è‡ªåŠ¨æ‹‰å–ä»£ç "},{"content":" 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;${ENV, var=\u0026#34;JOB_NAME\u0026#34;}-ç¬¬${BUILD_NUMBER}æ¬¡æ„å»ºæ—¥å¿—\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body leftmargin=\u0026#34;8\u0026#34; marginwidth=\u0026#34;0\u0026#34; topmargin=\u0026#34;8\u0026#34; marginheight=\u0026#34;4\u0026#34; offset=\u0026#34;0\u0026#34;\u0026gt; \u0026lt;table width=\u0026#34;95%\u0026#34; cellpadding=\u0026#34;0\u0026#34; cellspacing=\u0026#34;0\u0026#34; style=\u0026#34;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\u0026#34;\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;(æœ¬é‚®ä»¶ç”±ç¨‹åºè‡ªåŠ¨ä¸‹å‘ï¼Œè¯·å‹¿å›å¤ï¼)\u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;h2\u0026gt;\u0026lt;font color=\u0026#34;#FF0000\u0026#34;\u0026gt;æ„å»ºç»“æœ - ${BUILD_STATUS}\u0026lt;/font\u0026gt;\u0026lt;/h2\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;b\u0026gt;\u0026lt;font color=\u0026#34;#0B610B\u0026#34;\u0026gt;æ„å»ºä¿¡æ¯\u0026lt;/font\u0026gt;\u0026lt;/b\u0026gt; \u0026lt;hr size=\u0026#34;2\u0026#34; width=\u0026#34;100%\u0026#34; align=\u0026#34;center\u0026#34; /\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; SVN_URL \u0026lt;td\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;é¡¹ç›®åç§°ï¼š${PROJECT_NAME}\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;GITè·¯å¾„ï¼š${GIT_URL}\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;æ„å»ºç¼–å·ï¼š${BUILD_NUMBER}\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;GITåˆ†æ”¯ï¼š${GIT_BRANCH}\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;è§¦å‘åŸå› ï¼š${CAUSE}\u0026lt;/li\u0026gt; \u0026lt;li\u0026gt;æ„å»ºæ—¥å¿—ï¼š\u0026lt;a href=\u0026#34;${BUILD_URL}console\u0026#34;\u0026gt;${BUILD_URL}console\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;b\u0026gt;\u0026lt;font color=\u0026#34;#0B610B\u0026#34;\u0026gt;å˜æ›´ä¿¡æ¯:\u0026lt;/font\u0026gt;\u0026lt;/b\u0026gt; \u0026lt;hr size=\u0026#34;2\u0026#34; width=\u0026#34;100%\u0026#34; align=\u0026#34;center\u0026#34; /\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;ä¸Šæ¬¡æ„å»ºæˆåŠŸåå˜åŒ– : ${CHANGES_SINCE_LAST_SUCCESS}\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;ä¸Šæ¬¡æ„å»ºä¸ç¨³å®šåå˜åŒ– : ${CHANGES_SINCE_LAST_UNSTABLE}\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;å†å²å˜æ›´è®°å½• : \u0026lt;a href=\u0026#34;${PROJECT_URL}changes\u0026#34;\u0026gt;${PROJECT_URL}changes\u0026lt;/a\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;å˜æ›´é›†:${JELLY_SCRIPT,template=\u0026#34;html\u0026#34;}\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;!-- \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;b\u0026gt;\u0026lt;font color=\u0026#34;#0B610B\u0026#34;\u0026gt;Failed Test Results\u0026lt;/font\u0026gt;\u0026lt;/b\u0026gt; \u0026lt;hr size=\u0026#34;2\u0026#34; width=\u0026#34;100%\u0026#34; align=\u0026#34;center\u0026#34; /\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;pre style=\u0026#34;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\u0026#34;\u0026gt;$FAILED_TESTS\u0026lt;/pre\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;b\u0026gt;\u0026lt;font color=\u0026#34;#0B610B\u0026#34;\u0026gt;æ„å»ºæ—¥å¿— (æœ€å 100è¡Œ):\u0026lt;/font\u0026gt;\u0026lt;/b\u0026gt; \u0026lt;hr size=\u0026#34;2\u0026#34; width=\u0026#34;100%\u0026#34; align=\u0026#34;center\u0026#34; /\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt;--\u0026gt; \u0026lt;!-- \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt;Test Logs (if test has ran): \u0026lt;a href=\u0026#34;${PROJECT_URL}ws/TestResult/archive_logs/Log-Build-${BUILD_NUMBER}.zip\u0026#34;\u0026gt;${PROJECT_URL}/ws/TestResult/archive_logs/Log-Build-${BUILD_NUMBER}.zip\u0026lt;/a\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;br /\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt; --\u0026gt; \u0026lt;!-- \u0026lt;tr\u0026gt; \u0026lt;td\u0026gt; \u0026lt;textarea cols=\u0026#34;80\u0026#34; rows=\u0026#34;30\u0026#34; readonly=\u0026#34;readonly\u0026#34; style=\u0026#34;font-family: Courier New\u0026#34;\u0026gt;${BUILD_LOG, maxLines=100,escapeHtml=true}\u0026lt;/textarea\u0026gt; \u0026lt;/td\u0026gt; \u0026lt;/tr\u0026gt;--\u0026gt; \u0026lt;hr size=\u0026#34;2\u0026#34; width=\u0026#34;100%\u0026#34; align=\u0026#34;center\u0026#34; /\u0026gt; \u0026lt;/table\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; ","permalink":"https://zzhaolei.github.io/posts/jenkins-email-extension%E6%8F%92%E4%BB%B6%E6%A8%A1%E6%9D%BF/","summary":"\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e  1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e  9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 19\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 20\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 21\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 22\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 23\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 24\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 25\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 26\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 27\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 28\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 29\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 30\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 31\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 32\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 33\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 34\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 35\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 36\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 37\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 38\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 39\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 40\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 41\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 42\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 43\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 44\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 45\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 46\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 47\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 48\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 49\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 50\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 51\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 52\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 53\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 54\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 55\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 56\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 57\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 58\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 59\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 60\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 61\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 62\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 63\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 64\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 65\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 66\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 67\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 68\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 69\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 70\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 71\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 72\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 73\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 74\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 75\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 76\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 77\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 78\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 79\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 80\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 81\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 82\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 83\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 84\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 85\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 86\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 87\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 88\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 89\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 90\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 91\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 92\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 93\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 94\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 95\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 96\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 97\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 98\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 99\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e100\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e101\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e102\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e103\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e104\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e105\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e106\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e107\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e108\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e109\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e110\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e111\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e112\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-gdscript3\" data-lang=\"gdscript3\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;!\u003c/span\u003e\u003cspan class=\"n\"\u003eDOCTYPE\u003c/span\u003e \u003cspan class=\"n\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003emeta\u003c/span\u003e \u003cspan class=\"n\"\u003echarset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;UTF-8\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eENV\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003evar\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;JOB_NAME\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"err\"\u003eç¬¬\u003c/span\u003e\u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eBUILD_NUMBER\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"err\"\u003eæ¬¡æ„å»ºæ—¥å¿—\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etitle\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"n\"\u003eleftmargin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003emarginwidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003etopmargin\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;8\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003emarginheight\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;4\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003eoffset\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etable\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;95%\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ecellpadding\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ecellspacing\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eæœ¬é‚®ä»¶ç”±ç¨‹åºè‡ªåŠ¨ä¸‹å‘ï¼Œè¯·å‹¿å›å¤ï¼\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eh2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;#FF0000\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eæ„å»ºç»“æœ\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eBUILD_STATUS\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eh2\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebr\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;#0B610B\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eæ„å»ºä¿¡æ¯\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehr\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;100%\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;center\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eSVN_URL\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eé¡¹ç›®åç§°ï¼š\u003c/span\u003e\u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ePROJECT_NAME\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eGITè·¯å¾„\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eGIT_URL\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eæ„å»ºç¼–å·ï¼š\u003c/span\u003e\u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eBUILD_NUMBER\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eGITåˆ†æ”¯\u003c/span\u003e\u003cspan class=\"err\"\u003eï¼š\u003c/span\u003e\u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eGIT_BRANCH\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eè§¦å‘åŸå› ï¼š\u003c/span\u003e\u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eCAUSE\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eæ„å»ºæ—¥å¿—ï¼š\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"n\"\u003ehref\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;${BUILD_URL}console\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eBUILD_URL\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"n\"\u003econsole\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;#0B610B\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eå˜æ›´ä¿¡æ¯\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehr\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;100%\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;center\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eä¸Šæ¬¡æ„å»ºæˆåŠŸåå˜åŒ–\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eCHANGES_SINCE_LAST_SUCCESS\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eä¸Šæ¬¡æ„å»ºä¸ç¨³å®šåå˜åŒ–\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eCHANGES_SINCE_LAST_UNSTABLE\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eå†å²å˜æ›´è®°å½•\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"n\"\u003ehref\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;${PROJECT_URL}changes\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ePROJECT_URL\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"n\"\u003echanges\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eå˜æ›´é›†\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"o\"\u003e$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eJELLY_SCRIPT\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003etemplate\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;html\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eli\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eul\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;!--\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;#0B610B\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFailed\u003c/span\u003e \u003cspan class=\"n\"\u003eTest\u003c/span\u003e \u003cspan class=\"n\"\u003eResults\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehr\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;100%\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;center\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003epre\u003c/span\u003e \u003cspan class=\"n\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;font-size: 11pt; font-family: Tahoma, Arial, Helvetica, sans-serif\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;$\u003c/span\u003e\u003cspan class=\"n\"\u003eFAILED_TESTS\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003epre\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebr\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e \u003cspan class=\"n\"\u003ecolor\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;#0B610B\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"err\"\u003eæ„å»ºæ—¥å¿—\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"err\"\u003eæœ€å\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"err\"\u003eè¡Œ\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003efont\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003eb\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehr\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;100%\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;center\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;--\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;!--\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eTest\u003c/span\u003e \u003cspan class=\"n\"\u003eLogs\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"n\"\u003etest\u003c/span\u003e \u003cspan class=\"n\"\u003ehas\u003c/span\u003e \u003cspan class=\"n\"\u003eran\u003c/span\u003e\u003cspan class=\"p\"\u003e):\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003ehref\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;${PROJECT_URL}ws/TestResult/archive_logs/Log-Build-${BUILD_NUMBER}.zip\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003ePROJECT_URL\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003ews\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eTestResult\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003earchive_logs\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003eLog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eBuild\u003c/span\u003e\u003cspan class=\"o\"\u003e-$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eBUILD_NUMBER\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ezip\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ea\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebr\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebr\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;!--\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003etextarea\u003c/span\u003e \u003cspan class=\"n\"\u003ecols\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;80\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003erows\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;30\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ereadonly\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;readonly\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003estyle\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;font-family: Courier New\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;$\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eBUILD_LOG\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emaxLines\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003eescapeHtml\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"bp\"\u003etrue\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etextarea\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etd\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etr\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;--\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehr\u003c/span\u003e \u003cspan class=\"n\"\u003esize\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ewidth\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;100%\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003ealign\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s2\"\u003e\u0026#34;center\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e/\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003etable\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;/\u003c/span\u003e\u003cspan class=\"n\"\u003ehtml\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e","title":"Jenkins Email Extensionæ’ä»¶æ¨¡æ¿"},{"content":"Gitæ¢è¡Œç¬¦ Gitä¼šè‡ªåŠ¨å¤„ç†æ¢è¡Œç¬¦çš„é—®é¢˜, ä½†æ˜¯è¿™ä¸ªåœ¨å®é™…å¼€å‘ä¸­ä¼šå‡ºç°é—®é¢˜, æ‰€ä»¥, åœ¨Windowsä¸Šä½¿ç”¨æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢åŠŸèƒ½, ç»Ÿä¸€ä½¿ç”¨Unixæ¢è¡Œç¬¦(ä¹Ÿå¯ä»¥åœ¨ç±»Unixä¸Šå¯ç”¨è¿™ä¸ªåŠŸèƒ½, å°†æ‹‰å–çš„æ²¡æœ‰æ”¹å˜çš„æ¢è¡Œç¬¦æ›´æ¢).\nWindowsæ‰“å¼€å®‰è£…å¥½çš„Git Bash, ç±»Unixç›´æ¥è¾“å…¥:\n1 2 git config --global core.autocrlf input git config --global core.safecrlf warn å«ä¹‰ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 AutoCRLF # æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸ºCRLF git config --global core.autocrlf true # æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢ git config --global core.autocrlf input # æäº¤æ£€å‡ºå‡ä¸è½¬æ¢ git config --global core.autocrlf false SafeCRLF # æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ git config --global core.safecrlf true # å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶ git config --global core.safecrlf false # æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š git config --global core.safecrlf warn Gitåˆ›å»ºåˆ†æ”¯ã€ åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯ã€ åˆ›å»ºtagã€ ä¿®æ”¹tagåç§° åˆ›å»ºåˆ†æ”¯: git checkout -b develop\nåˆ é™¤æœ¬åœ°åˆ†æ”¯: git branch -d develop\nåˆ é™¤è¿œç¨‹åˆ†æ”¯: git push origin :develop\nåˆ›å»ºtag: git tag -a v1.0.0 -m \u0026quot;message\u0026quot;\næ¨é€tag: git push origin --tags\nä¿®æ”¹tagåç§°:\n1 2 3 4 5 6 7 git tag new old git tag -d old git push origin :refs/tags/old git push --tags ä¿®æ”¹commitçš„ä¿¡æ¯: å¦‚æœè¿™æ˜¯ä½ æœ€è¿‘ä¸€æ¬¡æäº¤å¹¶ä¸”æ²¡æœ‰pushåˆ°è¿œç¨‹åˆ†æ”¯, å¯ç”¨ä»¥ä¸‹å‘½ä»¤ç›´æ¥ä¿®æ”¹: git commit --amend -m \u0026quot;your new message\u0026quot;\n","permalink":"https://zzhaolei.github.io/posts/git%E4%BD%BF%E7%94%A8/","summary":"\u003ch2 id=\"gitæ¢è¡Œç¬¦\"\u003eGitæ¢è¡Œç¬¦\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eGit\u003c/code\u003eä¼šè‡ªåŠ¨å¤„ç†æ¢è¡Œç¬¦çš„é—®é¢˜, ä½†æ˜¯è¿™ä¸ªåœ¨å®é™…å¼€å‘ä¸­ä¼šå‡ºç°é—®é¢˜, æ‰€ä»¥, åœ¨\u003ccode\u003eWindows\u003c/code\u003eä¸Šä½¿ç”¨\u003ccode\u003eæäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢\u003c/code\u003eåŠŸèƒ½, ç»Ÿä¸€ä½¿ç”¨Unixæ¢è¡Œç¬¦(ä¹Ÿå¯ä»¥åœ¨ç±»Unixä¸Šå¯ç”¨è¿™ä¸ªåŠŸèƒ½, å°†æ‹‰å–çš„æ²¡æœ‰æ”¹å˜çš„æ¢è¡Œç¬¦æ›´æ¢).\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eWindows\u003c/code\u003eæ‰“å¼€å®‰è£…å¥½çš„\u003ccode\u003eGit Bash\u003c/code\u003e, \u003ccode\u003eç±»Unix\u003c/code\u003eç›´æ¥è¾“å…¥:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e2\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.autocrlf input\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.safecrlf warn\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003cp\u003eå«ä¹‰ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cdiv class=\"chroma\"\u003e\n\u003ctable class=\"lntable\"\u003e\u003ctr\u003e\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode\u003e\u003cspan class=\"lnt\"\u003e 1\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 2\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 3\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 4\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 5\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 6\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 7\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 8\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e 9\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e10\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e11\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e12\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e13\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e14\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e15\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e16\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e17\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e18\n\u003c/span\u003e\u003cspan class=\"lnt\"\u003e19\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\n\u003ctd class=\"lntd\"\u003e\n\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-fallback\" data-lang=\"fallback\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eAutoCRLF\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶è½¬æ¢ä¸ºCRLF\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.autocrlf true\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# æäº¤æ—¶è½¬æ¢ä¸ºLFï¼Œæ£€å‡ºæ—¶ä¸è½¬æ¢\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.autocrlf input\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# æäº¤æ£€å‡ºå‡ä¸è½¬æ¢\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.autocrlf false\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eSafeCRLF\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# æ‹’ç»æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.safecrlf true\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# å…è®¸æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.safecrlf false\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e# æäº¤åŒ…å«æ··åˆæ¢è¡Œç¬¦çš„æ–‡ä»¶æ—¶ç»™å‡ºè­¦å‘Š\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003egit config --global core.safecrlf warn\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/td\u003e\u003c/tr\u003e\u003c/table\u003e\n\u003c/div\u003e\n\u003c/div\u003e\u003ch2 id=\"gitåˆ›å»ºåˆ†æ”¯-åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯-åˆ›å»ºtag-ä¿®æ”¹tagåç§°\"\u003eGitåˆ›å»ºåˆ†æ”¯ã€ åˆ é™¤æœ¬åœ°å’Œè¿œç¨‹åˆ†æ”¯ã€ åˆ›å»ºtagã€ ä¿®æ”¹tagåç§°\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eåˆ›å»ºåˆ†æ”¯: \u003ccode\u003egit checkout -b develop\u003c/code\u003e\u003c/p\u003e","title":"Gitä½¿ç”¨"},{"content":"docker pull gitlab/gitlab-runner:latestå®‰è£…gitlab-runner\næ‰“å¼€è‡ªå·±æ­å»ºçš„GitLabç½‘ç«™ï¼Œç‚¹å‡»é¡¶æ çš„Snippetsåé¢çš„å°æ‰³æ‰‹ï¼Œå†ç‚¹å‡»å·¦ä¾§åˆ—è¡¨ä¸­Overviewä¸­çš„Runnersï¼Œåœ¨æ‰“å¼€çš„ç½‘é¡µä¸‹é¢ï¼Œå¯ä»¥çœ‹åˆ°How to setup a shared Runner for a new projectè¡Œï¼Œ2æ˜¯Runnersè®¾ç½®æ—¶éœ€è¦æŒ‡å®šçš„URL,3æ˜¯åœ¨è®¾ç½®æ˜¯çš„Runnersã€‚\nè¿è¡Œé•œåƒ docker run -d --name gitlab-runner --restart always -v /var/run/docker.sock:/var/run/docker.sock -v /srv/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner:latest\næ³¨å†Œgitlab-runner docker exec -it gitlab-runner gitlab-runner registerï¼Œ\nPlease enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):è¾“å…¥åŸŸåæˆ–è€…æœåŠ¡å™¨ipåœ°å€ï¼Œæ ¼å¼ä¸ºhttps://gitlab.comã€‚å’Œtoken Please enter the gitlab-ci token for this runner:ã€‚\nPlease enter the gitlab-ci description for this runner:è¾“å…¥runneræè¿°ã€‚\nPlease enter the gitlab-ci tags for this runner (comma separated):ç»™è¿™ä¸ªRunneræŒ‡å®štagsï¼Œç¨åä¹Ÿå¯ä»¥åœ¨GitLab's UIä¸­ä¿®æ”¹ã€‚\nWhether to run untagged builds [true/false]:é€‰æ‹©Runneræ˜¯å¦æ¥å—æœªæŒ‡å®štagsçš„ä»»åŠ¡,ç¨åå¯ä¿®æ”¹ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚\nWhether to lock the Runner to current project [true/false]: é€‰æ‹©æ˜¯å¦ä¸ºå½“å‰é¡¹ç›®é”å®šRunnerï¼Œå¯ä¿®æ”¹ã€‚é€šå¸¸ç”¨äºè¢«æŒ‡å®šä¸ºæŸä¸ªé¡¹ç›®çš„Runnerï¼Œé»˜è®¤å€¼ä¸ºtrueã€‚\nPlease enter the executor: docker, shell, virtualbox, kubernetes, docker-ssh, parallels, ssh, docker+machine, docker-ssh+machine: é€‰æ‹©Runner executor(Runneræ‰§è¡Œå™¨)ï¼Œä½¿ç”¨shell,ä½¿ç”¨gitlab-runnerç¯å¢ƒã€‚ é‡å¯å®¹å™¨docker restart gitlab-runnerã€‚\nä¿®æ”¹é…ç½®æ–‡ä»¶docker exec -it name vim /etc/gitlab-runner/config.toml\npep8æ£€æŸ¥ç¯å¢ƒé…ç½® è¿›å»dockerå®¹å™¨ç¯å¢ƒdocker exec -it name /bin/bashï¼Œnameå°±æ˜¯å®¹å™¨çš„åç§°ï¼Œå¦‚æœæ²¡æœ‰å¯åŠ¨å®¹å™¨ï¼Œä¼šæŠ¥é”™ã€‚\nå®‰è£…python-pipï¼Œapt-get update \u0026amp;\u0026amp; apt-get install python-pip -yã€‚\nä½¿ç”¨pipå®‰è£…flake8å’Œpep8ï¼Œpip install pep8 flake8ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨pipå¯èƒ½éœ€è¦æ›´æ–°pip install --upgrade pipã€‚ æ›´æ”¹pipæºï¼Œæé«˜ä¸‹è½½é€Ÿåº¦ã€‚ç¼–è¾‘$HOME/.pip/pip.confï¼Œæ·»åŠ å†…å®¹ï¼š [global] index-url = https://mirrors.ustc.edu.cn/pypi/web/simple format = columns å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶æˆ–ç›®å½•ã€‚\nåœ¨é¡¹ç›®ä¸­ä½¿ç”¨flake8è¿›è¡Œé£æ ¼æ£€æŸ¥ éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ·»åŠ ä¸¤ä¸ªæ–‡ä»¶.flake8å’Œ.gitlab-ci.ymlï¼Œæäº¤åˆ°gitlabä¸Šã€‚\næ·»åŠ .flake8é…ç½®æ–‡ä»¶ [flake8] ignore = W292 exclude = *migrations*, # python related *.pyc, .git, __pycache__, max-line-length=120 max-complexity=12 format=pylint show_source = True statistics = True count = True\nè¯´æ˜\n1 2 3 4 5 6 7 8 9 æ³¨æ„, åœ¨.flake8é‡Œé¢ä¸è¦å¸¦ä¸­æ–‡ ignore = å¿½ç•¥é”™è¯¯ç±»å‹ exclude = ä¸æ£€æŸ¥çš„æ–‡ä»¶æ­£åˆ™åˆ—è¡¨ max-line-length = å•è¡Œæœ€å¤§å­—ç¬¦æ•°120 max-complexity = ä»£ç å¤æ‚åº¦ç­‰çº§ format = å±•ç¤ºæ ¼å¼ show_source = æ˜¾ç¤ºæºä»£ç  statistics = å±•ç¤ºç»Ÿè®¡ count = å±•ç¤ºæ€»é”™è¯¯æ•° æ·»åŠ .gitlab-ci.ymlé…ç½®æ–‡ä»¶ 1 2 3 4 5 before_script: - echo \u0026#34;Pythoné™æ€ä»£ç æ£€æŸ¥...\u0026#34; pep8: script: - flake8 . ","permalink":"https://zzhaolei.github.io/posts/docker%E5%AE%89%E8%A3%85gitlab-runner/","summary":"\u003cp\u003e\u003ccode\u003edocker pull gitlab/gitlab-runner:latest\u003c/code\u003eå®‰è£…\u003ccode\u003egitlab-runner\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003eæ‰“å¼€è‡ªå·±æ­å»ºçš„\u003ccode\u003eGitLab\u003c/code\u003eç½‘ç«™ï¼Œç‚¹å‡»é¡¶æ çš„\u003ccode\u003eSnippets\u003c/code\u003eåé¢çš„å°æ‰³æ‰‹ï¼Œå†ç‚¹å‡»å·¦ä¾§åˆ—è¡¨ä¸­\u003ccode\u003eOverview\u003c/code\u003eä¸­çš„\u003ccode\u003eRunners\u003c/code\u003eï¼Œåœ¨æ‰“å¼€çš„ç½‘é¡µä¸‹é¢ï¼Œå¯ä»¥çœ‹åˆ°\u003ccode\u003eHow to setup a shared Runner for a new project\u003c/code\u003eè¡Œï¼Œ\u003ccode\u003e2æ˜¯Runnersè®¾ç½®æ—¶éœ€è¦æŒ‡å®šçš„URL,3æ˜¯åœ¨è®¾ç½®æ˜¯çš„Runners\u003c/code\u003eã€‚\u003c/p\u003e\n\u003ch2 id=\"è¿è¡Œé•œåƒ\"\u003eè¿è¡Œé•œåƒ\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003edocker run -d --name gitlab-runner --restart always -v /var/run/docker.sock:/var/run/docker.sock -v /srv/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner:latest\u003c/code\u003e\u003c/p\u003e\n\u003ch2 id=\"æ³¨å†Œgitlab-runner\"\u003eæ³¨å†Œ\u003ccode\u003egitlab-runner\u003c/code\u003e\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003edocker exec -it gitlab-runner gitlab-runner register\u003c/code\u003eï¼Œ\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePlease enter the gitlab-ci coordinator URL (e.g. https://gitlab.com/):\u003c/code\u003eè¾“å…¥åŸŸåæˆ–è€…æœåŠ¡å™¨\u003ccode\u003eip\u003c/code\u003eåœ°å€ï¼Œæ ¼å¼ä¸º\u003ccode\u003ehttps://gitlab.com\u003c/code\u003eã€‚å’Œ\u003ccode\u003etoken\u003c/code\u003e \u003ccode\u003ePlease enter the gitlab-ci token for this runner:\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePlease enter the gitlab-ci description for this runner:\u003c/code\u003eè¾“å…¥\u003ccode\u003erunner\u003c/code\u003eæè¿°ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ePlease enter the gitlab-ci tags for this runner (comma separated):\u003c/code\u003eç»™è¿™ä¸ª\u003ccode\u003eRunner\u003c/code\u003eæŒ‡å®š\u003ccode\u003etags\u003c/code\u003eï¼Œç¨åä¹Ÿå¯ä»¥åœ¨\u003ccode\u003eGitLab's UI\u003c/code\u003eä¸­ä¿®æ”¹ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eWhether to run untagged builds [true/false]:\u003c/code\u003eé€‰æ‹©\u003ccode\u003eRunner\u003c/code\u003eæ˜¯å¦æ¥å—æœªæŒ‡å®š\u003ccode\u003etags\u003c/code\u003eçš„ä»»åŠ¡,ç¨åå¯ä¿®æ”¹ã€‚é»˜è®¤å€¼ä¸º\u003ccode\u003efalse\u003c/code\u003eã€‚\u003c/p\u003e","title":"Dockerå®‰è£…GitLab Runner"},{"content":"","permalink":"https://zzhaolei.github.io/tags/","summary":"","title":"æ ‡ç­¾"}]